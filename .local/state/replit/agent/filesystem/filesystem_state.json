{"file_contents":{"design_guidelines.md":{"content":"# BringIt Mobile Application - Design Guidelines\n\n## Architecture Decisions\n\n### Authentication\n**No Traditional Auth Required**\n- App uses local-only identity system\n- No email/password, no SSO, no cloud accounts\n- User creates profile with:\n  - Name (required)\n  - Optional profile photo (camera/gallery)\n  - Auto-generated local User ID and QR code\n- Profile management accessible from main navigation\n\n### Navigation Architecture\n**Tab Navigation (4 Tabs + Floating Action Button)**\n- **Saved Items** (catalog icon): Browse/manage reusable item library\n- **Orders** (list icon): Active and pending orders\n- **History** (clock icon): Completed orders\n- **Family** (users icon): Connected family members and QR scanner\n- **Floating Action Button** (center): \"Create Order\" (primary action)\n\nAll navigation is stack-based within tabs. No drawer needed.\n\n### Screen Specifications\n\n#### 1. Profile Setup (First Launch - Modal Stack)\n**Purpose:** Create local user identity\n- **Layout:**\n  - Transparent header with \"Skip\" button (right)\n  - Scrollable form with centered content\n  - Profile photo picker (circular, 120px diameter)\n  - Name input field\n  - \"Create Profile\" button at bottom\n  - Safe area: top = insets.top + Spacing.xl, bottom = insets.bottom + Spacing.xl\n- **Components:** Camera/gallery picker, text input, primary button\n- **Flow:** After creation, show QR code modal with \"Share this code with family\" prompt\n\n#### 2. Saved Items Tab (Default Screen)\n**Purpose:** Browse and manage permanent item catalog\n- **Layout:**\n  - Default navigation header with \"Saved Items\" title\n  - Search bar in header (collapsible on scroll)\n  - Right header button: \"Edit\" mode toggle\n  - Grid layout (2 columns) of item cards\n  - Empty state: \"No saved items yet. Add items when creating orders!\"\n  - Safe area: bottom = tabBarHeight + Spacing.xl, top = Spacing.xl\n- **Components:**\n  - Item card: SVG preview (square), optional name overlay, delete button (edit mode)\n  - Pull-to-refresh\n- **Interactions:**\n  - Tap card: View item details modal (SVG, name, last note)\n  - Long press: Quick delete with confirmation alert\n\n#### 3. Create Order Screen (Modal)\n**Purpose:** Compose new order for family member\n- **Layout:**\n  - Custom header: \"New Order\" title, \"Cancel\" (left), \"Review\" (right, disabled until 1+ item)\n  - Sticky recipient selector at top: \"Sending to: [Family Member Picker]\"\n  - Scrollable item list\n  - Two action buttons (side-by-side):\n    - \"Add from Saved\" (secondary style)\n    - \"Take Photo\" (camera icon, primary style)\n  - Safe area: bottom = insets.bottom + Spacing.xl, top = Spacing.xl\n- **Components:**\n  - Family member selector (dropdown or modal list)\n  - Item row: SVG thumbnail (64px), quantity stepper, note input field, remove button\n  - Empty state: Camera icon with \"Add your first item\"\n- **Flow:**\n  - \"Take Photo\" → Camera → SVG conversion → Auto-add to order and saved items\n  - \"Add from Saved\" → Saved items picker modal → Add selected item\n  - \"Review\" → Order summary modal → \"Send Order\" confirmation\n\n#### 4. Orders Tab\n**Purpose:** View active and pending orders (sent and received)\n- **Layout:**\n  - Default header with \"Orders\" title\n  - Segmented control: \"Received\" | \"Sent\"\n  - List of order cards grouped by status (Pending, In Progress)\n  - Safe area: bottom = tabBarHeight + Spacing.xl, top = Spacing.xl\n- **Components:**\n  - Order card: Sender/receiver name, item count, timestamp, status badge, preview of first 3 item SVGs\n  - Empty state: \"No active orders\"\n- **Interactions:**\n  - Tap order → Order detail screen\n\n#### 5. Order Detail Screen (Received Order)\n**Purpose:** Complete order items\n- **Layout:**\n  - Custom header: \"[Sender Name]'s Order\", \"Back\" (left)\n  - Scrollable list of order items\n  - Sticky footer: \"Mark Order Complete\" button (disabled until all items checked)\n  - Safe area: bottom = insets.bottom + Spacing.xl, top = Spacing.xl\n- **Components:**\n  - Order item row:\n    - SVG preview (80px square)\n    - Item name (if exists)\n    - Quantity and note text\n    - Checkbox (right): \"Found\"\n    - Expand button: Shows clarification note input and \"Replace Photo\" button\n  - Status indicator at top: \"3 of 5 items found\"\n\n#### 6. Order Detail Screen (Sent Order)\n**Purpose:** Monitor order completion\n- **Layout:** Same as received order but read-only\n- Shows completion status per item with receiver's clarification notes\n- No interactive elements except \"Back\"\n\n#### 7. Family Tab\n**Purpose:** Manage family connections\n- **Layout:**\n  - Default header: \"Family Network\"\n  - Right header button: \"Add Member\" (QR or manual entry modal)\n  - List of connected family members (avatar, name, connection date)\n  - Profile section at top: \"Your Profile\" card showing QR code and local ID\n  - Safe area: bottom = tabBarHeight + Spacing.xl, top = Spacing.xl\n- **Components:**\n  - Profile card: Circular avatar, name, \"Show QR Code\" button, \"Edit Profile\" button\n  - Family member row: Avatar, name, swipe-to-delete\n  - Empty state: \"Connect with family to start sharing orders\"\n- **QR Scanner Modal:**\n  - Full-screen camera view\n  - Cancel button (top left)\n  - Instructions overlay: \"Scan family member's QR code\"\n  - On successful scan: \"Accept connection from [Name]?\" confirmation alert\n\n#### 8. History Tab\n**Purpose:** Review completed orders\n- **Layout:**\n  - Default header: \"History\"\n  - Grouped list by date (Today, Yesterday, Last 7 Days, etc.)\n  - Order cards (same design as Orders tab, grayed out)\n  - Safe area: bottom = tabBarHeight + Spacing.xl, top = Spacing.xl\n- **Interactions:**\n  - Tap card → Read-only order detail\n  - Swipe → Delete with confirmation\n\n## Design System\n\n### Color Palette\n**Primary Colors:**\n- Primary: #4A90E2 (trust, clarity)\n- Primary Dark: #357ABD\n- Secondary: #7B68EE (family-friendly purple)\n- Accent: #50C878 (completion green)\n\n**Neutral Colors:**\n- Background: #FFFFFF\n- Surface: #F8F9FA\n- Border: #E1E4E8\n- Text Primary: #1A1A1A\n- Text Secondary: #6A737D\n- Text Tertiary: #959DA5\n\n**Status Colors:**\n- Pending: #FFA726 (orange)\n- In Progress: #42A5F5 (blue)\n- Completed: #50C878 (green)\n- Error: #EF5350 (red)\n\n### Typography\n**System Font** (San Francisco for iOS, Roboto for Android)\n- **Heading 1:** 28px, Bold, 1.2 line height\n- **Heading 2:** 22px, Semibold, 1.3 line height\n- **Heading 3:** 18px, Semibold, 1.4 line height\n- **Body:** 16px, Regular, 1.5 line height\n- **Body Small:** 14px, Regular, 1.5 line height\n- **Caption:** 12px, Regular, 1.4 line height\n\n### Spacing System\n- xs: 4px\n- sm: 8px\n- md: 12px\n- lg: 16px\n- xl: 24px\n- xxl: 32px\n\n### Component Specifications\n\n#### Buttons\n- **Primary Button:**\n  - Background: Primary color\n  - Text: White, Semibold, 16px\n  - Height: 48px, Border radius: 12px\n  - Press feedback: Opacity 0.8\n- **Secondary Button:**\n  - Background: Surface color, Border: 1px Border color\n  - Text: Primary color, Semibold, 16px\n  - Height: 48px, Border radius: 12px\n  - Press feedback: Background → #E8E8E8\n- **Floating Action Button:**\n  - Size: 56px diameter, Border radius: 28px\n  - Background: Primary color, Icon: White\n  - Shadow: offset (0, 2), opacity 0.10, radius 2\n  - Position: Bottom center, 16px above tab bar\n\n#### Cards\n- Background: White\n- Border radius: 12px\n- Border: 1px #E1E4E8\n- Padding: 16px\n- Press feedback: Scale 0.98\n\n#### Input Fields\n- Height: 48px\n- Border: 1px #E1E4E8, Border radius: 8px\n- Padding: 12px horizontal\n- Focus state: Border color → Primary\n- Placeholder: Text Tertiary\n\n#### SVG Previews\n- Always use rounded corners (8px border radius)\n- Aspect ratio: 1:1 (square)\n- Border: 1px #E1E4E8\n- Loading state: Skeleton shimmer animation\n\n### Visual Assets\n**Required Generated Assets:**\n1. **Default User Avatars (5 variations):** Friendly, colorful geometric patterns or illustrated characters that work for all ages. Style: Minimal, warm, family-friendly\n2. **Empty State Illustrations (3):**\n   - No saved items: Simple grocery bag illustration\n   - No orders: Family coordination illustration\n   - No family members: Connection/link illustration\n3. **App Icon:** Shopping bag with family silhouette, gradient background (Primary → Secondary)\n\n**Standard Icons:** Use Feather icons from @expo/vector-icons for all UI actions (camera, trash, check, edit, users, clock, list, etc.)\n\n### Accessibility\n- Minimum touch target: 44×44px\n- Color contrast ratio: 4.5:1 for text, 3:1 for UI elements\n- All interactive elements have visible focus states\n- SVG images have alt text descriptions stored in item metadata\n- VoiceOver/TalkBack labels for all buttons and inputs\n- Camera permissions clearly explained in system alert\n\n### Interaction Patterns\n- **Pull-to-refresh:** Available on all list screens\n- **Swipe actions:** Delete on family members and history items\n- **Long press:** Quick actions on saved items\n- **Haptic feedback:** Light impact on button taps, medium on success actions, heavy on errors\n- **Loading states:** Skeleton screens for lists, spinners for actions\n- **Confirmation alerts:** Required for delete actions and order completion\n- **Toast notifications:** Success messages (2s duration, bottom position)","path":null,"size_bytes":9167,"size_tokens":null},"client/hooks/useColorScheme.ts":{"content":"export { useColorScheme } from \"react-native\";\n","path":null,"size_bytes":47,"size_tokens":null},"client/components/Card.tsx":{"content":"import React from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius } from \"@/constants/theme\";\n\ninterface CardProps {\n  elevation?: number;\n  title?: string;\n  description?: string;\n  children?: React.ReactNode;\n  onPress?: () => void;\n  style?: StyleProp<ViewStyle>;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst getBackgroundColorForElevation = (\n  elevation: number,\n  theme: any,\n): string => {\n  switch (elevation) {\n    case 1:\n      return theme.backgroundDefault;\n    case 2:\n      return theme.backgroundSecondary;\n    case 3:\n      return theme.backgroundTertiary;\n    default:\n      return theme.backgroundRoot;\n  }\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Card({\n  elevation = 1,\n  title,\n  description,\n  children,\n  onPress,\n  style,\n}: CardProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const cardBackgroundColor = getBackgroundColorForElevation(elevation, theme);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    scale.value = withSpring(0.98, springConfig);\n  };\n\n  const handlePressOut = () => {\n    scale.value = withSpring(1, springConfig);\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      style={[\n        styles.card,\n        {\n          backgroundColor: cardBackgroundColor,\n        },\n        animatedStyle,\n        style,\n      ]}\n    >\n      {title ? (\n        <ThemedText type=\"h4\" style={styles.cardTitle}>\n          {title}\n        </ThemedText>\n      ) : null}\n      {description ? (\n        <ThemedText type=\"small\" style={styles.cardDescription}>\n          {description}\n        </ThemedText>\n      ) : null}\n      {children}\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  card: {\n    padding: Spacing.xl,\n    borderRadius: BorderRadius[\"2xl\"],\n  },\n  cardTitle: {\n    marginBottom: Spacing.sm,\n  },\n  cardDescription: {\n    opacity: 0.7,\n  },\n});\n","path":null,"size_bytes":2459,"size_tokens":null},"client/App.tsx":{"content":"import React, { useEffect } from \"react\";\nimport { StyleSheet, View, ActivityIndicator } from \"react-native\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport { KeyboardProvider } from \"react-native-keyboard-controller\";\nimport { SafeAreaProvider } from \"react-native-safe-area-context\";\nimport { StatusBar } from \"expo-status-bar\";\nimport * as Font from \"expo-font\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as SplashScreen from \"expo-splash-screen\";\n\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/query-client\";\n\nimport RootStackNavigator from \"@/navigation/RootStackNavigator\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { ToastProvider } from \"@/lib/toast\";\nimport { \n  registerForPushNotifications, \n  registerDeviceToken, \n  setupNotificationListeners \n} from \"@/lib/notifications\";\nimport { getState, subscribe } from \"@/lib/store\";\n\nSplashScreen.preventAutoHideAsync();\n\nexport default function App() {\n  const [fontsLoaded, setFontsLoaded] = React.useState(false);\n  const [fontError, setFontError] = React.useState<Error | null>(null);\n\n  useEffect(() => {\n    async function loadFonts() {\n      try {\n        await Font.loadAsync(Feather.font);\n        setFontsLoaded(true);\n      } catch (error) {\n        console.error(\"Font loading error:\", error);\n        setFontError(error as Error);\n        setFontsLoaded(true);\n      }\n    }\n    loadFonts();\n  }, []);\n\n  useEffect(() => {\n    if (fontsLoaded || fontError) {\n      SplashScreen.hideAsync();\n    }\n  }, [fontsLoaded, fontError]);\n\n  useEffect(() => {\n    const initNotifications = async () => {\n      const currentUser = getState().currentUser;\n      if (currentUser) {\n        const token = await registerForPushNotifications();\n        if (token) {\n          await registerDeviceToken(token);\n        }\n      }\n    };\n\n    initNotifications();\n\n    const unsubscribe = subscribe(() => {\n      const user = getState().currentUser;\n      if (user) {\n        registerForPushNotifications().then((token) => {\n          if (token) {\n            registerDeviceToken(token);\n          }\n        });\n      }\n    });\n\n    const cleanupListeners = setupNotificationListeners();\n\n    return () => {\n      unsubscribe();\n      cleanupListeners();\n    };\n  }, []);\n\n  if (!fontsLoaded && !fontError) {\n    return (\n      <View style={styles.loadingContainer}>\n        <ActivityIndicator size=\"large\" />\n      </View>\n    );\n  }\n\n  return (\n    <ErrorBoundary>\n      <QueryClientProvider client={queryClient}>\n        <SafeAreaProvider>\n          <GestureHandlerRootView style={styles.root}>\n            <KeyboardProvider>\n              <ToastProvider>\n                <NavigationContainer>\n                  <RootStackNavigator />\n                </NavigationContainer>\n                <StatusBar style=\"auto\" />\n              </ToastProvider>\n            </KeyboardProvider>\n          </GestureHandlerRootView>\n        </SafeAreaProvider>\n      </QueryClientProvider>\n    </ErrorBoundary>\n  );\n}\n\nconst styles = StyleSheet.create({\n  root: {\n    flex: 1,\n  },\n  loadingContainer: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n});\n","path":null,"size_bytes":3300,"size_tokens":null},"client/screens/HistoryScreen.tsx":{"content":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { View, StyleSheet, FlatList, Platform, Image, RefreshControl } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getState, subscribe, loadTasksFromServer, Task } from \"@/lib/store\";\n\ninterface GroupedTasks {\n  title: string;\n  data: Task[];\n}\n\nfunction groupTasksByDate(tasks: Task[]): GroupedTasks[] {\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const yesterday = new Date(today.getTime() - 86400000);\n  const lastWeek = new Date(today.getTime() - 7 * 86400000);\n\n  const groups: { [key: string]: Task[] } = {\n    Today: [],\n    Yesterday: [],\n    \"This Week\": [],\n    Earlier: [],\n  };\n\n  tasks.forEach((task) => {\n    const date = new Date(task.completedAt || task.createdAt);\n    if (date >= today) {\n      groups.Today.push(task);\n    } else if (date >= yesterday) {\n      groups.Yesterday.push(task);\n    } else if (date >= lastWeek) {\n      groups[\"This Week\"].push(task);\n    } else {\n      groups.Earlier.push(task);\n    }\n  });\n\n  return Object.entries(groups)\n    .filter(([, data]) => data.length > 0)\n    .map(([title, data]) => ({ title, data }));\n}\n\nfunction TaskCard({ task, isParent }: { task: Task; isParent: boolean }) {\n  const { theme } = useTheme();\n\n  const formatTime = (timestamp: number) => {\n    return new Date(timestamp).toLocaleTimeString([], { \n      hour: \"2-digit\", \n      minute: \"2-digit\" \n    });\n  };\n\n  return (\n    <Card style={styles.taskCard}>\n      <View style={styles.taskContent}>\n        <View style={[styles.taskImage, { backgroundColor: theme.backgroundSecondary }]}>\n          {task.itemSvgData ? (\n            <Image source={{ uri: task.itemSvgData }} style={styles.itemImage} />\n          ) : (\n            <Feather name=\"image\" size={32} color={theme.textTertiary} />\n          )}\n        </View>\n        <View style={styles.taskInfo}>\n          <ThemedText type=\"h4\" numberOfLines={1}>\n            {task.itemName || \"Item\"}\n          </ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            {isParent \n              ? `Completed by ${task.assignedToName}`\n              : `From ${task.assignedByName}`\n            } • {formatTime(task.completedAt || task.createdAt)}\n          </ThemedText>\n          {task.quantity > 1 ? (\n            <ThemedText type=\"small\" style={{ color: theme.textSecondary }}>\n              Qty: {task.quantity}\n            </ThemedText>\n          ) : null}\n        </View>\n        <View style={[styles.completedBadge, { backgroundColor: Colors.light.statusCompleted + \"20\" }]}>\n          <Feather name=\"check\" size={16} color={Colors.light.statusCompleted} />\n        </View>\n      </View>\n    </Card>\n  );\n}\n\nfunction EmptyState({ isParent }: { isParent: boolean }) {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"check-circle\" size={64} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No Completed Tasks\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        {isParent \n          ? \"When children complete assigned tasks, they will appear here\"\n          : \"Tasks you complete will appear here\"\n        }\n      </ThemedText>\n    </View>\n  );\n}\n\nexport default function HistoryScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const [tasks, setTasks] = useState<Task[]>([]);\n  const [isParent, setIsParent] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n\n  const loadData = useCallback(async () => {\n    const currentState = getState();\n    const currentUser = currentState.currentUser;\n    if (!currentUser) return;\n    \n    await loadTasksFromServer(currentUser.id);\n    \n    const newState = getState();\n    const userIsParent = currentUser.role === 'parent';\n    setIsParent(userIsParent);\n    \n    if (userIsParent) {\n      setTasks(newState.tasks.filter(t => \n        t.assignedById === currentUser.id && t.status === 'completed'\n      ));\n    } else {\n      setTasks(newState.tasks.filter(t => \n        t.assignedToId === currentUser.id && t.status === 'completed'\n      ));\n    }\n  }, []);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData();\n    }, [loadData])\n  );\n\n  useEffect(() => {\n    const state = getState();\n    const currentUser = state.currentUser;\n    const userIsParent = currentUser?.role === 'parent';\n    setIsParent(userIsParent);\n    \n    if (userIsParent) {\n      setTasks(state.tasks.filter(t => \n        t.assignedById === currentUser?.id && t.status === 'completed'\n      ));\n    } else {\n      setTasks(state.tasks.filter(t => \n        t.assignedToId === currentUser?.id && t.status === 'completed'\n      ));\n    }\n    \n    const unsubscribe = subscribe(() => {\n      const newState = getState();\n      const user = newState.currentUser;\n      const parentRole = user?.role === 'parent';\n      setIsParent(parentRole);\n      \n      if (parentRole) {\n        setTasks([...newState.tasks.filter(t => \n          t.assignedById === user?.id && t.status === 'completed'\n        )]);\n      } else {\n        setTasks([...newState.tasks.filter(t => \n          t.assignedToId === user?.id && t.status === 'completed'\n        )]);\n      }\n    });\n    return unsubscribe;\n  }, []);\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    await loadData();\n    setRefreshing(false);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const groupedTasks = groupTasksByDate(tasks);\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={groupedTasks}\n        keyExtractor={(item) => item.title}\n        contentContainerStyle={[\n          styles.listContent,\n          {\n            paddingTop: headerHeight + Spacing.lg,\n            paddingBottom: tabBarHeight + Spacing[\"3xl\"],\n          },\n        ]}\n        ListEmptyComponent={<EmptyState isParent={isParent} />}\n        refreshControl={\n          <RefreshControl\n            refreshing={refreshing}\n            onRefresh={handleRefresh}\n            tintColor={theme.primary}\n          />\n        }\n        renderItem={({ item: group }) => (\n          <View style={styles.section}>\n            <ThemedText type=\"caption\" style={[styles.sectionTitle, { color: theme.textSecondary }]}>\n              {group.title}\n            </ThemedText>\n            {group.data.map((task) => (\n              <TaskCard key={task.id} task={task} isParent={isParent} />\n            ))}\n          </View>\n        )}\n        showsVerticalScrollIndicator={false}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  section: {\n    marginBottom: Spacing.xl,\n  },\n  sectionTitle: {\n    marginBottom: Spacing.sm,\n    marginLeft: Spacing.xs,\n    textTransform: \"uppercase\",\n    letterSpacing: 0.5,\n  },\n  taskCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing.sm,\n  },\n  taskContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  taskImage: {\n    width: 50,\n    height: 50,\n    borderRadius: BorderRadius.md,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n    overflow: \"hidden\",\n  },\n  itemImage: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  taskInfo: {\n    flex: 1,\n    gap: Spacing.xs / 2,\n  },\n  completedBadge: {\n    width: 32,\n    height: 32,\n    borderRadius: 16,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginLeft: Spacing.sm,\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"4xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n  },\n});\n","path":null,"size_bytes":8837,"size_tokens":null},"scripts/build.js":{"content":"const fs = require(\"fs\");\nconst path = require(\"path\");\nconst { spawn } = require(\"child_process\");\nconst { Readable } = require(\"stream\");\nconst { pipeline } = require(\"stream/promises\");\n\nlet metroProcess = null;\n\nfunction exitWithError(message) {\n  console.error(message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n}\n\nfunction setupSignalHandlers() {\n  const cleanup = () => {\n    if (metroProcess) {\n      console.log(\"Cleaning up Metro process...\");\n      metroProcess.kill();\n    }\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", cleanup);\n  process.on(\"SIGTERM\", cleanup);\n  process.on(\"SIGHUP\", cleanup);\n}\n\nfunction stripProtocol(domain) {\n  let urlString = domain.trim();\n\n  if (!/^https?:\\/\\//i.test(urlString)) {\n    urlString = `https://${urlString}`;\n  }\n\n  return new URL(urlString).host;\n}\n\nfunction getDeploymentDomain() {\n  // Check Replit deployment environment variables first\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_INTERNAL_APP_DOMAIN);\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_DEV_DOMAIN);\n  }\n\n  if (process.env.EXPO_PUBLIC_DOMAIN) {\n    return stripProtocol(process.env.EXPO_PUBLIC_DOMAIN);\n  }\n\n  console.error(\n    \"ERROR: No deployment domain found. Set REPLIT_INTERNAL_APP_DOMAIN, REPLIT_DEV_DOMAIN, or EXPO_PUBLIC_DOMAIN\",\n  );\n  process.exit(1);\n}\n\nfunction prepareDirectories(timestamp) {\n  console.log(\"Preparing build directories...\");\n\n  if (fs.existsSync(\"static-build\")) {\n    fs.rmSync(\"static-build\", { recursive: true });\n  }\n\n  const dirs = [\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"ios\"),\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"android\"),\n    path.join(\"static-build\", \"ios\"),\n    path.join(\"static-build\", \"android\"),\n  ];\n\n  for (const dir of dirs) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  console.log(\"Build:\", timestamp);\n}\n\nfunction clearMetroCache() {\n  console.log(\"Clearing Metro cache...\");\n\n  const cacheDirs = [\n    ...fs.globSync(\".metro-cache\"),\n    ...fs.globSync(\"node_modules/.cache/metro\"),\n  ];\n\n  for (const dir of cacheDirs) {\n    fs.rmSync(dir, { recursive: true, force: true });\n  }\n\n  console.log(\"Cache cleared\");\n}\n\nasync function checkMetroHealth() {\n  try {\n    const response = await fetch(\"http://localhost:8081/status\", {\n      signal: AbortSignal.timeout(5000),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nasync function startMetro(expoPublicDomain) {\n  const isRunning = await checkMetroHealth();\n  if (isRunning) {\n    console.log(\"Metro already running\");\n    return;\n  }\n\n  console.log(\"Starting Metro...\");\n  console.log(`Setting EXPO_PUBLIC_DOMAIN=${expoPublicDomain}`);\n  const env = {\n    ...process.env,\n    EXPO_PUBLIC_DOMAIN: expoPublicDomain,\n  };\n  metroProcess = spawn(\"npm\", [\"run\", \"expo:start:static:build\"], {\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    detached: false,\n    env,\n  });\n\n  if (metroProcess.stdout) {\n    metroProcess.stdout.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.log(`[Metro] ${output}`);\n    });\n  }\n  if (metroProcess.stderr) {\n    metroProcess.stderr.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.error(`[Metro Error] ${output}`);\n    });\n  }\n\n  for (let i = 0; i < 60; i++) {\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    const healthy = await checkMetroHealth();\n    if (healthy) {\n      console.log(\"Metro ready\");\n      return;\n    }\n  }\n\n  console.error(\"Metro timeout\");\n  process.exit(1);\n}\n\nasync function downloadFile(url, outputPath) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 120_000);\n\n  try {\n    console.log(`Downloading: ${url}`);\n    const response = await fetch(url, { signal: controller.signal });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const file = fs.createWriteStream(outputPath);\n    await pipeline(Readable.fromWeb(response.body), file);\n\n    const fileSize = fs.statSync(outputPath).size;\n\n    if (fileSize === 0) {\n      fs.unlinkSync(outputPath);\n      throw new Error(\"Downloaded file is empty\");\n    }\n  } catch (error) {\n    if (fs.existsSync(outputPath)) {\n      fs.unlinkSync(outputPath);\n    }\n\n    if (error.name === \"AbortError\") {\n      throw new Error(`Download timeout after 2m: ${url}`);\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundle(platform, timestamp) {\n  const url = new URL(\"http://localhost:8081/client/index.bundle\");\n  url.searchParams.set(\"platform\", platform);\n  url.searchParams.set(\"dev\", \"false\");\n  url.searchParams.set(\"hot\", \"false\");\n  url.searchParams.set(\"lazy\", \"false\");\n  url.searchParams.set(\"minify\", \"true\");\n\n  const output = path.join(\n    \"static-build\",\n    timestamp,\n    \"_expo\",\n    \"static\",\n    \"js\",\n    platform,\n    \"bundle.js\",\n  );\n\n  console.log(`Fetching ${platform} bundle...`);\n  await downloadFile(url.toString(), output);\n  console.log(`${platform} bundle ready`);\n}\n\nasync function downloadManifest(platform) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 300_000);\n\n  try {\n    console.log(`Fetching ${platform} manifest...`);\n    const response = await fetch(\"http://localhost:8081/manifest\", {\n      headers: { \"expo-platform\": platform },\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const manifest = await response.json();\n    console.log(`${platform} manifest ready`);\n    return manifest;\n  } catch (error) {\n    if (error.name === \"AbortError\") {\n      throw new Error(\n        `Manifest download timeout after 5m for platform: ${platform}`,\n      );\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundlesAndManifests(timestamp) {\n  console.log(\"Downloading bundles and manifests...\");\n  console.log(\"This may take several minutes for production builds...\");\n\n  try {\n    const results = await Promise.allSettled([\n      downloadBundle(\"ios\", timestamp),\n      downloadBundle(\"android\", timestamp),\n      downloadManifest(\"ios\"),\n      downloadManifest(\"android\"),\n    ]);\n\n    const failures = results\n      .map((result, index) => ({ result, index }))\n      .filter(({ result }) => result.status === \"rejected\");\n\n    if (failures.length > 0) {\n      const errorMessages = failures.map(({ result, index }) => {\n        const names = [\n          \"iOS bundle\",\n          \"Android bundle\",\n          \"iOS manifest\",\n          \"Android manifest\",\n        ];\n        return `  - ${names[index]}: ${result.reason?.message || result.reason}`;\n      });\n\n      exitWithError(`Download failed:\\n${errorMessages.join(\"\\n\")}`);\n    }\n\n    const iosManifest =\n      results[2].status === \"fulfilled\" ? results[2].value : null;\n    const androidManifest =\n      results[3].status === \"fulfilled\" ? results[3].value : null;\n\n    console.log(\"All downloads completed successfully\");\n    return { ios: iosManifest, android: androidManifest };\n  } catch (error) {\n    exitWithError(`Unexpected download error: ${error.message}`);\n  }\n}\n\nfunction extractAssets(timestamp) {\n  const bundles = {\n    ios: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"ios\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n    android: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"android\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n  };\n\n  const assetsMap = new Map();\n  const assetPattern =\n    /httpServerLocation:\"([^\"]+)\"[^}]*hash:\"([^\"]+)\"[^}]*name:\"([^\"]+)\"[^}]*type:\"([^\"]+)\"/g;\n\n  const extractFromBundle = (bundle, platform) => {\n    for (const match of bundle.matchAll(assetPattern)) {\n      const originalPath = match[1];\n      const filename = match[3] + \".\" + match[4];\n\n      const tempUrl = new URL(`http://localhost:8081${originalPath}`);\n      const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n      if (!unstablePath) {\n        throw new Error(`Asset missing unstable_path: ${originalPath}`);\n      }\n\n      const decodedPath = decodeURIComponent(unstablePath);\n      const key = path.posix.join(decodedPath, filename);\n\n      if (!assetsMap.has(key)) {\n        const asset = {\n          url: path.posix.join(\"/\", decodedPath, filename),\n          originalPath: originalPath,\n          filename: filename,\n          relativePath: decodedPath,\n          hash: match[2],\n          platforms: new Set(),\n        };\n\n        assetsMap.set(key, asset);\n      }\n      assetsMap.get(key).platforms.add(platform);\n    }\n  };\n\n  extractFromBundle(bundles.ios, \"ios\");\n  extractFromBundle(bundles.android, \"android\");\n\n  return Array.from(assetsMap.values());\n}\n\nasync function downloadAssets(assets, timestamp) {\n  if (assets.length === 0) {\n    return 0;\n  }\n\n  console.log(\"Downloading assets...\");\n  let successCount = 0;\n  const failures = [];\n\n  const downloadPromises = assets.map(async (asset) => {\n    const platform = Array.from(asset.platforms)[0];\n\n    const tempUrl = new URL(`http://localhost:8081${asset.originalPath}`);\n    const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n    if (!unstablePath) {\n      throw new Error(`Asset missing unstable_path: ${asset.originalPath}`);\n    }\n\n    const decodedPath = decodeURIComponent(unstablePath);\n    const metroUrl = new URL(\n      `http://localhost:8081${path.posix.join(\"/assets\", decodedPath, asset.filename)}`,\n    );\n    metroUrl.searchParams.set(\"platform\", platform);\n    metroUrl.searchParams.set(\"hash\", asset.hash);\n\n    const outputDir = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      asset.relativePath,\n    );\n    fs.mkdirSync(outputDir, { recursive: true });\n    const output = path.join(outputDir, asset.filename);\n\n    try {\n      await downloadFile(metroUrl.toString(), output);\n      successCount++;\n    } catch (error) {\n      failures.push({\n        filename: asset.filename,\n        error: error.message,\n        url: metroUrl.toString(),\n      });\n    }\n  });\n\n  await Promise.all(downloadPromises);\n\n  if (failures.length > 0) {\n    const errorMsg =\n      `Failed to download ${failures.length} asset(s):\\n` +\n      failures\n        .map((f) => `  - ${f.filename}: ${f.error} (${f.url})`)\n        .join(\"\\n\");\n    exitWithError(errorMsg);\n  }\n\n  console.log(`Downloaded ${successCount} assets`);\n  return successCount;\n}\n\nfunction updateBundleUrls(timestamp, baseUrl) {\n  const updateForPlatform = (platform) => {\n    const bundlePath = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      platform,\n      \"bundle.js\",\n    );\n    let bundle = fs.readFileSync(bundlePath, \"utf-8\");\n\n    bundle = bundle.replace(\n      /httpServerLocation:\"(\\/[^\"]+)\"/g,\n      (_match, capturedPath) => {\n        const tempUrl = new URL(`http://localhost:8081${capturedPath}`);\n        const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n        if (!unstablePath) {\n          throw new Error(\n            `Asset missing unstable_path in bundle: ${capturedPath}`,\n          );\n        }\n\n        const decodedPath = decodeURIComponent(unstablePath);\n        return `httpServerLocation:\"${baseUrl}/${timestamp}/_expo/static/js/${decodedPath}\"`;\n      },\n    );\n\n    fs.writeFileSync(bundlePath, bundle);\n  };\n\n  updateForPlatform(\"ios\");\n  updateForPlatform(\"android\");\n  console.log(\"Updated bundle URLs\");\n}\n\nfunction updateManifests(manifests, timestamp, baseUrl, assetsByHash) {\n  const updateForPlatform = (platform, manifest) => {\n    if (!manifest.launchAsset || !manifest.extra) {\n      exitWithError(`Malformed manifest for ${platform}`);\n    }\n\n    manifest.launchAsset.url = `${baseUrl}/${timestamp}/_expo/static/js/${platform}/bundle.js`;\n    manifest.launchAsset.key = `bundle-${timestamp}`;\n    manifest.createdAt = new Date(\n      Number(timestamp.split(\"-\")[0]),\n    ).toISOString();\n    manifest.extra.expoClient.hostUri =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.debuggerHost =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.packagerOpts.dev = false;\n\n    if (manifest.assets && manifest.assets.length > 0) {\n      manifest.assets.forEach((asset) => {\n        if (!asset.url) return;\n\n        const hash = asset.hash;\n        if (!hash) return;\n\n        const assetInfo = assetsByHash.get(hash);\n        if (!assetInfo) return;\n\n        asset.url = `${baseUrl}/${timestamp}/_expo/static/js/${assetInfo.relativePath}/${assetInfo.filename}`;\n      });\n    }\n\n    fs.writeFileSync(\n      path.join(\"static-build\", platform, \"manifest.json\"),\n      JSON.stringify(manifest, null, 2),\n    );\n  };\n\n  updateForPlatform(\"ios\", manifests.ios);\n  updateForPlatform(\"android\", manifests.android);\n  console.log(\"Manifests updated\");\n}\n\nasync function main() {\n  console.log(\"Building static Expo Go deployment...\");\n\n  setupSignalHandlers();\n\n  const domain = getDeploymentDomain();\n  const baseUrl = `https://${domain}`;\n  const timestamp = `${Date.now()}-${process.pid}`;\n\n  prepareDirectories(timestamp);\n  clearMetroCache();\n\n  await startMetro(domain);\n\n  const downloadTimeout = 300000;\n  const downloadPromise = downloadBundlesAndManifests(timestamp);\n  const timeoutPromise = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(\n        new Error(\n          `Overall download timeout after ${downloadTimeout / 1000} seconds. ` +\n            \"Metro may be struggling to generate bundles. Check Metro logs above.\",\n        ),\n      );\n    }, downloadTimeout);\n  });\n\n  const manifests = await Promise.race([downloadPromise, timeoutPromise]);\n\n  console.log(\"Processing assets...\");\n  const assets = extractAssets(timestamp);\n  console.log(\"Found\", assets.length, \"unique asset(s)\");\n\n  const assetsByHash = new Map();\n  for (const asset of assets) {\n    assetsByHash.set(asset.hash, {\n      relativePath: asset.relativePath,\n      filename: asset.filename,\n    });\n  }\n\n  const assetCount = await downloadAssets(assets, timestamp);\n\n  if (assetCount > 0) {\n    updateBundleUrls(timestamp, baseUrl);\n  }\n\n  console.log(\"Updating manifests and creating landing page...\");\n  updateManifests(manifests, timestamp, baseUrl, assetsByHash);\n\n  console.log(\"Build complete! Deploy to:\", baseUrl);\n\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(0);\n}\n\nmain().catch((error) => {\n  console.error(\"Build failed:\", error.message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n});\n","path":null,"size_bytes":14884,"size_tokens":null},"server/index.ts":{"content":"import express from \"express\";\nimport type { Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport { initializeFirebase } from \"./firebase\";\n\nconst app = express();\nconst log = console.log;\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nfunction setupCors(app: express.Application) {\n  app.use((req, res, next) => {\n    const origins = new Set<string>();\n\n    if (process.env.REPLIT_DEV_DOMAIN) {\n      origins.add(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n    }\n\n    if (process.env.REPLIT_DOMAINS) {\n      process.env.REPLIT_DOMAINS.split(\",\").forEach((d) => {\n        origins.add(`https://${d.trim()}`);\n      });\n    }\n\n    const origin = req.header(\"origin\");\n\n    if (origin && origins.has(origin)) {\n      res.header(\"Access-Control-Allow-Origin\", origin);\n      res.header(\n        \"Access-Control-Allow-Methods\",\n        \"GET, POST, PUT, DELETE, OPTIONS\",\n      );\n      res.header(\"Access-Control-Allow-Headers\", \"Content-Type\");\n      res.header(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n\n    if (req.method === \"OPTIONS\") {\n      return res.sendStatus(200);\n    }\n\n    next();\n  });\n}\n\nfunction setupBodyParsing(app: express.Application) {\n  app.use(\n    express.json({\n      verify: (req, _res, buf) => {\n        req.rawBody = buf;\n      },\n    }),\n  );\n\n  app.use(express.urlencoded({ extended: false }));\n}\n\nfunction setupRequestLogging(app: express.Application) {\n  app.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, unknown> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n      if (!path.startsWith(\"/api\")) return;\n\n      const duration = Date.now() - start;\n\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    });\n\n    next();\n  });\n}\n\nfunction getAppName(): string {\n  try {\n    const appJsonPath = path.resolve(process.cwd(), \"app.json\");\n    const appJsonContent = fs.readFileSync(appJsonPath, \"utf-8\");\n    const appJson = JSON.parse(appJsonContent);\n    return appJson.expo?.name || \"App Landing Page\";\n  } catch {\n    return \"App Landing Page\";\n  }\n}\n\nfunction serveExpoManifest(platform: string, res: Response) {\n  const manifestPath = path.resolve(\n    process.cwd(),\n    \"static-build\",\n    platform,\n    \"manifest.json\",\n  );\n\n  if (!fs.existsSync(manifestPath)) {\n    return res\n      .status(404)\n      .json({ error: `Manifest not found for platform: ${platform}` });\n  }\n\n  res.setHeader(\"expo-protocol-version\", \"1\");\n  res.setHeader(\"expo-sfv-version\", \"0\");\n  res.setHeader(\"content-type\", \"application/json\");\n\n  const manifest = fs.readFileSync(manifestPath, \"utf-8\");\n  res.send(manifest);\n}\n\nfunction serveLandingPage({\n  req,\n  res,\n  landingPageTemplate,\n  appName,\n}: {\n  req: Request;\n  res: Response;\n  landingPageTemplate: string;\n  appName: string;\n}) {\n  const forwardedProto = req.header(\"x-forwarded-proto\");\n  const protocol = forwardedProto || req.protocol || \"https\";\n  const forwardedHost = req.header(\"x-forwarded-host\");\n  const host = forwardedHost || req.get(\"host\");\n  const baseUrl = `${protocol}://${host}`;\n  const expsUrl = `${host}`;\n\n  log(`baseUrl`, baseUrl);\n  log(`expsUrl`, expsUrl);\n\n  const html = landingPageTemplate\n    .replace(/BASE_URL_PLACEHOLDER/g, baseUrl)\n    .replace(/EXPS_URL_PLACEHOLDER/g, expsUrl)\n    .replace(/APP_NAME_PLACEHOLDER/g, appName);\n\n  res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n  res.status(200).send(html);\n}\n\nfunction configureExpoAndLanding(app: express.Application) {\n  const templatePath = path.resolve(\n    process.cwd(),\n    \"server\",\n    \"templates\",\n    \"landing-page.html\",\n  );\n  const landingPageTemplate = fs.readFileSync(templatePath, \"utf-8\");\n  const appName = getAppName();\n\n  log(\"Serving static Expo files with dynamic manifest routing\");\n\n  app.use((req: Request, res: Response, next: NextFunction) => {\n    if (req.path.startsWith(\"/api\")) {\n      return next();\n    }\n\n    if (req.path !== \"/\" && req.path !== \"/manifest\") {\n      return next();\n    }\n\n    const platform = req.header(\"expo-platform\");\n    if (platform && (platform === \"ios\" || platform === \"android\")) {\n      return serveExpoManifest(platform, res);\n    }\n\n    if (req.path === \"/\") {\n      return serveLandingPage({\n        req,\n        res,\n        landingPageTemplate,\n        appName,\n      });\n    }\n\n    next();\n  });\n\n  app.use(\"/assets\", express.static(path.resolve(process.cwd(), \"assets\")));\n  app.use(express.static(path.resolve(process.cwd(), \"static-build\")));\n\n  log(\"Expo routing: Checking expo-platform header on / and /manifest\");\n}\n\nfunction setupErrorHandler(app: express.Application) {\n  app.use((err: unknown, _req: Request, res: Response, _next: NextFunction) => {\n    const error = err as {\n      status?: number;\n      statusCode?: number;\n      message?: string;\n    };\n\n    const status = error.status || error.statusCode || 500;\n    const message = error.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n\n    throw err;\n  });\n}\n\n(async () => {\n  initializeFirebase();\n  \n  setupCors(app);\n  setupBodyParsing(app);\n  setupRequestLogging(app);\n\n  configureExpoAndLanding(app);\n\n  const server = await registerRoutes(app);\n\n  setupErrorHandler(app);\n\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`express server serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":6025,"size_tokens":null},"replit.md":{"content":"# BringIt - Mobile Application\n\n## Overview\n\nBringIt is a React Native mobile application built with Expo for family coordination around grocery shopping and errands. The app enables parents to create visual shopping orders and delegate them to children/young adults. The core philosophy is \"visual first\" - prioritizing photos over text for item identification.\n\n**Key Features:**\n- Local-first user identity (no cloud accounts)\n- QR code-based family member connections\n- Visual item catalog with reusable saved items\n- Order creation, tracking, and completion workflow\n- Offline-capable architecture\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture (React Native + Expo)\n\n**Navigation Pattern:** Tab-based navigation with 4 main tabs plus a floating action button for order creation.\n- Tabs: Saved Items, Orders, History, Family\n- Stack navigation within each tab for detail screens\n- Modal presentation for profile setup and QR code flows\n\n**State Management:** Custom local store (`client/lib/store.ts`) with subscription pattern for reactive updates. No Redux or external state library - uses simple observer pattern.\n\n**Component Structure:**\n- Themed components (`ThemedView`, `ThemedText`) for consistent dark/light mode support\n- Reusable UI primitives (`Button`, `Card`, `Spacer`) with animation support via Reanimated\n- Platform-specific keyboard handling with `KeyboardAwareScrollViewCompat`\n\n**Styling Approach:** Centralized theme constants (`client/constants/theme.ts`) with spacing, border radius, colors, and typography tokens. Components use StyleSheet.create with theme injection via `useTheme` hook.\n\n### Backend Architecture (Express + PostgreSQL)\n\n**Server:** Express.js server with TypeScript, serving as API backend and static file host for web builds.\n\n**Database:** PostgreSQL with Drizzle ORM for schema management and type-safe queries. Schema defined in `shared/schema.ts` with Zod validation via `drizzle-zod`.\n\n**Storage Layer:** Abstracted storage interface (`server/storage.ts`) with in-memory implementation. Designed for easy swap to database-backed storage.\n\n**API Pattern:** RESTful routes registered in `server/routes.ts`, all prefixed with `/api`.\n\n### Data Flow\n\n1. Client uses TanStack Query for server state management\n2. API requests go through `client/lib/query-client.ts` with automatic URL resolution\n3. Server routes handle business logic and delegate to storage layer\n4. Drizzle ORM manages database operations with type safety\n\n### Authentication Design\n\n**Local Identity Only:** No traditional authentication. Users create local profiles with:\n- Name (required)\n- Optional profile photo\n- Auto-generated local user ID\n- QR code for family member connections\n\nFamily connections established via QR code scanning rather than account-based auth.\n\n## External Dependencies\n\n### Core Framework\n- **Expo SDK 54:** Mobile development platform with managed workflow\n- **React Native 0.81:** Cross-platform UI framework\n- **React Navigation 7:** Navigation library with native stack and bottom tabs\n\n### Database & API\n- **PostgreSQL:** Primary database (configured via `DATABASE_URL` environment variable)\n- **Drizzle ORM:** Type-safe SQL query builder and schema management\n- **Express 4:** HTTP server framework\n\n### UI & Animation\n- **React Native Reanimated:** Gesture-based animations\n- **React Native Gesture Handler:** Touch gesture system\n- **Expo Image Picker:** Camera/gallery access for profile photos\n- **Expo Haptics:** Tactile feedback on native platforms\n- **Expo Blur/Glass Effect:** Visual effects for headers\n\n### State & Data\n- **TanStack Query:** Server state management and caching\n- **Zod:** Runtime type validation\n\n### Development\n- **TypeScript:** Type safety across client and server\n- **tsx:** TypeScript execution for development server\n- **Drizzle Kit:** Database migration tooling","path":null,"size_bytes":3935,"size_tokens":null},"eslint.config.js":{"content":"// https://docs.expo.dev/guides/using-eslint/\nconst { defineConfig } = require(\"eslint/config\");\nconst expoConfig = require(\"eslint-config-expo/flat\");\nconst eslintPluginPrettierRecommended = require(\"eslint-plugin-prettier/recommended\");\n\nmodule.exports = defineConfig([\n  expoConfig,\n  eslintPluginPrettierRecommended,\n  {\n    ignores: [\"dist/*\"],\n  },\n]);\n","path":null,"size_bytes":359,"size_tokens":null},"client/components/ErrorBoundary.tsx":{"content":"import React, { Component, ComponentType, PropsWithChildren } from \"react\";\nimport { ErrorFallback, ErrorFallbackProps } from \"@/components/ErrorFallback\";\n\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  FallbackComponent?: ComponentType<ErrorFallbackProps>;\n  onError?: (error: Error, stackTrace: string) => void;\n}>;\n\ntype ErrorBoundaryState = { error: Error | null };\n\n/**\n * This is a special case for for using the class components. Error boundaries must be class components because React only provides error boundary functionality through lifecycle methods (componentDidCatch and getDerivedStateFromError) which are not available in functional components.\n * https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\n */\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  state: ErrorBoundaryState = { error: null };\n\n  static defaultProps: {\n    FallbackComponent: ComponentType<ErrorFallbackProps>;\n  } = {\n    FallbackComponent: ErrorFallback,\n  };\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, info: { componentStack: string }): void {\n    if (typeof this.props.onError === \"function\") {\n      this.props.onError(error, info.componentStack);\n    }\n  }\n\n  resetError = (): void => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    const { FallbackComponent } = this.props;\n\n    return this.state.error && FallbackComponent ? (\n      <FallbackComponent\n        error={this.state.error}\n        resetError={this.resetError}\n      />\n    ) : (\n      this.props.children\n    );\n  }\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"client/components/ErrorFallback.tsx":{"content":"import React, { useState } from \"react\";\nimport { reloadAppAsync } from \"expo\";\nimport {\n  StyleSheet,\n  View,\n  Pressable,\n  ScrollView,\n  Text,\n  Modal,\n} from \"react-native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Spacing, BorderRadius, Fonts } from \"@/constants/theme\";\n\nexport type ErrorFallbackProps = {\n  error: Error;\n  resetError: () => void;\n};\n\nexport function ErrorFallback({ error, resetError }: ErrorFallbackProps) {\n  const { theme } = useTheme();\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const handleRestart = async () => {\n    try {\n      await reloadAppAsync();\n    } catch (restartError) {\n      console.error(\"Failed to restart app:\", restartError);\n      resetError();\n    }\n  };\n\n  const formatErrorDetails = (): string => {\n    let details = `Error: ${error.message}\\n\\n`;\n    if (error.stack) {\n      details += `Stack Trace:\\n${error.stack}`;\n    }\n    return details;\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      {__DEV__ ? (\n        <Pressable\n          onPress={() => setIsModalVisible(true)}\n          style={({ pressed }) => [\n            styles.topButton,\n            {\n              backgroundColor: theme.backgroundDefault,\n              opacity: pressed ? 0.8 : 1,\n            },\n          ]}\n        >\n          <Feather name=\"alert-circle\" size={20} color={theme.text} />\n        </Pressable>\n      ) : null}\n\n      <View style={styles.content}>\n        <ThemedText type=\"h1\" style={styles.title}>\n          Oops! BringIt hit a snag\n        </ThemedText>\n\n        <ThemedText type=\"body\" style={styles.message}>\n          Something unexpected happened. Please restart to continue coordinating with your family.\n        </ThemedText>\n\n        <Pressable\n          onPress={handleRestart}\n          style={({ pressed }) => [\n            styles.button,\n            {\n              backgroundColor: theme.link,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <ThemedText\n            type=\"body\"\n            style={[styles.buttonText, { color: theme.buttonText }]}\n          >\n            Restart BringIt\n          </ThemedText>\n        </Pressable>\n      </View>\n\n      {__DEV__ ? (\n        <Modal\n          visible={isModalVisible}\n          animationType=\"slide\"\n          transparent={true}\n          onRequestClose={() => setIsModalVisible(false)}\n        >\n          <View style={styles.modalOverlay}>\n            <ThemedView style={styles.modalContainer}>\n              <View style={styles.modalHeader}>\n                <ThemedText type=\"h2\" style={styles.modalTitle}>\n                  Error Details\n                </ThemedText>\n                <Pressable\n                  onPress={() => setIsModalVisible(false)}\n                  style={({ pressed }) => [\n                    styles.closeButton,\n                    { opacity: pressed ? 0.6 : 1 },\n                  ]}\n                >\n                  <Feather name=\"x\" size={24} color={theme.text} />\n                </Pressable>\n              </View>\n\n              <ScrollView\n                style={styles.modalScrollView}\n                contentContainerStyle={styles.modalScrollContent}\n                showsVerticalScrollIndicator\n              >\n                <View\n                  style={[\n                    styles.errorContainer,\n                    { backgroundColor: theme.backgroundDefault },\n                  ]}\n                >\n                  <Text\n                    style={[\n                      styles.errorText,\n                      {\n                        color: theme.text,\n                        fontFamily: Fonts?.mono || \"monospace\",\n                      },\n                    ]}\n                    selectable\n                  >\n                    {formatErrorDetails()}\n                  </Text>\n                </View>\n              </ScrollView>\n            </ThemedView>\n          </View>\n        </Modal>\n      ) : null}\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    width: \"100%\",\n    height: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing[\"2xl\"],\n  },\n  content: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: Spacing.lg,\n    width: \"100%\",\n    maxWidth: 600,\n  },\n  title: {\n    textAlign: \"center\",\n    lineHeight: 40,\n  },\n  message: {\n    textAlign: \"center\",\n    opacity: 0.7,\n    lineHeight: 24,\n  },\n  topButton: {\n    position: \"absolute\",\n    top: Spacing[\"2xl\"] + Spacing.lg,\n    right: Spacing.lg,\n    width: 44,\n    height: 44,\n    borderRadius: BorderRadius.md,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 10,\n  },\n  button: {\n    paddingVertical: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    paddingHorizontal: Spacing[\"2xl\"],\n    minWidth: 200,\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n    textAlign: \"center\",\n    fontSize: 16,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  modalContainer: {\n    width: \"100%\",\n    height: \"90%\",\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.lg,\n    paddingTop: Spacing.lg,\n    paddingBottom: Spacing.md,\n    borderBottomWidth: 1,\n    borderBottomColor: \"rgba(128, 128, 128, 0.2)\",\n  },\n  modalTitle: {\n    fontWeight: \"600\",\n  },\n  closeButton: {\n    padding: Spacing.xs,\n  },\n  modalScrollView: {\n    flex: 1,\n  },\n  modalScrollContent: {\n    padding: Spacing.lg,\n  },\n  errorContainer: {\n    width: \"100%\",\n    borderRadius: BorderRadius.md,\n    overflow: \"hidden\",\n    padding: Spacing.lg,\n  },\n  errorText: {\n    fontSize: 12,\n    lineHeight: 18,\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":6258,"size_tokens":null},"client/components/HeaderTitle.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Image } from \"react-native\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Spacing } from \"@/constants/theme\";\n\ninterface HeaderTitleProps {\n  title?: string;\n}\n\nexport function HeaderTitle({ title = \"BringIt\" }: HeaderTitleProps) {\n  return (\n    <View style={styles.container}>\n      <Image\n        source={require(\"../../assets/images/icon.png\")}\n        style={styles.icon}\n        resizeMode=\"contain\"\n      />\n      <ThemedText style={styles.title}>{title}</ThemedText>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"flex-start\",\n  },\n  icon: {\n    width: 28,\n    height: 28,\n    marginRight: Spacing.sm,\n  },\n  title: {\n    fontSize: 17,\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":845,"size_tokens":null},"client/constants/theme.ts":{"content":"import { Platform } from \"react-native\";\n\nconst primaryColor = \"#4A90E2\";\nconst primaryDark = \"#357ABD\";\nconst secondaryColor = \"#7B68EE\";\nconst accentColor = \"#50C878\";\n\nexport const Colors = {\n  light: {\n    text: \"#1A1A1A\",\n    textSecondary: \"#6A737D\",\n    textTertiary: \"#959DA5\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#6A737D\",\n    tabIconSelected: primaryColor,\n    link: primaryColor,\n    primary: primaryColor,\n    primaryDark: primaryDark,\n    secondary: secondaryColor,\n    accent: accentColor,\n    backgroundRoot: \"#FFFFFF\",\n    backgroundDefault: \"#F8F9FA\",\n    backgroundSecondary: \"#E1E4E8\",\n    backgroundTertiary: \"#D9D9D9\",\n    border: \"#E1E4E8\",\n    statusPending: \"#FFA726\",\n    statusInProgress: \"#42A5F5\",\n    statusCompleted: \"#50C878\",\n    statusError: \"#EF5350\",\n  },\n  dark: {\n    text: \"#ECEDEE\",\n    textSecondary: \"#9BA1A6\",\n    textTertiary: \"#6A737D\",\n    buttonText: \"#FFFFFF\",\n    tabIconDefault: \"#9BA1A6\",\n    tabIconSelected: primaryColor,\n    link: primaryColor,\n    primary: primaryColor,\n    primaryDark: primaryDark,\n    secondary: secondaryColor,\n    accent: accentColor,\n    backgroundRoot: \"#1F2123\",\n    backgroundDefault: \"#2A2C2E\",\n    backgroundSecondary: \"#353739\",\n    backgroundTertiary: \"#404244\",\n    border: \"#404244\",\n    statusPending: \"#FFA726\",\n    statusInProgress: \"#42A5F5\",\n    statusCompleted: \"#50C878\",\n    statusError: \"#EF5350\",\n  },\n};\n\nexport const Spacing = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 24,\n  \"2xl\": 32,\n  \"3xl\": 40,\n  \"4xl\": 48,\n  \"5xl\": 56,\n  inputHeight: 48,\n  buttonHeight: 48,\n};\n\nexport const BorderRadius = {\n  xs: 4,\n  sm: 8,\n  md: 12,\n  lg: 16,\n  xl: 24,\n  \"2xl\": 28,\n  \"3xl\": 50,\n  full: 9999,\n};\n\nexport const Typography = {\n  h1: {\n    fontSize: 28,\n    fontWeight: \"700\" as const,\n  },\n  h2: {\n    fontSize: 22,\n    fontWeight: \"600\" as const,\n  },\n  h3: {\n    fontSize: 18,\n    fontWeight: \"600\" as const,\n  },\n  h4: {\n    fontSize: 16,\n    fontWeight: \"600\" as const,\n  },\n  body: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n  small: {\n    fontSize: 14,\n    fontWeight: \"400\" as const,\n  },\n  caption: {\n    fontSize: 12,\n    fontWeight: \"400\" as const,\n  },\n  link: {\n    fontSize: 16,\n    fontWeight: \"400\" as const,\n  },\n};\n\nexport const Fonts = Platform.select({\n  ios: {\n    sans: \"system-ui\",\n    serif: \"ui-serif\",\n    rounded: \"ui-rounded\",\n    mono: \"ui-monospace\",\n  },\n  default: {\n    sans: \"normal\",\n    serif: \"serif\",\n    rounded: \"normal\",\n    mono: \"monospace\",\n  },\n  web: {\n    sans: \"system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif\",\n    serif: \"Georgia, 'Times New Roman', serif\",\n    rounded:\n      \"'SF Pro Rounded', 'Hiragino Maru Gothic ProN', Meiryo, 'MS PGothic', sans-serif\",\n    mono: \"SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\",\n  },\n});\n","path":null,"size_bytes":2882,"size_tokens":null},"client/hooks/useColorScheme.web.ts":{"content":"import { useEffect, useState } from \"react\";\nimport { useColorScheme as useRNColorScheme } from \"react-native\";\n\n/**\n * To support static rendering, this value needs to be re-calculated on the client side for web\n */\nexport function useColorScheme() {\n  const [hasHydrated, setHasHydrated] = useState(false);\n\n  useEffect(() => {\n    setHasHydrated(true);\n  }, []);\n\n  const colorScheme = useRNColorScheme();\n\n  if (hasHydrated) {\n    return colorScheme;\n  }\n\n  return \"light\";\n}\n","path":null,"size_bytes":480,"size_tokens":null},"client/lib/query-client.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * Gets the base URL for the Express API server (e.g., \"http://localhost:3000\")\n * @returns {string} The API base URL\n */\nexport function getApiUrl(): string {\n  let host = process.env.EXPO_PUBLIC_DOMAIN;\n\n  if (!host) {\n    throw new Error(\"EXPO_PUBLIC_DOMAIN is not set\");\n  }\n\n  let url = new URL(`https://${host}`);\n\n  return url.href;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  route: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const baseUrl = getApiUrl();\n  const url = new URL(route, baseUrl);\n\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const baseUrl = getApiUrl();\n    const url = new URL(queryKey.join(\"/\") as string, baseUrl);\n\n    const res = await fetch(url, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1876,"size_tokens":null},"client/lib/store.ts":{"content":"import { registerAppUser as registerAppUserApi, createTask as createTaskApi, getTasksForUser, completeTask as completeTaskApi, ServerTask } from \"./api\";\n\nexport type UserRole = 'parent' | 'child';\n\nexport interface User {\n  id: string;\n  name: string;\n  role: UserRole;\n  avatarSvg: string | null;\n  createdAt: number;\n}\n\nexport interface FamilyMember {\n  id: string;\n  userId: string;\n  name: string;\n  role: UserRole;\n  avatarSvg: string | null;\n  connectedAt: number;\n  status: 'pending' | 'accepted';\n}\n\nexport interface ConnectionRequest {\n  id: string;\n  fromUserId: string;\n  fromUserName: string;\n  fromUserRole: UserRole;\n  fromUserAvatar: string | null;\n  toUserId: string;\n  toUserName: string;\n  toUserRole: UserRole;\n  toUserAvatar: string | null;\n  createdAt: number;\n}\n\nexport interface SavedItem {\n  id: string;\n  svgData: string;\n  name: string | null;\n  lastNote: string | null;\n  lastUsedAt: number;\n  createdAt: number;\n}\n\nexport interface Task {\n  id: string;\n  itemId: string;\n  itemSvgData: string;\n  itemName: string | null;\n  quantity: number;\n  note: string | null;\n  assignedToId: string;\n  assignedToName: string;\n  assignedById: string;\n  assignedByName: string;\n  status: 'pending' | 'completed';\n  createdAt: number;\n  completedAt: number | null;\n}\n\nexport interface Notification {\n  id: string;\n  type: 'task_completed';\n  taskId: string;\n  itemName: string | null;\n  completedByName: string;\n  read: boolean;\n  createdAt: number;\n}\n\nexport interface OrderItem {\n  id: string;\n  savedItemId: string;\n  svgData: string;\n  name: string | null;\n  quantity: number;\n  note: string | null;\n  completed: boolean;\n  clarificationNote: string | null;\n  replacementSvg: string | null;\n}\n\nexport interface Order {\n  id: string;\n  senderId: string;\n  senderName: string;\n  receiverId: string;\n  receiverName: string;\n  items: OrderItem[];\n  status: 'pending' | 'in_progress' | 'completed';\n  createdAt: number;\n  completedAt: number | null;\n}\n\nexport interface AppState {\n  currentUser: User | null;\n  familyMembers: FamilyMember[];\n  savedItems: SavedItem[];\n  tasks: Task[];\n  notifications: Notification[];\n  orders: Order[];\n  pendingConnections: FamilyMember[];\n  registeredUsers: User[];\n  incomingRequests: ConnectionRequest[];\n  outgoingRequests: ConnectionRequest[];\n  seenTaskIds: Set<string>;\n}\n\nlet state: AppState = {\n  currentUser: null,\n  familyMembers: [],\n  savedItems: [],\n  tasks: [],\n  notifications: [],\n  orders: [],\n  pendingConnections: [],\n  registeredUsers: [],\n  incomingRequests: [],\n  outgoingRequests: [],\n  seenTaskIds: new Set(),\n};\n\nlet listeners: (() => void)[] = [];\n\nexport function getState(): AppState {\n  return state;\n}\n\nexport function subscribe(listener: () => void): () => void {\n  listeners.push(listener);\n  return () => {\n    listeners = listeners.filter(l => l !== listener);\n  };\n}\n\nfunction notifyListeners() {\n  listeners.forEach(l => l());\n}\n\nfunction generateId(): string {\n  // Generate 8-character alphanumeric ID (matches what's shown in UI)\n  const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';\n  let result = '';\n  for (let i = 0; i < 8; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\nexport async function createUser(name: string, role: UserRole, avatarSvg: string | null): Promise<User> {\n  const user: User = {\n    id: generateId(),\n    name,\n    role,\n    avatarSvg,\n    createdAt: Date.now(),\n  };\n  \n  // Register on server for cross-device discovery\n  try {\n    await registerAppUserApi({\n      id: user.id,\n      name: user.name,\n      role: user.role,\n      avatarSvg: user.avatarSvg,\n    });\n  } catch (error) {\n    console.error(\"Failed to register user on server:\", error);\n  }\n  \n  state = { \n    ...state, \n    currentUser: user,\n    registeredUsers: [...state.registeredUsers, user],\n  };\n  notifyListeners();\n  return user;\n}\n\nexport function findUserByCode(code: string): User | null {\n  const normalizedCode = code.trim().toLowerCase();\n  return state.registeredUsers.find(u => \n    u.id.toLowerCase().startsWith(normalizedCode) ||\n    u.id.toLowerCase() === normalizedCode\n  ) || null;\n}\n\nexport function sendConnectionRequest(toUserId: string): ConnectionRequest | null {\n  if (!state.currentUser) return null;\n  \n  const targetUser = state.registeredUsers.find(u => u.id === toUserId);\n  if (!targetUser) return null;\n  \n  const existingRequest = state.outgoingRequests.find(r => r.toUserId === toUserId);\n  if (existingRequest) return null;\n  \n  const alreadyConnected = state.familyMembers.find(m => m.userId === toUserId);\n  if (alreadyConnected) return null;\n  \n  const request: ConnectionRequest = {\n    id: generateId(),\n    fromUserId: state.currentUser.id,\n    fromUserName: state.currentUser.name,\n    fromUserRole: state.currentUser.role,\n    fromUserAvatar: state.currentUser.avatarSvg,\n    toUserId: targetUser.id,\n    toUserName: targetUser.name,\n    toUserRole: targetUser.role,\n    toUserAvatar: targetUser.avatarSvg,\n    createdAt: Date.now(),\n  };\n  \n  state = { \n    ...state, \n    outgoingRequests: [...state.outgoingRequests, request],\n    incomingRequests: [...state.incomingRequests, request],\n  };\n  notifyListeners();\n  return request;\n}\n\nexport function sendConnectionRequestByCode(code: string): ConnectionRequest | null {\n  if (!state.currentUser) return null;\n  \n  const normalizedCode = code.trim();\n  if (!normalizedCode) return null;\n  \n  if (normalizedCode === state.currentUser.id) return null;\n  \n  const existingRequest = state.outgoingRequests.find(r => r.toUserId === normalizedCode);\n  if (existingRequest) return null;\n  \n  const alreadyConnected = state.familyMembers.find(m => m.userId === normalizedCode);\n  if (alreadyConnected) return null;\n  \n  const knownUser = state.registeredUsers.find(u => u.id === normalizedCode);\n  \n  const request: ConnectionRequest = {\n    id: generateId(),\n    fromUserId: state.currentUser.id,\n    fromUserName: state.currentUser.name,\n    fromUserRole: state.currentUser.role,\n    fromUserAvatar: state.currentUser.avatarSvg,\n    toUserId: normalizedCode,\n    toUserName: knownUser?.name || \"Family Member\",\n    toUserRole: knownUser?.role || (state.currentUser.role === 'parent' ? 'child' : 'parent'),\n    toUserAvatar: knownUser?.avatarSvg || null,\n    createdAt: Date.now(),\n  };\n  \n  state = { \n    ...state, \n    outgoingRequests: [...state.outgoingRequests, request],\n    incomingRequests: [...state.incomingRequests, request],\n  };\n  notifyListeners();\n  return request;\n}\n\nexport function acceptConnectionRequest(requestId: string): void {\n  const request = state.incomingRequests.find(r => r.id === requestId);\n  if (!request) return;\n  if (!state.currentUser) return;\n  if (request.toUserId !== state.currentUser.id) return;\n  \n  const connectionTime = Date.now();\n  \n  const memberForAcceptor: FamilyMember = {\n    id: generateId(),\n    userId: request.fromUserId,\n    name: request.fromUserName,\n    role: request.fromUserRole,\n    avatarSvg: request.fromUserAvatar,\n    connectedAt: connectionTime,\n    status: 'accepted',\n  };\n  \n  const memberForRequester: FamilyMember = {\n    id: generateId(),\n    userId: request.toUserId,\n    name: request.toUserName,\n    role: request.toUserRole,\n    avatarSvg: request.toUserAvatar,\n    connectedAt: connectionTime,\n    status: 'accepted',\n  };\n  \n  state = {\n    ...state,\n    familyMembers: [...state.familyMembers, memberForAcceptor, memberForRequester],\n    incomingRequests: state.incomingRequests.filter(r => r.id !== requestId),\n    outgoingRequests: state.outgoingRequests.filter(r => r.id !== requestId),\n  };\n  notifyListeners();\n}\n\nexport function rejectConnectionRequest(requestId: string): void {\n  state = {\n    ...state,\n    incomingRequests: state.incomingRequests.filter(r => r.id !== requestId),\n    outgoingRequests: state.outgoingRequests.filter(r => r.id !== requestId),\n  };\n  notifyListeners();\n}\n\nexport function getIncomingRequestsForCurrentUser(): ConnectionRequest[] {\n  if (!state.currentUser) return [];\n  return state.incomingRequests.filter(r => r.toUserId === state.currentUser!.id);\n}\n\nexport function getOutgoingRequestsForCurrentUser(): ConnectionRequest[] {\n  if (!state.currentUser) return [];\n  return state.outgoingRequests.filter(r => r.fromUserId === state.currentUser!.id);\n}\n\nexport function getFamilyMembersForCurrentUser(): FamilyMember[] {\n  if (!state.currentUser) return [];\n  return state.familyMembers.filter(m => \n    m.userId !== state.currentUser!.id && m.status === 'accepted'\n  );\n}\n\nexport function updateUser(updates: Partial<Pick<User, 'name' | 'avatarSvg'>>): User | null {\n  if (!state.currentUser) return null;\n  state = {\n    ...state,\n    currentUser: { ...state.currentUser, ...updates },\n  };\n  notifyListeners();\n  return state.currentUser;\n}\n\nexport function addFamilyMember(member: Omit<FamilyMember, 'id' | 'connectedAt'>): FamilyMember {\n  const newMember: FamilyMember = {\n    ...member,\n    id: generateId(),\n    connectedAt: Date.now(),\n  };\n  state = { ...state, familyMembers: [...state.familyMembers, newMember] };\n  notifyListeners();\n  return newMember;\n}\n\nexport function acceptConnection(memberId: string): void {\n  const pending = state.pendingConnections.find(m => m.id === memberId);\n  if (pending) {\n    const acceptedMember: FamilyMember = {\n      ...pending,\n      status: 'accepted',\n      connectedAt: Date.now(),\n    };\n    state = {\n      ...state,\n      familyMembers: [...state.familyMembers, acceptedMember],\n      pendingConnections: state.pendingConnections.filter(m => m.id !== memberId),\n    };\n  } else {\n    state = {\n      ...state,\n      familyMembers: state.familyMembers.map(m =>\n        m.id === memberId ? { ...m, status: 'accepted' as const } : m\n      ),\n    };\n  }\n  notifyListeners();\n}\n\nexport function addPendingConnection(member: Omit<FamilyMember, 'id' | 'connectedAt' | 'status'>): FamilyMember {\n  const newMember: FamilyMember = {\n    ...member,\n    id: generateId(),\n    connectedAt: Date.now(),\n    status: 'pending',\n  };\n  state = { ...state, pendingConnections: [...state.pendingConnections, newMember] };\n  notifyListeners();\n  return newMember;\n}\n\nexport function removeFamilyMember(memberId: string): void {\n  state = {\n    ...state,\n    familyMembers: state.familyMembers.filter(m => m.id !== memberId),\n  };\n  notifyListeners();\n}\n\nexport function removePendingConnection(memberId: string): void {\n  state = {\n    ...state,\n    pendingConnections: state.pendingConnections.filter(m => m.id !== memberId),\n  };\n  notifyListeners();\n}\n\nexport function addSavedItem(item: Omit<SavedItem, 'id' | 'createdAt' | 'lastUsedAt'>): SavedItem {\n  const newItem: SavedItem = {\n    ...item,\n    id: generateId(),\n    createdAt: Date.now(),\n    lastUsedAt: Date.now(),\n  };\n  state = { ...state, savedItems: [...state.savedItems, newItem] };\n  notifyListeners();\n  return newItem;\n}\n\nexport function updateSavedItem(itemId: string, updates: Partial<Pick<SavedItem, 'name' | 'lastNote'>>): SavedItem | null {\n  const item = state.savedItems.find(i => i.id === itemId);\n  if (!item) return null;\n  const updated = { ...item, ...updates };\n  state = {\n    ...state,\n    savedItems: state.savedItems.map(i => i.id === itemId ? updated : i),\n  };\n  notifyListeners();\n  return updated;\n}\n\nexport function removeSavedItem(itemId: string): void {\n  state = {\n    ...state,\n    savedItems: state.savedItems.filter(i => i.id !== itemId),\n  };\n  notifyListeners();\n}\n\nexport async function assignTask(\n  item: SavedItem,\n  assignedToId: string,\n  assignedToName: string,\n  quantity: number = 1,\n  note: string | null = null\n): Promise<Task | null> {\n  if (!state.currentUser) return null;\n  if (state.currentUser.role !== 'parent') return null;\n  \n  const taskData = {\n    itemId: item.id,\n    itemSvgData: item.svgData,\n    itemName: item.name,\n    quantity,\n    note,\n    assignedToId,\n    assignedToName,\n    assignedById: state.currentUser.id,\n    assignedByName: state.currentUser.name,\n  };\n  \n  const serverTask = await createTaskApi(taskData);\n  if (!serverTask) return null;\n  \n  const task: Task = {\n    id: serverTask.id.toString(),\n    itemId: serverTask.itemId,\n    itemSvgData: serverTask.itemSvgData,\n    itemName: serverTask.itemName,\n    quantity: serverTask.quantity,\n    note: serverTask.note,\n    assignedToId: serverTask.assignedToId,\n    assignedToName: serverTask.assignedToName,\n    assignedById: serverTask.assignedById,\n    assignedByName: serverTask.assignedByName,\n    status: serverTask.status as 'pending' | 'completed',\n    createdAt: new Date(serverTask.createdAt).getTime(),\n    completedAt: serverTask.completedAt ? new Date(serverTask.completedAt).getTime() : null,\n  };\n  \n  state = { ...state, tasks: [...state.tasks, task] };\n  notifyListeners();\n  return task;\n}\n\nexport async function markTaskDone(taskId: string): Promise<void> {\n  if (!state.currentUser) return;\n  if (state.currentUser.role !== 'child') return;\n  \n  const task = state.tasks.find(t => t.id === taskId);\n  if (!task) return;\n  if (task.assignedToId !== state.currentUser.id) return;\n  \n  const serverTask = await completeTaskApi(parseInt(taskId));\n  if (!serverTask) return;\n  \n  state = {\n    ...state,\n    tasks: state.tasks.map(t =>\n      t.id === taskId\n        ? { ...t, status: 'completed' as const, completedAt: Date.now() }\n        : t\n    ),\n  };\n  \n  const notification: Notification = {\n    id: generateId(),\n    type: 'task_completed',\n    taskId,\n    itemName: task.itemName,\n    completedByName: state.currentUser!.name,\n    read: false,\n    createdAt: Date.now(),\n  };\n  state = { ...state, notifications: [...state.notifications, notification] };\n  \n  notifyListeners();\n}\n\nexport async function loadTasksFromServer(userId: string): Promise<{ newlyCompleted: Task[] }> {\n  const serverTasks = await getTasksForUser(userId);\n  const fetchedTasks: Task[] = serverTasks.map(st => ({\n    id: st.id.toString(),\n    itemId: st.itemId,\n    itemSvgData: st.itemSvgData,\n    itemName: st.itemName,\n    quantity: st.quantity,\n    note: st.note,\n    assignedToId: st.assignedToId,\n    assignedToName: st.assignedToName,\n    assignedById: st.assignedById,\n    assignedByName: st.assignedByName,\n    status: st.status as 'pending' | 'completed',\n    createdAt: new Date(st.createdAt).getTime(),\n    completedAt: st.completedAt ? new Date(st.completedAt).getTime() : null,\n  }));\n  \n  const existingTasksMap = new Map(state.tasks.map(t => [t.id, t]));\n  const newlyCompleted: Task[] = [];\n  \n  for (const task of fetchedTasks) {\n    const existing = existingTasksMap.get(task.id);\n    if (existing && existing.status === 'pending' && task.status === 'completed') {\n      newlyCompleted.push(task);\n    }\n  }\n  \n  const fetchedTaskIds = new Set(fetchedTasks.map(t => t.id));\n  const otherTasks = state.tasks.filter(t => !fetchedTaskIds.has(t.id));\n  const mergedTasks = [...otherTasks, ...fetchedTasks];\n  state = { ...state, tasks: mergedTasks };\n  notifyListeners();\n  \n  return { newlyCompleted };\n}\n\nexport function markNotificationRead(notificationId: string): void {\n  state = {\n    ...state,\n    notifications: state.notifications.map(n =>\n      n.id === notificationId ? { ...n, read: true } : n\n    ),\n  };\n  notifyListeners();\n}\n\nexport function markAllNotificationsRead(): void {\n  state = {\n    ...state,\n    notifications: state.notifications.map(n => ({ ...n, read: true })),\n  };\n  notifyListeners();\n}\n\nexport function getUnreadNotificationCount(): number {\n  return state.notifications.filter(n => !n.read).length;\n}\n\nexport function getChildTasks(childId: string): Task[] {\n  return state.tasks.filter(t => t.assignedToId === childId && t.status === 'pending');\n}\n\nexport function getChildCompletedTasks(childId: string): Task[] {\n  return state.tasks.filter(t => t.assignedToId === childId && t.status === 'completed');\n}\n\nexport function getParentAssignedTasks(parentId: string): Task[] {\n  return state.tasks.filter(t => t.assignedById === parentId);\n}\n\nexport function createOrder(\n  receiverId: string,\n  receiverName: string,\n  items: Omit<OrderItem, 'id' | 'completed' | 'clarificationNote' | 'replacementSvg'>[]\n): Order | null {\n  if (!state.currentUser) return null;\n  \n  const order: Order = {\n    id: generateId(),\n    senderId: state.currentUser.id,\n    senderName: state.currentUser.name,\n    receiverId,\n    receiverName,\n    items: items.map(item => ({\n      ...item,\n      id: generateId(),\n      completed: false,\n      clarificationNote: null,\n      replacementSvg: null,\n    })),\n    status: 'pending',\n    createdAt: Date.now(),\n    completedAt: null,\n  };\n  state = { ...state, orders: [...state.orders, order] };\n  notifyListeners();\n  return order;\n}\n\nexport function markItemCompleted(orderId: string, itemId: string, clarificationNote?: string, replacementSvg?: string): void {\n  state = {\n    ...state,\n    orders: state.orders.map(order => {\n      if (order.id !== orderId) return order;\n      const updatedItems = order.items.map(item =>\n        item.id === itemId\n          ? {\n              ...item,\n              completed: true,\n              clarificationNote: clarificationNote || null,\n              replacementSvg: replacementSvg || null,\n            }\n          : item\n      );\n      const allCompleted = updatedItems.every(i => i.completed);\n      const someCompleted = updatedItems.some(i => i.completed);\n      return {\n        ...order,\n        items: updatedItems,\n        status: allCompleted ? 'completed' as const : someCompleted ? 'in_progress' as const : 'pending' as const,\n      };\n    }),\n  };\n  notifyListeners();\n}\n\nexport function completeOrder(orderId: string): void {\n  state = {\n    ...state,\n    orders: state.orders.map(order =>\n      order.id === orderId\n        ? { ...order, status: 'completed' as const, completedAt: Date.now() }\n        : order\n    ),\n  };\n  notifyListeners();\n}\n\nexport function deleteOrder(orderId: string): void {\n  state = {\n    ...state,\n    orders: state.orders.filter(o => o.id !== orderId),\n  };\n  notifyListeners();\n}\n\nexport function getUnseenPendingTaskCount(): number {\n  if (!state.currentUser) return 0;\n  const pendingTasks = state.tasks.filter(t => \n    t.assignedToId === state.currentUser!.id && t.status === 'pending'\n  );\n  return pendingTasks.filter(t => !state.seenTaskIds.has(t.id)).length;\n}\n\nexport function markTasksAsSeen(): void {\n  if (!state.currentUser) return;\n  const pendingTasks = state.tasks.filter(t => \n    t.assignedToId === state.currentUser!.id && t.status === 'pending'\n  );\n  const newSeenIds = new Set(state.seenTaskIds);\n  pendingTasks.forEach(t => newSeenIds.add(t.id));\n  state = { ...state, seenTaskIds: newSeenIds };\n  notifyListeners();\n}\n\nexport function useStore(): AppState {\n  return state;\n}\n\nexport function useStoreWithSubscription(): [AppState, () => void] {\n  return [state, notifyListeners];\n}\n","path":null,"size_bytes":18851,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"node:http\";\nimport { db } from \"./db\";\nimport { deviceTokens, familyConnections, appUsers, connectionRequests, tasks } from \"@shared/schema\";\nimport { eq, and, or } from \"drizzle-orm\";\nimport { sendPushNotification } from \"./firebase\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Register or update app user (called when user creates profile)\n  app.post(\"/api/app-users\", async (req, res) => {\n    try {\n      const { id, name, role, avatarSvg } = req.body;\n      \n      if (!id || !name || !role) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const existingUser = await db.select()\n        .from(appUsers)\n        .where(eq(appUsers.id, id))\n        .limit(1);\n\n      if (existingUser.length > 0) {\n        await db.update(appUsers)\n          .set({ name, role, avatarSvg })\n          .where(eq(appUsers.id, id));\n      } else {\n        await db.insert(appUsers).values({\n          id,\n          name,\n          role,\n          avatarSvg,\n        });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error registering app user:\", error);\n      res.status(500).json({ error: \"Failed to register app user\" });\n    }\n  });\n\n  // Get user by ID (validate code exists)\n  app.get(\"/api/app-users/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const user = await db.select()\n        .from(appUsers)\n        .where(eq(appUsers.id, id))\n        .limit(1);\n\n      if (user.length === 0) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json(user[0]);\n    } catch (error) {\n      console.error(\"Error fetching app user:\", error);\n      res.status(500).json({ error: \"Failed to fetch app user\" });\n    }\n  });\n\n  // Send connection request\n  app.post(\"/api/connection-requests\", async (req, res) => {\n    try {\n      const { fromUserId, fromUserName, fromUserRole, fromUserAvatar, toUserId } = req.body;\n      \n      if (!fromUserId || !fromUserName || !fromUserRole || !toUserId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Check if target user exists\n      const targetUser = await db.select()\n        .from(appUsers)\n        .where(eq(appUsers.id, toUserId))\n        .limit(1);\n\n      if (targetUser.length === 0) {\n        return res.status(404).json({ error: \"User code not found. Please check and try again.\" });\n      }\n\n      // Check for existing pending request\n      const existingRequest = await db.select()\n        .from(connectionRequests)\n        .where(and(\n          eq(connectionRequests.fromUserId, fromUserId),\n          eq(connectionRequests.toUserId, toUserId),\n          eq(connectionRequests.status, \"pending\")\n        ))\n        .limit(1);\n\n      if (existingRequest.length > 0) {\n        return res.status(409).json({ error: \"Request already sent\" });\n      }\n\n      // Check if already connected (request was accepted)\n      const existingConnection = await db.select()\n        .from(connectionRequests)\n        .where(and(\n          or(\n            and(eq(connectionRequests.fromUserId, fromUserId), eq(connectionRequests.toUserId, toUserId)),\n            and(eq(connectionRequests.fromUserId, toUserId), eq(connectionRequests.toUserId, fromUserId))\n          ),\n          eq(connectionRequests.status, \"accepted\")\n        ))\n        .limit(1);\n\n      if (existingConnection.length > 0) {\n        return res.status(409).json({ error: \"Already connected to this user\" });\n      }\n\n      const [newRequest] = await db.insert(connectionRequests).values({\n        fromUserId,\n        fromUserName,\n        fromUserRole,\n        fromUserAvatar: fromUserAvatar || null,\n        toUserId,\n        status: \"pending\",\n      }).returning();\n\n      res.json({ \n        success: true, \n        request: newRequest,\n        targetUser: targetUser[0]\n      });\n    } catch (error) {\n      console.error(\"Error creating connection request:\", error);\n      res.status(500).json({ error: \"Failed to create connection request\" });\n    }\n  });\n\n  // Get incoming connection requests for a user\n  app.get(\"/api/connection-requests/incoming/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const requests = await db.select()\n        .from(connectionRequests)\n        .where(and(\n          eq(connectionRequests.toUserId, userId),\n          eq(connectionRequests.status, \"pending\")\n        ));\n\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Error fetching incoming requests:\", error);\n      res.status(500).json({ error: \"Failed to fetch incoming requests\" });\n    }\n  });\n\n  // Get outgoing connection requests for a user\n  app.get(\"/api/connection-requests/outgoing/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const requests = await db.select()\n        .from(connectionRequests)\n        .where(and(\n          eq(connectionRequests.fromUserId, userId),\n          eq(connectionRequests.status, \"pending\")\n        ));\n\n      // For each request, get the target user info\n      const requestsWithTargetInfo = await Promise.all(requests.map(async (req) => {\n        const targetUser = await db.select()\n          .from(appUsers)\n          .where(eq(appUsers.id, req.toUserId))\n          .limit(1);\n        return {\n          ...req,\n          toUserName: targetUser[0]?.name || \"Unknown\",\n          toUserRole: targetUser[0]?.role || \"child\",\n          toUserAvatar: targetUser[0]?.avatarSvg || null,\n        };\n      }));\n\n      res.json(requestsWithTargetInfo);\n    } catch (error) {\n      console.error(\"Error fetching outgoing requests:\", error);\n      res.status(500).json({ error: \"Failed to fetch outgoing requests\" });\n    }\n  });\n\n  // Accept connection request\n  app.post(\"/api/connection-requests/:id/accept\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { userId } = req.body;\n      \n      const request = await db.select()\n        .from(connectionRequests)\n        .where(eq(connectionRequests.id, parseInt(id)))\n        .limit(1);\n\n      if (request.length === 0) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n\n      if (request[0].toUserId !== userId) {\n        return res.status(403).json({ error: \"Not authorized to accept this request\" });\n      }\n\n      await db.update(connectionRequests)\n        .set({ status: \"accepted\" })\n        .where(eq(connectionRequests.id, parseInt(id)));\n\n      // Get both users' info for the response\n      const fromUser = await db.select()\n        .from(appUsers)\n        .where(eq(appUsers.id, request[0].fromUserId))\n        .limit(1);\n\n      const toUser = await db.select()\n        .from(appUsers)\n        .where(eq(appUsers.id, request[0].toUserId))\n        .limit(1);\n\n      res.json({ \n        success: true,\n        fromUser: fromUser[0],\n        toUser: toUser[0]\n      });\n    } catch (error) {\n      console.error(\"Error accepting connection request:\", error);\n      res.status(500).json({ error: \"Failed to accept connection request\" });\n    }\n  });\n\n  // Reject connection request\n  app.post(\"/api/connection-requests/:id/reject\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { userId } = req.body;\n      \n      const request = await db.select()\n        .from(connectionRequests)\n        .where(eq(connectionRequests.id, parseInt(id)))\n        .limit(1);\n\n      if (request.length === 0) {\n        return res.status(404).json({ error: \"Request not found\" });\n      }\n\n      if (request[0].toUserId !== userId) {\n        return res.status(403).json({ error: \"Not authorized to reject this request\" });\n      }\n\n      await db.update(connectionRequests)\n        .set({ status: \"rejected\" })\n        .where(eq(connectionRequests.id, parseInt(id)));\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error rejecting connection request:\", error);\n      res.status(500).json({ error: \"Failed to reject connection request\" });\n    }\n  });\n\n  // Get accepted connections for a user (family members)\n  app.get(\"/api/connections/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const connections = await db.select()\n        .from(connectionRequests)\n        .where(and(\n          or(\n            eq(connectionRequests.fromUserId, userId),\n            eq(connectionRequests.toUserId, userId)\n          ),\n          eq(connectionRequests.status, \"accepted\")\n        ));\n\n      // Get user info for each connection\n      const members = await Promise.all(connections.map(async (conn) => {\n        const otherUserId = conn.fromUserId === userId ? conn.toUserId : conn.fromUserId;\n        const user = await db.select()\n          .from(appUsers)\n          .where(eq(appUsers.id, otherUserId))\n          .limit(1);\n        \n        if (user.length === 0) return null;\n        \n        return {\n          id: conn.id.toString(),\n          userId: user[0].id,\n          name: user[0].name,\n          role: user[0].role,\n          avatarSvg: user[0].avatarSvg,\n          connectedAt: conn.createdAt,\n        };\n      }));\n\n      res.json(members.filter(Boolean));\n    } catch (error) {\n      console.error(\"Error fetching connections:\", error);\n      res.status(500).json({ error: \"Failed to fetch connections\" });\n    }\n  });\n\n  app.delete(\"/api/connections/:connectionId\", async (req, res) => {\n    try {\n      const { connectionId } = req.params;\n      const { userId } = req.body;\n\n      if (!userId) {\n        return res.status(400).json({ error: \"User ID is required\" });\n      }\n\n      const connection = await db.select()\n        .from(connectionRequests)\n        .where(eq(connectionRequests.id, parseInt(connectionId)))\n        .limit(1);\n\n      if (connection.length === 0) {\n        return res.status(404).json({ error: \"Connection not found\" });\n      }\n\n      const conn = connection[0];\n      if (conn.fromUserId !== userId && conn.toUserId !== userId) {\n        return res.status(403).json({ error: \"Not authorized to delete this connection\" });\n      }\n\n      await db.delete(connectionRequests)\n        .where(eq(connectionRequests.id, parseInt(connectionId)));\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting connection:\", error);\n      res.status(500).json({ error: \"Failed to delete connection\" });\n    }\n  });\n\n  app.post(\"/api/device-tokens\", async (req, res) => {\n    try {\n      const { userId, token, platform } = req.body;\n      \n      if (!userId || !token || !platform) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const existingToken = await db.select()\n        .from(deviceTokens)\n        .where(eq(deviceTokens.token, token))\n        .limit(1);\n\n      if (existingToken.length > 0) {\n        await db.update(deviceTokens)\n          .set({ userId, platform, updatedAt: new Date() })\n          .where(eq(deviceTokens.token, token));\n      } else {\n        await db.insert(deviceTokens).values({\n          userId,\n          token,\n          platform,\n        });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error registering device token:\", error);\n      res.status(500).json({ error: \"Failed to register device token\" });\n    }\n  });\n\n  app.delete(\"/api/device-tokens\", async (req, res) => {\n    try {\n      const { token } = req.body;\n      \n      if (!token) {\n        return res.status(400).json({ error: \"Token is required\" });\n      }\n\n      await db.delete(deviceTokens).where(eq(deviceTokens.token, token));\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error removing device token:\", error);\n      res.status(500).json({ error: \"Failed to remove device token\" });\n    }\n  });\n\n  app.post(\"/api/family-connections\", async (req, res) => {\n    try {\n      const { parentId, childId, childName } = req.body;\n      \n      if (!parentId || !childId || !childName) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const existing = await db.select()\n        .from(familyConnections)\n        .where(and(\n          eq(familyConnections.parentId, parentId),\n          eq(familyConnections.childId, childId)\n        ))\n        .limit(1);\n\n      if (existing.length === 0) {\n        await db.insert(familyConnections).values({\n          parentId,\n          childId,\n          childName,\n        });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error creating family connection:\", error);\n      res.status(500).json({ error: \"Failed to create family connection\" });\n    }\n  });\n\n  app.get(\"/api/family-connections/:parentId\", async (req, res) => {\n    try {\n      const { parentId } = req.params;\n      \n      const connections = await db.select()\n        .from(familyConnections)\n        .where(eq(familyConnections.parentId, parentId));\n\n      res.json(connections);\n    } catch (error) {\n      console.error(\"Error fetching family connections:\", error);\n      res.status(500).json({ error: \"Failed to fetch family connections\" });\n    }\n  });\n\n  app.post(\"/api/notifications/send\", async (req, res) => {\n    try {\n      const { parentId, title, body, data } = req.body;\n      \n      if (!parentId || !title || !body) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const children = await db.select()\n        .from(familyConnections)\n        .where(eq(familyConnections.parentId, parentId));\n\n      if (children.length === 0) {\n        return res.json({ success: true, message: \"No family members to notify\" });\n      }\n\n      const childIds = children.map(c => c.childId);\n      \n      const tokens = await db.select()\n        .from(deviceTokens)\n        .where(eq(deviceTokens.userId, childIds[0]));\n\n      const allTokens: string[] = [];\n      for (const childId of childIds) {\n        const childTokens = await db.select()\n          .from(deviceTokens)\n          .where(eq(deviceTokens.userId, childId));\n        allTokens.push(...childTokens.map(t => t.token));\n      }\n\n      if (allTokens.length === 0) {\n        return res.json({ success: true, message: \"No device tokens found for family members\" });\n      }\n\n      const result = await sendPushNotification(allTokens, title, body, data);\n\n      if (result.failedTokens.length > 0) {\n        for (const failedToken of result.failedTokens) {\n          await db.delete(deviceTokens).where(eq(deviceTokens.token, failedToken));\n        }\n      }\n\n      res.json({ \n        success: true, \n        sent: result.successCount,\n        failed: result.failureCount \n      });\n    } catch (error) {\n      console.error(\"Error sending notifications:\", error);\n      res.status(500).json({ error: \"Failed to send notifications\" });\n    }\n  });\n\n  // Create a task\n  app.post(\"/api/tasks\", async (req, res) => {\n    try {\n      const { itemId, itemSvgData, itemName, quantity, note, assignedToId, assignedToName, assignedById, assignedByName } = req.body;\n      \n      if (!itemId || !itemSvgData || !assignedToId || !assignedToName || !assignedById || !assignedByName) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const [newTask] = await db.insert(tasks).values({\n        itemId,\n        itemSvgData,\n        itemName: itemName || null,\n        quantity: quantity || 1,\n        note: note || null,\n        assignedToId,\n        assignedToName,\n        assignedById,\n        assignedByName,\n        status: \"pending\",\n      }).returning();\n\n      res.json(newTask);\n    } catch (error) {\n      console.error(\"Error creating task:\", error);\n      res.status(500).json({ error: \"Failed to create task\" });\n    }\n  });\n\n  // Get tasks for a user (assigned to them OR assigned by them)\n  app.get(\"/api/tasks/:userId\", async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const userTasks = await db.select()\n        .from(tasks)\n        .where(or(\n          eq(tasks.assignedToId, userId),\n          eq(tasks.assignedById, userId)\n        ));\n\n      res.json(userTasks);\n    } catch (error) {\n      console.error(\"Error fetching tasks:\", error);\n      res.status(500).json({ error: \"Failed to fetch tasks\" });\n    }\n  });\n\n  // Mark task as complete\n  app.patch(\"/api/tasks/:id/complete\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const [updatedTask] = await db.update(tasks)\n        .set({ status: \"completed\", completedAt: new Date() })\n        .where(eq(tasks.id, parseInt(id)))\n        .returning();\n\n      if (!updatedTask) {\n        return res.status(404).json({ error: \"Task not found\" });\n      }\n\n      res.json(updatedTask);\n    } catch (error) {\n      console.error(\"Error completing task:\", error);\n      res.status(500).json({ error: \"Failed to complete task\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":17077,"size_tokens":null},"client/screens/ProfileSetupScreen.tsx":{"content":"import React, { useState } from \"react\";\nimport { View, StyleSheet, TextInput, Pressable, Image, Platform, Alert } from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Button } from \"@/components/Button\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { createUser, UserRole } from \"@/lib/store\";\n\nexport default function ProfileSetupScreen() {\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n  const [name, setName] = useState(\"\");\n  const [role, setRole] = useState<UserRole | null>(null);\n  const [avatarUri, setAvatarUri] = useState<string | null>(null);\n\n  const handlePickImage = async () => {\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert.alert(\"Permission needed\", \"Please grant camera roll permissions to select a photo.\");\n      return;\n    }\n\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: [\"images\"],\n      quality: 0.5,\n    });\n\n    if (!result.canceled && result.assets[0]) {\n      setAvatarUri(result.assets[0].uri);\n      if (Platform.OS !== \"web\") {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      }\n    }\n  };\n\n  const handleTakePhoto = async () => {\n    const { status } = await ImagePicker.requestCameraPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert.alert(\"Permission needed\", \"Please grant camera permissions to take a photo.\");\n      return;\n    }\n\n    const result = await ImagePicker.launchCameraAsync({\n      quality: 0.5,\n    });\n\n    if (!result.canceled && result.assets[0]) {\n      setAvatarUri(result.assets[0].uri);\n      if (Platform.OS !== \"web\") {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      }\n    }\n  };\n\n  const handleCreateProfile = async () => {\n    if (!name.trim()) {\n      Alert.alert(\"Name required\", \"Please enter your name to continue.\");\n      return;\n    }\n\n    if (!role) {\n      Alert.alert(\"Role required\", \"Please select whether you are a parent or child.\");\n      return;\n    }\n\n    await createUser(name.trim(), role, avatarUri);\n    if (Platform.OS !== \"web\") {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const showImageOptions = () => {\n    if (Platform.OS === \"web\") {\n      handlePickImage();\n      return;\n    }\n    \n    Alert.alert(\n      \"Add Photo\",\n      \"Choose an option\",\n      [\n        { text: \"Take Photo\", onPress: handleTakePhoto },\n        { text: \"Choose from Library\", onPress: handlePickImage },\n        { text: \"Cancel\", style: \"cancel\" },\n      ]\n    );\n  };\n\n  const selectRole = (selectedRole: UserRole) => {\n    setRole(selectedRole);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={styles.scrollView}\n        contentContainerStyle={[\n          styles.content,\n          {\n            paddingTop: insets.top + Spacing[\"3xl\"],\n            paddingBottom: insets.bottom + Spacing.xl,\n          },\n        ]}\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.header}>\n          <Image\n            source={require(\"../../assets/images/icon.png\")}\n            style={styles.logo}\n            resizeMode=\"contain\"\n          />\n          <ThemedText type=\"h1\" style={styles.title}>\n            Welcome to BringIt\n          </ThemedText>\n          <ThemedText type=\"body\" style={[styles.subtitle, { color: theme.textSecondary }]}>\n            Create your profile to get started with family coordination\n          </ThemedText>\n        </View>\n\n        <View style={styles.form}>\n          <Pressable\n            onPress={showImageOptions}\n            style={({ pressed }) => [\n              styles.avatarContainer,\n              {\n                backgroundColor: theme.backgroundDefault,\n                borderColor: theme.border,\n                transform: [{ scale: pressed ? 0.98 : 1 }],\n              },\n            ]}\n          >\n            {avatarUri ? (\n              <Image source={{ uri: avatarUri }} style={styles.avatar} />\n            ) : (\n              <View style={styles.avatarPlaceholder}>\n                <Feather name=\"camera\" size={32} color={theme.textSecondary} />\n                <ThemedText type=\"small\" style={{ color: theme.textSecondary, marginTop: Spacing.sm }}>\n                  Add Photo\n                </ThemedText>\n              </View>\n            )}\n          </Pressable>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"small\" style={[styles.label, { color: theme.textSecondary }]}>\n              Your Name\n            </ThemedText>\n            <TextInput\n              style={[\n                styles.input,\n                {\n                  backgroundColor: theme.backgroundDefault,\n                  borderColor: theme.border,\n                  color: theme.text,\n                },\n              ]}\n              placeholder=\"Enter your name\"\n              placeholderTextColor={theme.textTertiary}\n              value={name}\n              onChangeText={setName}\n              autoCapitalize=\"words\"\n              autoCorrect={false}\n            />\n          </View>\n\n          <View style={styles.inputContainer}>\n            <ThemedText type=\"small\" style={[styles.label, { color: theme.textSecondary }]}>\n              I am a...\n            </ThemedText>\n            <View style={styles.roleContainer}>\n              <Pressable\n                onPress={() => selectRole(\"parent\")}\n                style={({ pressed }) => [\n                  styles.roleButton,\n                  {\n                    backgroundColor: role === \"parent\" ? theme.primary : theme.backgroundDefault,\n                    borderColor: role === \"parent\" ? theme.primary : theme.border,\n                    transform: [{ scale: pressed ? 0.98 : 1 }],\n                  },\n                ]}\n              >\n                <Feather \n                  name=\"user\" \n                  size={24} \n                  color={role === \"parent\" ? Colors.light.buttonText : theme.text} \n                />\n                <ThemedText \n                  type=\"h4\" \n                  style={{ \n                    color: role === \"parent\" ? Colors.light.buttonText : theme.text,\n                    marginTop: Spacing.sm,\n                  }}\n                >\n                  Parent\n                </ThemedText>\n                <ThemedText \n                  type=\"caption\" \n                  style={{ \n                    color: role === \"parent\" ? Colors.light.buttonText : theme.textSecondary,\n                    textAlign: \"center\",\n                    marginTop: Spacing.xs,\n                  }}\n                >\n                  I create orders\n                </ThemedText>\n              </Pressable>\n\n              <Pressable\n                onPress={() => selectRole(\"child\")}\n                style={({ pressed }) => [\n                  styles.roleButton,\n                  {\n                    backgroundColor: role === \"child\" ? theme.primary : theme.backgroundDefault,\n                    borderColor: role === \"child\" ? theme.primary : theme.border,\n                    transform: [{ scale: pressed ? 0.98 : 1 }],\n                  },\n                ]}\n              >\n                <Feather \n                  name=\"users\" \n                  size={24} \n                  color={role === \"child\" ? Colors.light.buttonText : theme.text} \n                />\n                <ThemedText \n                  type=\"h4\" \n                  style={{ \n                    color: role === \"child\" ? Colors.light.buttonText : theme.text,\n                    marginTop: Spacing.sm,\n                  }}\n                >\n                  Child\n                </ThemedText>\n                <ThemedText \n                  type=\"caption\" \n                  style={{ \n                    color: role === \"child\" ? Colors.light.buttonText : theme.textSecondary,\n                    textAlign: \"center\",\n                    marginTop: Spacing.xs,\n                  }}\n                >\n                  I complete orders\n                </ThemedText>\n              </Pressable>\n            </View>\n          </View>\n\n          <Button\n            onPress={handleCreateProfile}\n            disabled={!name.trim() || !role}\n            style={styles.button}\n          >\n            Create Profile\n          </Button>\n        </View>\n\n        <View style={styles.footer}>\n          <ThemedText type=\"caption\" style={{ color: theme.textTertiary, textAlign: \"center\" }}>\n            Your profile is stored locally on this device only. No account or internet required.\n          </ThemedText>\n        </View>\n      </KeyboardAwareScrollViewCompat>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  content: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.xl,\n  },\n  header: {\n    alignItems: \"center\",\n    marginBottom: Spacing[\"2xl\"],\n  },\n  logo: {\n    width: 80,\n    height: 80,\n    marginBottom: Spacing.xl,\n  },\n  title: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  subtitle: {\n    textAlign: \"center\",\n    maxWidth: 280,\n  },\n  form: {\n    flex: 1,\n    alignItems: \"center\",\n    gap: Spacing.xl,\n  },\n  avatarContainer: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    borderWidth: 2,\n    borderStyle: \"dashed\",\n    overflow: \"hidden\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  avatar: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  avatarPlaceholder: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  inputContainer: {\n    width: \"100%\",\n    gap: Spacing.sm,\n  },\n  label: {\n    marginLeft: Spacing.xs,\n  },\n  input: {\n    height: Spacing.inputHeight,\n    borderWidth: 1,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.lg,\n    fontSize: 16,\n  },\n  roleContainer: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  roleButton: {\n    flex: 1,\n    paddingVertical: Spacing.xl,\n    paddingHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    borderWidth: 2,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  button: {\n    width: \"100%\",\n    marginTop: Spacing.md,\n  },\n  footer: {\n    marginTop: \"auto\",\n    paddingTop: Spacing.xl,\n  },\n});\n","path":null,"size_bytes":10847,"size_tokens":null},"client/screens/QRScannerScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { View, StyleSheet, Pressable, Platform, Alert, Linking } from \"react-native\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { CameraView, useCameraPermissions, BarcodeScanningResult } from \"expo-camera\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { sendConnectionRequestByCode, getState } from \"@/lib/store\";\n\nexport default function QRScannerScreen() {\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n  const navigation = useNavigation();\n  const [permission, requestPermission] = useCameraPermissions();\n  const [scanned, setScanned] = useState(false);\n\n  const handleBarCodeScanned = (result: BarcodeScanningResult) => {\n    if (scanned) return;\n    \n    setScanned(true);\n    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    \n    const scannedCode = result.data;\n    \n    if (scannedCode.startsWith(\"bringit://connect/\")) {\n      const userId = scannedCode.replace(\"bringit://connect/\", \"\");\n      handleConnectByCode(userId);\n    } else {\n      handleConnectByCode(scannedCode);\n    }\n  };\n\n  const handleConnectByCode = (code: string) => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) {\n      Alert.alert(\n        \"Setup Required\",\n        \"Please create your profile first before scanning QR codes.\",\n        [{ text: \"OK\", onPress: () => navigation.goBack() }]\n      );\n      return;\n    }\n\n    if (code === currentUser.id) {\n      Alert.alert(\n        \"That's You\",\n        \"You scanned your own QR code. Scan a family member's code instead.\",\n        [{ text: \"OK\", onPress: () => setScanned(false) }]\n      );\n      return;\n    }\n\n    const result = sendConnectionRequestByCode(code);\n    if (result) {\n      Alert.alert(\n        \"Request Sent\",\n        \"A connection request has been sent. They will need to accept it on their device.\",\n        [{ text: \"OK\", onPress: () => navigation.goBack() }]\n      );\n    } else {\n      Alert.alert(\n        \"Already Connected\",\n        \"You already have a pending request or connection with this person.\",\n        [{ text: \"OK\", onPress: () => setScanned(false) }]\n      );\n    }\n  };\n\n  if (Platform.OS === \"web\") {\n    return (\n      <ThemedView style={styles.container}>\n        <View style={[styles.header, { paddingTop: insets.top + Spacing.lg }]}>\n          <Pressable\n            onPress={() => navigation.goBack()}\n            style={[styles.closeButton, { backgroundColor: \"rgba(0,0,0,0.3)\" }]}\n          >\n            <Feather name=\"x\" size={24} color=\"#FFF\" />\n          </Pressable>\n        </View>\n\n        <View style={styles.content}>\n          <View style={[styles.webMessage, { backgroundColor: theme.backgroundSecondary }]}>\n            <Feather name=\"smartphone\" size={48} color={theme.primary} />\n            <ThemedText type=\"h3\" style={styles.instructionTitle}>\n              Use Expo Go\n            </ThemedText>\n            <ThemedText type=\"body\" style={[styles.instructionText, { color: theme.textSecondary }]}>\n              QR code scanning requires a real device. Scan the QR code in Replit to open this app in Expo Go on your phone.\n            </ThemedText>\n          </View>\n        </View>\n      </ThemedView>\n    );\n  }\n\n  if (!permission) {\n    return (\n      <ThemedView style={styles.container}>\n        <View style={styles.content}>\n          <ThemedText type=\"body\">Loading camera...</ThemedText>\n        </View>\n      </ThemedView>\n    );\n  }\n\n  if (!permission.granted) {\n    return (\n      <ThemedView style={styles.container}>\n        <View style={[styles.header, { paddingTop: insets.top + Spacing.lg }]}>\n          <Pressable\n            onPress={() => navigation.goBack()}\n            style={[styles.closeButton, { backgroundColor: \"rgba(0,0,0,0.3)\" }]}\n          >\n            <Feather name=\"x\" size={24} color=\"#FFF\" />\n          </Pressable>\n        </View>\n\n        <View style={styles.content}>\n          <View style={[styles.permissionBox, { backgroundColor: theme.backgroundSecondary }]}>\n            <Feather name=\"camera-off\" size={48} color={theme.primary} />\n            <ThemedText type=\"h3\" style={styles.instructionTitle}>\n              Camera Access Required\n            </ThemedText>\n            <ThemedText type=\"body\" style={[styles.instructionText, { color: theme.textSecondary }]}>\n              We need camera access to scan QR codes from your family members.\n            </ThemedText>\n            \n            {permission.status === \"denied\" && !permission.canAskAgain ? (\n              <Pressable\n                style={[styles.permissionButton, { backgroundColor: theme.primary }]}\n                onPress={async () => {\n                  try {\n                    await Linking.openSettings();\n                  } catch (error) {\n                  }\n                }}\n              >\n                <ThemedText type=\"body\" style={{ color: \"#FFF\" }}>\n                  Open Settings\n                </ThemedText>\n              </Pressable>\n            ) : (\n              <Pressable\n                style={[styles.permissionButton, { backgroundColor: theme.primary }]}\n                onPress={requestPermission}\n              >\n                <ThemedText type=\"body\" style={{ color: \"#FFF\" }}>\n                  Enable Camera\n                </ThemedText>\n              </Pressable>\n            )}\n          </View>\n        </View>\n      </ThemedView>\n    );\n  }\n\n  return (\n    <View style={styles.container}>\n      <CameraView\n        style={StyleSheet.absoluteFillObject}\n        facing=\"back\"\n        barcodeScannerSettings={{\n          barcodeTypes: [\"qr\"],\n        }}\n        onBarcodeScanned={scanned ? undefined : handleBarCodeScanned}\n      />\n      \n      <View style={[styles.header, { paddingTop: insets.top + Spacing.lg }]}>\n        <Pressable\n          onPress={() => navigation.goBack()}\n          style={[styles.closeButton, { backgroundColor: \"rgba(0,0,0,0.5)\" }]}\n        >\n          <Feather name=\"x\" size={24} color=\"#FFF\" />\n        </Pressable>\n      </View>\n\n      <View style={styles.overlay}>\n        <View style={styles.scanAreaContainer}>\n          <View style={[styles.scanArea]}>\n            <View style={[styles.corner, styles.topLeft]} />\n            <View style={[styles.corner, styles.topRight]} />\n            <View style={[styles.corner, styles.bottomLeft]} />\n            <View style={[styles.corner, styles.bottomRight]} />\n          </View>\n        </View>\n        \n        <View style={[styles.instructions, { backgroundColor: \"rgba(0,0,0,0.7)\" }]}>\n          <ThemedText type=\"body\" style={{ color: \"#FFF\", textAlign: \"center\" }}>\n            Position the QR code within the frame\n          </ThemedText>\n        </View>\n      </View>\n\n      <View style={[styles.footer, { paddingBottom: insets.bottom + Spacing.xl }]}>\n        <ThemedText type=\"caption\" style={{ color: \"rgba(255,255,255,0.7)\", textAlign: \"center\" }}>\n          Ask your family member to show their QR code from the Family tab\n        </ThemedText>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#000\",\n  },\n  header: {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    zIndex: 10,\n    paddingHorizontal: Spacing.lg,\n  },\n  closeButton: {\n    width: 44,\n    height: 44,\n    borderRadius: 22,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  content: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: Spacing.xl,\n  },\n  overlay: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  scanAreaContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  scanArea: {\n    width: 250,\n    height: 250,\n    position: \"relative\",\n  },\n  corner: {\n    position: \"absolute\",\n    width: 40,\n    height: 40,\n    borderColor: Colors.light.primary,\n  },\n  topLeft: {\n    top: 0,\n    left: 0,\n    borderTopWidth: 4,\n    borderLeftWidth: 4,\n    borderTopLeftRadius: 12,\n  },\n  topRight: {\n    top: 0,\n    right: 0,\n    borderTopWidth: 4,\n    borderRightWidth: 4,\n    borderTopRightRadius: 12,\n  },\n  bottomLeft: {\n    bottom: 0,\n    left: 0,\n    borderBottomWidth: 4,\n    borderLeftWidth: 4,\n    borderBottomLeftRadius: 12,\n  },\n  bottomRight: {\n    bottom: 0,\n    right: 0,\n    borderBottomWidth: 4,\n    borderRightWidth: 4,\n    borderBottomRightRadius: 12,\n  },\n  instructions: {\n    marginTop: Spacing.xl,\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    maxWidth: 300,\n  },\n  instructionTitle: {\n    marginTop: Spacing.md,\n    marginBottom: Spacing.sm,\n    textAlign: \"center\",\n  },\n  instructionText: {\n    textAlign: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  footer: {\n    paddingHorizontal: Spacing.xl,\n  },\n  webMessage: {\n    alignItems: \"center\",\n    padding: Spacing.xl,\n    borderRadius: BorderRadius.lg,\n    maxWidth: 320,\n  },\n  permissionBox: {\n    alignItems: \"center\",\n    padding: Spacing.xl,\n    borderRadius: BorderRadius.lg,\n    maxWidth: 320,\n  },\n  permissionButton: {\n    paddingHorizontal: Spacing.xl,\n    paddingVertical: Spacing.md,\n    borderRadius: BorderRadius.md,\n    marginTop: Spacing.md,\n  },\n});\n","path":null,"size_bytes":9537,"size_tokens":null},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: [\"babel-preset-expo\"],\n    plugins: [\n      [\n        \"module-resolver\",\n        {\n          root: [\"./\"],\n          alias: {\n            \"@\": \"./client\",\n            \"@shared\": \"./shared\",\n          },\n          extensions: [\".ios.js\", \".android.js\", \".js\", \".ts\", \".tsx\", \".json\"],\n        },\n      ],\n      \"react-native-reanimated/plugin\",\n    ],\n  };\n};\n","path":null,"size_bytes":436,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, serial, integer } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const appUsers = pgTable(\"app_users\", {\n  id: varchar(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  role: varchar(\"role\", { length: 20 }).notNull(),\n  avatarSvg: text(\"avatar_svg\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const connectionRequests = pgTable(\"connection_requests\", {\n  id: serial(\"id\").primaryKey(),\n  fromUserId: varchar(\"from_user_id\").notNull(),\n  fromUserName: text(\"from_user_name\").notNull(),\n  fromUserRole: varchar(\"from_user_role\", { length: 20 }).notNull(),\n  fromUserAvatar: text(\"from_user_avatar\"),\n  toUserId: varchar(\"to_user_id\").notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const deviceTokens = pgTable(\"device_tokens\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").notNull(),\n  token: text(\"token\").notNull().unique(),\n  platform: varchar(\"platform\", { length: 20 }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const familyConnections = pgTable(\"family_connections\", {\n  id: serial(\"id\").primaryKey(),\n  parentId: varchar(\"parent_id\").notNull(),\n  childId: varchar(\"child_id\").notNull(),\n  childName: varchar(\"child_name\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const tasks = pgTable(\"tasks\", {\n  id: serial(\"id\").primaryKey(),\n  itemId: varchar(\"item_id\").notNull(),\n  itemSvgData: text(\"item_svg_data\").notNull(),\n  itemName: text(\"item_name\"),\n  quantity: integer(\"quantity\").notNull().default(1),\n  note: text(\"note\"),\n  assignedToId: varchar(\"assigned_to_id\").notNull(),\n  assignedToName: text(\"assigned_to_name\").notNull(),\n  assignedById: varchar(\"assigned_by_id\").notNull(),\n  assignedByName: text(\"assigned_by_name\").notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"pending\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport const insertDeviceTokenSchema = createInsertSchema(deviceTokens).pick({\n  userId: true,\n  token: true,\n  platform: true,\n});\n\nexport const insertFamilyConnectionSchema = createInsertSchema(familyConnections).pick({\n  parentId: true,\n  childId: true,\n  childName: true,\n});\n\nexport const insertAppUserSchema = createInsertSchema(appUsers).pick({\n  id: true,\n  name: true,\n  role: true,\n  avatarSvg: true,\n});\n\nexport const insertConnectionRequestSchema = createInsertSchema(connectionRequests).pick({\n  fromUserId: true,\n  fromUserName: true,\n  fromUserRole: true,\n  fromUserAvatar: true,\n  toUserId: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type DeviceToken = typeof deviceTokens.$inferSelect;\nexport type InsertDeviceToken = z.infer<typeof insertDeviceTokenSchema>;\nexport type FamilyConnection = typeof familyConnections.$inferSelect;\nexport type InsertFamilyConnection = z.infer<typeof insertFamilyConnectionSchema>;\nexport type AppUser = typeof appUsers.$inferSelect;\nexport type InsertAppUser = z.infer<typeof insertAppUserSchema>;\nexport type ConnectionRequest = typeof connectionRequests.$inferSelect;\nexport type InsertConnectionRequest = z.infer<typeof insertConnectionRequestSchema>;\n\nexport const insertTaskSchema = createInsertSchema(tasks).pick({\n  itemId: true,\n  itemSvgData: true,\n  itemName: true,\n  quantity: true,\n  note: true,\n  assignedToId: true,\n  assignedToName: true,\n  assignedById: true,\n  assignedByName: true,\n});\n\nexport type Task = typeof tasks.$inferSelect;\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\n","path":null,"size_bytes":4232,"size_tokens":null},"client/hooks/useScreenOptions.ts":{"content":"import { Platform } from \"react-native\";\nimport { NativeStackNavigationOptions } from \"@react-navigation/native-stack\";\nimport { isLiquidGlassAvailable } from \"expo-glass-effect\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\ninterface UseScreenOptionsParams {\n  transparent?: boolean;\n}\n\nexport function useScreenOptions({\n  transparent = true,\n}: UseScreenOptionsParams = {}): NativeStackNavigationOptions {\n  const { theme, isDark } = useTheme();\n\n  return {\n    headerTitleAlign: \"center\",\n    headerTransparent: transparent,\n    headerBlurEffect: isDark ? \"dark\" : \"light\",\n    headerTintColor: theme.text,\n    headerStyle: {\n      backgroundColor: Platform.select({\n        ios: undefined,\n        android: theme.backgroundRoot,\n        web: theme.backgroundRoot,\n      }),\n    },\n    gestureEnabled: true,\n    gestureDirection: \"horizontal\",\n    fullScreenGestureEnabled: isLiquidGlassAvailable() ? false : true,\n    contentStyle: {\n      backgroundColor: theme.backgroundRoot,\n    },\n  };\n}\n","path":null,"size_bytes":1000,"size_tokens":null},"client/screens/SavedItemsScreen.tsx":{"content":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { View, StyleSheet, FlatList, Pressable, Alert, Platform, Modal, Image, TextInput } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\nimport * as ImagePicker from \"expo-image-picker\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Button } from \"@/components/Button\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { \n  getState, \n  subscribe, \n  removeSavedItem, \n  addSavedItem,\n  assignTask,\n  SavedItem,\n  FamilyMember \n} from \"@/lib/store\";\nimport { getFamilyMembers } from \"@/lib/api\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useToast } from \"@/lib/toast\";\n\nfunction AddItemModal({\n  visible,\n  imageUri,\n  onClose,\n  onSave,\n}: {\n  visible: boolean;\n  imageUri: string | null;\n  onClose: () => void;\n  onSave: (name: string) => void;\n}) {\n  const { theme } = useTheme();\n  const insets = useSafeAreaInsets();\n  const [itemName, setItemName] = useState(\"\");\n\n  const handleSave = () => {\n    onSave(itemName);\n    setItemName(\"\");\n    onClose();\n  };\n\n  const handleClose = () => {\n    setItemName(\"\");\n    onClose();\n  };\n\n  if (!imageUri) return null;\n\n  return (\n    <Modal\n      visible={visible}\n      animationType=\"slide\"\n      transparent\n      onRequestClose={handleClose}\n    >\n      <View style={styles.modalOverlay}>\n        <KeyboardAwareScrollViewCompat\n          contentContainerStyle={styles.addItemModalScroll}\n        >\n          <ThemedView style={[styles.addItemModal, { paddingBottom: insets.bottom + Spacing.lg }]}>\n            <View style={styles.modalHeader}>\n              <ThemedText type=\"h3\">Add New Item</ThemedText>\n              <Pressable onPress={handleClose}>\n                <Feather name=\"x\" size={24} color={theme.text} />\n              </Pressable>\n            </View>\n\n            <View style={[styles.addItemPreview, { backgroundColor: theme.backgroundSecondary }]}>\n              <Image source={{ uri: imageUri }} style={styles.addItemImage} />\n            </View>\n\n            <TextInput\n              style={[styles.itemNameInput, { color: theme.text, borderColor: theme.border, backgroundColor: theme.backgroundSecondary }]}\n              placeholder=\"Enter item name (optional)\"\n              placeholderTextColor={theme.textTertiary}\n              value={itemName}\n              onChangeText={setItemName}\n              autoFocus\n            />\n\n            <View style={styles.addItemButtons}>\n              <Pressable\n                onPress={handleClose}\n                style={[styles.addItemButton, styles.cancelButton, { borderColor: theme.border }]}\n              >\n                <ThemedText type=\"body\" style={{ textAlign: \"center\" }}>Cancel</ThemedText>\n              </Pressable>\n              <Button \n                onPress={handleSave}\n                style={styles.addItemButton}\n              >\n                Save Item\n              </Button>\n            </View>\n          </ThemedView>\n        </KeyboardAwareScrollViewCompat>\n      </View>\n    </Modal>\n  );\n}\n\nfunction ItemCard({ \n  item, \n  isEditMode, \n  onDelete,\n  onAssign,\n}: { \n  item: SavedItem; \n  isEditMode: boolean;\n  onDelete: (id: string) => void;\n  onAssign: (item: SavedItem) => void;\n}) {\n  const { theme } = useTheme();\n\n  const handleLongPress = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    }\n    Alert.alert(\n      \"Delete Item\",\n      `Are you sure you want to delete \"${item.name || \"this item\"}\"?`,\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        { \n          text: \"Delete\", \n          style: \"destructive\",\n          onPress: () => onDelete(item.id),\n        },\n      ]\n    );\n  };\n\n  const handlePress = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    onAssign(item);\n  };\n\n  return (\n    <Card style={styles.itemCard}>\n      <Pressable\n        onPress={handlePress}\n        onLongPress={handleLongPress}\n        style={styles.itemContent}\n      >\n        <View style={[styles.itemImage, { backgroundColor: theme.backgroundSecondary }]}>\n          {item.svgData ? (\n            <Image source={{ uri: item.svgData }} style={styles.itemImageContent} />\n          ) : (\n            <Feather name=\"image\" size={32} color={theme.textTertiary} />\n          )}\n        </View>\n        {item.name ? (\n          <ThemedText type=\"small\" numberOfLines={2} style={styles.itemName}>\n            {item.name}\n          </ThemedText>\n        ) : null}\n        {isEditMode ? (\n          <Pressable\n            onPress={() => onDelete(item.id)}\n            style={[styles.deleteButton, { backgroundColor: Colors.light.statusError }]}\n          >\n            <Feather name=\"x\" size={16} color=\"#FFF\" />\n          </Pressable>\n        ) : null}\n        <View style={[styles.assignBadge, { backgroundColor: theme.primary }]}>\n          <Feather name=\"send\" size={12} color={Colors.light.buttonText} />\n        </View>\n      </Pressable>\n    </Card>\n  );\n}\n\nfunction AssignModal({\n  visible,\n  item,\n  onClose,\n  onAssign,\n  familyMembers,\n}: {\n  visible: boolean;\n  item: SavedItem | null;\n  onClose: () => void;\n  onAssign: (item: SavedItem, memberId: string, memberName: string, quantity: number, note: string) => void;\n  familyMembers: FamilyMember[];\n}) {\n  const { theme } = useTheme();\n  const insets = useSafeAreaInsets();\n  const [selectedMember, setSelectedMember] = useState<string | null>(null);\n  const [quantity, setQuantity] = useState(1);\n  const [note, setNote] = useState(\"\");\n\n  const children = familyMembers.filter(m => m.role === 'child' && m.status === 'accepted');\n\n  const handleAssign = () => {\n    if (!item || !selectedMember) return;\n    const member = children.find(m => m.id === selectedMember);\n    if (!member) return;\n    onAssign(item, member.userId, member.name, quantity, note);\n    setSelectedMember(null);\n    setQuantity(1);\n    setNote(\"\");\n    onClose();\n  };\n\n  const handleClose = () => {\n    setSelectedMember(null);\n    setQuantity(1);\n    setNote(\"\");\n    onClose();\n  };\n\n  if (!item) return null;\n\n  return (\n    <Modal\n      visible={visible}\n      animationType=\"slide\"\n      transparent\n      onRequestClose={handleClose}\n    >\n      <View style={styles.modalOverlay}>\n        <ThemedView style={[styles.assignModal, { paddingBottom: insets.bottom + Spacing.lg }]}>\n          <View style={styles.modalHeader}>\n            <ThemedText type=\"h3\">Assign to Child</ThemedText>\n            <Pressable onPress={handleClose}>\n              <Feather name=\"x\" size={24} color={theme.text} />\n            </Pressable>\n          </View>\n\n          <View style={[styles.itemPreview, { backgroundColor: theme.backgroundSecondary }]}>\n            {item.svgData ? (\n              <Image source={{ uri: item.svgData }} style={styles.previewImage} />\n            ) : (\n              <Feather name=\"image\" size={40} color={theme.textTertiary} />\n            )}\n            <ThemedText type=\"h4\" style={styles.previewName}>\n              {item.name || \"Item\"}\n            </ThemedText>\n          </View>\n\n          <View style={styles.quantitySection}>\n            <ThemedText type=\"body\">Quantity:</ThemedText>\n            <View style={styles.quantityControls}>\n              <Pressable\n                onPress={() => setQuantity(Math.max(1, quantity - 1))}\n                style={[styles.quantityButton, { backgroundColor: theme.backgroundSecondary }]}\n              >\n                <Feather name=\"minus\" size={18} color={theme.text} />\n              </Pressable>\n              <ThemedText type=\"h3\" style={styles.quantityText}>{quantity}</ThemedText>\n              <Pressable\n                onPress={() => setQuantity(quantity + 1)}\n                style={[styles.quantityButton, { backgroundColor: theme.backgroundSecondary }]}\n              >\n                <Feather name=\"plus\" size={18} color={theme.text} />\n              </Pressable>\n            </View>\n          </View>\n\n          <TextInput\n            style={[styles.noteInput, { color: theme.text, borderColor: theme.border, backgroundColor: theme.backgroundSecondary }]}\n            placeholder=\"Add a note (optional)\"\n            placeholderTextColor={theme.textTertiary}\n            value={note}\n            onChangeText={setNote}\n          />\n\n          {children.length === 0 ? (\n            <View style={styles.noChildren}>\n              <ThemedText type=\"body\" style={{ color: theme.textSecondary, textAlign: \"center\" }}>\n                No children connected yet. Add family members in the Family tab.\n              </ThemedText>\n            </View>\n          ) : (\n            <>\n              <ThemedText type=\"caption\" style={[styles.sectionLabel, { color: theme.textSecondary }]}>\n                Select a child:\n              </ThemedText>\n              <FlatList\n                data={children}\n                keyExtractor={(m) => m.id}\n                style={styles.memberList}\n                renderItem={({ item: member }) => (\n                  <Pressable\n                    onPress={() => setSelectedMember(member.id)}\n                    style={[\n                      styles.memberRow,\n                      { \n                        backgroundColor: selectedMember === member.id \n                          ? theme.primary + \"20\" \n                          : theme.backgroundSecondary,\n                        borderColor: selectedMember === member.id \n                          ? theme.primary \n                          : \"transparent\",\n                      },\n                    ]}\n                  >\n                    <View style={[styles.memberAvatar, { backgroundColor: theme.backgroundDefault }]}>\n                      {member.avatarSvg ? (\n                        <Image source={{ uri: member.avatarSvg }} style={styles.avatarImage} />\n                      ) : (\n                        <Feather name=\"user\" size={20} color={theme.textSecondary} />\n                      )}\n                    </View>\n                    <ThemedText type=\"body\" style={{ flex: 1 }}>{member.name}</ThemedText>\n                    {selectedMember === member.id ? (\n                      <Feather name=\"check-circle\" size={20} color={theme.primary} />\n                    ) : null}\n                  </Pressable>\n                )}\n              />\n            </>\n          )}\n\n          <Button\n            onPress={handleAssign}\n            disabled={!selectedMember}\n            style={styles.assignButton}\n          >\n            Assign Task\n          </Button>\n        </ThemedView>\n      </View>\n    </Modal>\n  );\n}\n\nfunction PhotoSourceModal({\n  visible,\n  onClose,\n  onCamera,\n  onGallery,\n}: {\n  visible: boolean;\n  onClose: () => void;\n  onCamera: () => void;\n  onGallery: () => void;\n}) {\n  const { theme } = useTheme();\n\n  return (\n    <Modal\n      visible={visible}\n      transparent\n      animationType=\"fade\"\n      onRequestClose={onClose}\n    >\n      <Pressable style={styles.modalOverlay} onPress={onClose}>\n        <Pressable style={[styles.photoSourceModal, { backgroundColor: theme.backgroundDefault }]} onPress={() => {}}>\n          <ThemedText type=\"h3\" style={styles.modalTitle}>Add Item</ThemedText>\n          <ThemedText type=\"body\" style={[styles.modalSubtitle, { color: theme.textSecondary }]}>\n            Choose how to add your item photo\n          </ThemedText>\n          <View style={styles.photoSourceOptions}>\n            <Pressable\n              onPress={onCamera}\n              style={({ pressed }) => [\n                styles.photoSourceOption,\n                { \n                  backgroundColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <View style={[styles.photoSourceIconWrap, { backgroundColor: theme.primary }]}>\n                <Feather name=\"camera\" size={28} color={Colors.light.buttonText} />\n              </View>\n              <View style={styles.photoSourceOptionText}>\n                <ThemedText type=\"h4\">Take Photo</ThemedText>\n                <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                  Use your camera\n                </ThemedText>\n              </View>\n              <Feather name=\"chevron-right\" size={24} color={theme.textTertiary} />\n            </Pressable>\n            <Pressable\n              onPress={onGallery}\n              style={({ pressed }) => [\n                styles.photoSourceOption,\n                { \n                  backgroundColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <View style={[styles.photoSourceIconWrap, { backgroundColor: theme.primary }]}>\n                <Feather name=\"image\" size={28} color={Colors.light.buttonText} />\n              </View>\n              <View style={styles.photoSourceOptionText}>\n                <ThemedText type=\"h4\">From Gallery</ThemedText>\n                <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                  Choose from your photos\n                </ThemedText>\n              </View>\n              <Feather name=\"chevron-right\" size={24} color={theme.textTertiary} />\n            </Pressable>\n          </View>\n          <Pressable\n            onPress={onClose}\n            style={[styles.photoSourceCancelButton, { backgroundColor: theme.backgroundSecondary }]}\n          >\n            <ThemedText type=\"body\" style={{ fontWeight: \"600\" }}>Cancel</ThemedText>\n          </Pressable>\n        </Pressable>\n      </Pressable>\n    </Modal>\n  );\n}\n\nfunction EmptyState({ onAddItem }: { onAddItem: () => void }) {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"shopping-bag\" size={64} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No Items Yet\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        Add items by taking photos, then assign them to your children\n      </ThemedText>\n      <Button onPress={onAddItem} style={styles.addButton}>\n        Add First Item\n      </Button>\n    </View>\n  );\n}\n\nexport default function SavedItemsScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const { showToast } = useToast();\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [items, setItems] = useState<SavedItem[]>([]);\n  const [familyMembers, setFamilyMembers] = useState<FamilyMember[]>([]);\n  const [selectedItem, setSelectedItem] = useState<SavedItem | null>(null);\n  const [showAssignModal, setShowAssignModal] = useState(false);\n  const [showAddItemModal, setShowAddItemModal] = useState(false);\n  const [showPhotoSourceModal, setShowPhotoSourceModal] = useState(false);\n  const [pendingImageUri, setPendingImageUri] = useState<string | null>(null);\n\n  const loadFamilyMembers = useCallback(async () => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    try {\n      const members = await getFamilyMembers(currentUser.id);\n      const mappedMembers: FamilyMember[] = members.map(m => ({\n        id: m.id,\n        userId: m.userId,\n        name: m.name,\n        role: m.role as 'parent' | 'child',\n        avatarSvg: m.avatarSvg,\n        connectedAt: new Date(m.connectedAt).getTime(),\n        status: 'accepted' as const,\n      }));\n      setFamilyMembers(mappedMembers);\n    } catch (error) {\n      console.error(\"Error loading family members:\", error);\n    }\n  }, []);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadFamilyMembers();\n    }, [loadFamilyMembers])\n  );\n\n  useEffect(() => {\n    const state = getState();\n    setItems(state.savedItems);\n    \n    const unsubscribe = subscribe(() => {\n      const newState = getState();\n      setItems([...newState.savedItems]);\n    });\n    return unsubscribe;\n  }, []);\n\n  const handleDelete = (id: string) => {\n    removeSavedItem(id);\n    if (Platform.OS !== \"web\") {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const handleAssignItem = (item: SavedItem) => {\n    setSelectedItem(item);\n    setShowAssignModal(true);\n  };\n\n  const handleAssign = async (item: SavedItem, memberId: string, memberName: string, quantity: number, note: string) => {\n    const task = await assignTask(item, memberId, memberName, quantity, note || null);\n    if (task) {\n      showToast(`\"${item.name || \"Item\"}\" assigned to ${memberName}`, \"success\");\n    } else {\n      showToast(\"Failed to assign task\", \"error\");\n    }\n  };\n\n  const handleAddItem = () => {\n    setShowPhotoSourceModal(true);\n  };\n\n  const handleCameraPhoto = async () => {\n    setShowPhotoSourceModal(false);\n    const { status } = await ImagePicker.requestCameraPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert.alert(\"Permission needed\", \"Please grant camera permissions to add items.\");\n      return;\n    }\n\n    const result = await ImagePicker.launchCameraAsync({\n      quality: 0.5,\n    });\n\n    if (!result.canceled && result.assets[0]) {\n      setPendingImageUri(result.assets[0].uri);\n      setShowAddItemModal(true);\n    }\n  };\n\n  const handleGalleryPhoto = async () => {\n    setShowPhotoSourceModal(false);\n    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert.alert(\"Permission needed\", \"Please grant photo library permissions to add items.\");\n      return;\n    }\n\n    const result = await ImagePicker.launchImageLibraryAsync({\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\n      quality: 0.5,\n    });\n\n    if (!result.canceled && result.assets[0]) {\n      setPendingImageUri(result.assets[0].uri);\n      setShowAddItemModal(true);\n    }\n  };\n\n  const handleSaveItem = (name: string) => {\n    if (pendingImageUri) {\n      addSavedItem({\n        svgData: pendingImageUri,\n        name: name || null,\n        lastNote: null,\n      });\n      if (Platform.OS !== \"web\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      }\n      setPendingImageUri(null);\n    }\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={items}\n        keyExtractor={(item) => item.id}\n        numColumns={2}\n        contentContainerStyle={[\n          styles.listContent,\n          {\n            paddingTop: headerHeight + Spacing.lg,\n            paddingBottom: tabBarHeight + Spacing[\"3xl\"],\n          },\n        ]}\n        columnWrapperStyle={items.length > 0 ? styles.row : undefined}\n        ListEmptyComponent={<EmptyState onAddItem={handleAddItem} />}\n        ListHeaderComponent={\n          items.length > 0 ? (\n            <View style={styles.header}>\n              <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                Tap an item to assign it to a child\n              </ThemedText>\n            </View>\n          ) : null\n        }\n        ListFooterComponent={\n          items.length > 0 ? (\n            <Pressable\n              onPress={handleAddItem}\n              style={[styles.centeredAddButton, { backgroundColor: theme.primary }]}\n            >\n              <Feather name=\"plus\" size={32} color={Colors.light.buttonText} />\n            </Pressable>\n          ) : null\n        }\n        renderItem={({ item }) => (\n          <ItemCard \n            item={item} \n            isEditMode={isEditMode}\n            onDelete={handleDelete}\n            onAssign={handleAssignItem}\n          />\n        )}\n        showsVerticalScrollIndicator={false}\n      />\n\n      <AssignModal\n        visible={showAssignModal}\n        item={selectedItem}\n        onClose={() => {\n          setShowAssignModal(false);\n          setSelectedItem(null);\n        }}\n        onAssign={handleAssign}\n        familyMembers={familyMembers}\n      />\n\n      <AddItemModal\n        visible={showAddItemModal}\n        imageUri={pendingImageUri}\n        onClose={() => {\n          setShowAddItemModal(false);\n          setPendingImageUri(null);\n        }}\n        onSave={handleSaveItem}\n      />\n\n      <PhotoSourceModal\n        visible={showPhotoSourceModal}\n        onClose={() => setShowPhotoSourceModal(false)}\n        onCamera={handleCameraPhoto}\n        onGallery={handleGalleryPhoto}\n      />\n\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    marginBottom: Spacing.md,\n    alignItems: \"center\",\n  },\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  row: {\n    justifyContent: \"space-between\",\n    marginBottom: Spacing.md,\n  },\n  itemCard: {\n    width: \"48%\",\n    padding: Spacing.md,\n  },\n  itemContent: {\n    alignItems: \"center\",\n  },\n  itemImage: {\n    width: \"100%\",\n    aspectRatio: 1,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.sm,\n    overflow: \"hidden\",\n  },\n  itemImageContent: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  itemName: {\n    textAlign: \"center\",\n  },\n  deleteButton: {\n    position: \"absolute\",\n    top: -Spacing.sm,\n    right: -Spacing.sm,\n    width: 24,\n    height: 24,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  assignBadge: {\n    position: \"absolute\",\n    bottom: Spacing.sm,\n    right: 0,\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"4xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n    marginBottom: Spacing.xl,\n  },\n  addButton: {\n    width: 180,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  assignModal: {\n    borderTopLeftRadius: BorderRadius.xl,\n    borderTopRightRadius: BorderRadius.xl,\n    padding: Spacing.lg,\n    maxHeight: \"80%\",\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  itemPreview: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.lg,\n  },\n  previewImage: {\n    width: 50,\n    height: 50,\n    borderRadius: BorderRadius.sm,\n    marginRight: Spacing.md,\n  },\n  previewName: {\n    flex: 1,\n  },\n  quantitySection: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    marginBottom: Spacing.md,\n  },\n  quantityControls: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.md,\n  },\n  quantityButton: {\n    width: 36,\n    height: 36,\n    borderRadius: 18,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  quantityText: {\n    minWidth: 30,\n    textAlign: \"center\",\n  },\n  noteInput: {\n    borderWidth: 1,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    fontSize: 16,\n    marginBottom: Spacing.lg,\n  },\n  sectionLabel: {\n    marginBottom: Spacing.sm,\n    textTransform: \"uppercase\",\n    letterSpacing: 0.5,\n  },\n  memberList: {\n    maxHeight: 200,\n    marginBottom: Spacing.lg,\n  },\n  memberRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.sm,\n    borderWidth: 2,\n  },\n  memberAvatar: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  avatarImage: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 20,\n  },\n  noChildren: {\n    padding: Spacing.xl,\n    alignItems: \"center\",\n  },\n  assignButton: {\n    marginTop: Spacing.sm,\n  },\n  addItemModalScroll: {\n    flexGrow: 1,\n    justifyContent: \"flex-end\",\n  },\n  addItemModal: {\n    borderTopLeftRadius: BorderRadius.xl,\n    borderTopRightRadius: BorderRadius.xl,\n    padding: Spacing.lg,\n  },\n  addItemPreview: {\n    width: 150,\n    height: 150,\n    borderRadius: BorderRadius.md,\n    alignSelf: \"center\",\n    marginBottom: Spacing.lg,\n    overflow: \"hidden\",\n  },\n  addItemImage: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  itemNameInput: {\n    borderWidth: 1,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    fontSize: 16,\n    marginBottom: Spacing.lg,\n  },\n  addItemButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  addItemButton: {\n    flex: 1,\n  },\n  cancelButton: {\n    borderWidth: 1,\n    borderRadius: BorderRadius.md,\n    padding: Spacing.md,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  photoSourceModal: {\n    marginHorizontal: Spacing.lg,\n    marginBottom: Spacing.xl,\n    borderRadius: BorderRadius.xl,\n    padding: Spacing.lg,\n  },\n  modalTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.xs,\n  },\n  modalSubtitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  photoSourceOptions: {\n    gap: Spacing.md,\n    marginBottom: Spacing.lg,\n  },\n  photoSourceOption: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n  },\n  photoSourceIconWrap: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  photoSourceOptionText: {\n    flex: 1,\n  },\n  photoSourceCancelButton: {\n    padding: Spacing.md,\n    borderRadius: BorderRadius.md,\n    alignItems: \"center\",\n  },\n  centeredAddButton: {\n    width: 64,\n    height: 64,\n    borderRadius: 32,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    alignSelf: \"center\",\n    marginTop: Spacing.xl,\n    marginBottom: Spacing.md,\n  },\n});\n","path":null,"size_bytes":26689,"size_tokens":null},"client/components/Spacer.tsx":{"content":"import { View } from \"react-native\";\n\ntype Props = {\n  width?: number;\n  height?: number;\n};\n\nexport default function Spacer(props: Props) {\n  const width: number = props.width ?? 1;\n  const height: number = props.height ?? 1;\n\n  return (\n    <View\n      style={{\n        width,\n        height,\n      }}\n    />\n  );\n}\n","path":null,"size_bytes":318,"size_tokens":null},"client/screens/OrdersScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { View, StyleSheet, FlatList, Pressable, Platform } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getState, subscribe, Order } from \"@/lib/store\";\nimport { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ntype Tab = \"received\" | \"sent\";\n\nfunction StatusBadge({ status }: { status: Order[\"status\"] }) {\n  const colors = {\n    pending: Colors.light.statusPending,\n    in_progress: Colors.light.statusInProgress,\n    completed: Colors.light.statusCompleted,\n  };\n\n  const labels = {\n    pending: \"Pending\",\n    in_progress: \"In Progress\",\n    completed: \"Completed\",\n  };\n\n  return (\n    <View style={[styles.badge, { backgroundColor: colors[status] + \"20\" }]}>\n      <View style={[styles.badgeDot, { backgroundColor: colors[status] }]} />\n      <ThemedText type=\"caption\" style={{ color: colors[status] }}>\n        {labels[status]}\n      </ThemedText>\n    </View>\n  );\n}\n\nfunction OrderCard({ order, mode }: { order: Order; mode: Tab }) {\n  const { theme } = useTheme();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n\n  const handlePress = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    navigation.navigate(\"OrderDetail\", { orderId: order.id, mode });\n  };\n\n  const formatTime = (timestamp: number) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    \n    if (diff < 60000) return \"Just now\";\n    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <Card style={styles.orderCard} onPress={handlePress}>\n      <View style={styles.orderHeader}>\n        <View style={styles.orderInfo}>\n          <ThemedText type=\"h4\">\n            {mode === \"received\" ? order.senderName : order.receiverName}\n          </ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            {mode === \"received\" ? \"From\" : \"To\"} • {formatTime(order.createdAt)}\n          </ThemedText>\n        </View>\n        <StatusBadge status={order.status} />\n      </View>\n\n      <View style={styles.orderItems}>\n        <View style={styles.itemPreviews}>\n          {order.items.slice(0, 3).map((item, index) => (\n            <View\n              key={item.id}\n              style={[\n                styles.itemPreview,\n                { backgroundColor: theme.backgroundSecondary, marginLeft: index > 0 ? -12 : 0 },\n              ]}\n            >\n              <Feather name=\"image\" size={16} color={theme.textTertiary} />\n            </View>\n          ))}\n          {order.items.length > 3 ? (\n            <View style={[styles.itemPreview, styles.moreItems, { marginLeft: -12 }]}>\n              <ThemedText type=\"caption\" style={{ color: Colors.light.buttonText }}>\n                +{order.items.length - 3}\n              </ThemedText>\n            </View>\n          ) : null}\n        </View>\n        <ThemedText type=\"small\" style={{ color: theme.textSecondary }}>\n          {order.items.length} {order.items.length === 1 ? \"item\" : \"items\"}\n        </ThemedText>\n      </View>\n\n      {mode === \"received\" && order.status !== \"completed\" ? (\n        <View style={styles.progressContainer}>\n          <View style={[styles.progressBar, { backgroundColor: theme.backgroundSecondary }]}>\n            <View\n              style={[\n                styles.progressFill,\n                {\n                  backgroundColor: Colors.light.statusInProgress,\n                  width: `${(order.items.filter(i => i.completed).length / order.items.length) * 100}%`,\n                },\n              ]}\n            />\n          </View>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            {order.items.filter(i => i.completed).length}/{order.items.length} done\n          </ThemedText>\n        </View>\n      ) : null}\n    </Card>\n  );\n}\n\nfunction EmptyState({ tab }: { tab: Tab }) {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"inbox\" size={48} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No {tab === \"received\" ? \"Received\" : \"Sent\"} Orders\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        {tab === \"received\"\n          ? \"Orders from family members will appear here\"\n          : \"Create an order to send to your family\"}\n      </ThemedText>\n    </View>\n  );\n}\n\nexport default function OrdersScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const [activeTab, setActiveTab] = useState<Tab>(\"received\");\n  const [orders, setOrders] = useState<Order[]>([]);\n\n  useEffect(() => {\n    setOrders(getState().orders.filter(o => o.status !== \"completed\"));\n    const unsubscribe = subscribe(() => {\n      setOrders([...getState().orders.filter(o => o.status !== \"completed\")]);\n    });\n    return unsubscribe;\n  }, []);\n\n  const currentUser = getState().currentUser;\n  const filteredOrders = orders.filter((order) =>\n    activeTab === \"received\"\n      ? order.receiverId === currentUser?.id\n      : order.senderId === currentUser?.id\n  );\n\n  return (\n    <ThemedView style={styles.container}>\n      <View style={[styles.tabContainer, { paddingTop: headerHeight + Spacing.lg }]}>\n        <View style={[styles.tabs, { backgroundColor: theme.backgroundDefault }]}>\n          <Pressable\n            onPress={() => setActiveTab(\"received\")}\n            style={[\n              styles.tab,\n              activeTab === \"received\" && { backgroundColor: theme.backgroundRoot },\n            ]}\n          >\n            <ThemedText\n              type=\"small\"\n              style={[\n                styles.tabText,\n                activeTab === \"received\" && { fontWeight: \"600\" },\n              ]}\n            >\n              Received\n            </ThemedText>\n          </Pressable>\n          <Pressable\n            onPress={() => setActiveTab(\"sent\")}\n            style={[\n              styles.tab,\n              activeTab === \"sent\" && { backgroundColor: theme.backgroundRoot },\n            ]}\n          >\n            <ThemedText\n              type=\"small\"\n              style={[\n                styles.tabText,\n                activeTab === \"sent\" && { fontWeight: \"600\" },\n              ]}\n            >\n              Sent\n            </ThemedText>\n          </Pressable>\n        </View>\n      </View>\n\n      <FlatList\n        data={filteredOrders}\n        keyExtractor={(item) => item.id}\n        contentContainerStyle={[\n          styles.listContent,\n          { paddingBottom: tabBarHeight + Spacing[\"3xl\"] },\n        ]}\n        ListEmptyComponent={<EmptyState tab={activeTab} />}\n        renderItem={({ item }) => <OrderCard order={item} mode={activeTab} />}\n        showsVerticalScrollIndicator={false}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  tabContainer: {\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.md,\n  },\n  tabs: {\n    flexDirection: \"row\",\n    borderRadius: BorderRadius.sm,\n    padding: 4,\n  },\n  tab: {\n    flex: 1,\n    paddingVertical: Spacing.sm,\n    alignItems: \"center\",\n    borderRadius: BorderRadius.xs,\n  },\n  tabText: {},\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n    gap: Spacing.md,\n  },\n  orderCard: {\n    padding: Spacing.lg,\n  },\n  orderHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"flex-start\",\n    marginBottom: Spacing.md,\n  },\n  orderInfo: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  badge: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingHorizontal: Spacing.sm,\n    paddingVertical: Spacing.xs,\n    borderRadius: BorderRadius.xs,\n    gap: Spacing.xs,\n  },\n  badgeDot: {\n    width: 6,\n    height: 6,\n    borderRadius: 3,\n  },\n  orderItems: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  itemPreviews: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  itemPreview: {\n    width: 36,\n    height: 36,\n    borderRadius: 8,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 2,\n    borderColor: \"#FFF\",\n  },\n  moreItems: {\n    backgroundColor: Colors.light.primary,\n  },\n  progressContainer: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginTop: Spacing.md,\n    gap: Spacing.sm,\n  },\n  progressBar: {\n    flex: 1,\n    height: 6,\n    borderRadius: 3,\n    overflow: \"hidden\",\n  },\n  progressFill: {\n    height: \"100%\",\n    borderRadius: 3,\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"4xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n  },\n});\n","path":null,"size_bytes":9971,"size_tokens":null},"client/components/KeyboardAwareScrollViewCompat.tsx":{"content":"import { Platform, ScrollView, ScrollViewProps } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\n\ntype Props = KeyboardAwareScrollViewProps & ScrollViewProps;\n\n/**\n * KeyboardAwareScrollView that falls back to ScrollView on web.\n * Use this for any screen containing text inputs.\n */\nexport function KeyboardAwareScrollViewCompat({\n  children,\n  keyboardShouldPersistTaps = \"handled\",\n  ...props\n}: Props) {\n  if (Platform.OS === \"web\") {\n    return (\n      <ScrollView\n        keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n        {...props}\n      >\n        {children}\n      </ScrollView>\n    );\n  }\n\n  return (\n    <KeyboardAwareScrollView\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...props}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n","path":null,"size_bytes":872,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":993,"size_tokens":null},"client/screens/CreateOrderScreen.tsx":{"content":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { \n  View, \n  StyleSheet, \n  TextInput, \n  Pressable, \n  FlatList, \n  Alert,\n  Platform,\n  Modal,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Button } from \"@/components/Button\";\nimport { Card } from \"@/components/Card\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { \n  getState, \n  subscribe, \n  createOrder, \n  addSavedItem,\n  FamilyMember,\n  SavedItem,\n} from \"@/lib/store\";\nimport { sendOrderNotification } from \"@/lib/notifications\";\nimport { getFamilyMembers } from \"@/lib/api\";\nimport { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ninterface OrderItemDraft {\n  id: string;\n  savedItemId: string;\n  svgData: string;\n  name: string | null;\n  quantity: number;\n  note: string;\n}\n\nfunction RecipientPicker({ \n  members, \n  selectedId, \n  onSelect \n}: { \n  members: FamilyMember[]; \n  selectedId: string | null;\n  onSelect: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n  const selected = members.find(m => m.id === selectedId);\n\n  const [showPicker, setShowPicker] = useState(false);\n\n  if (members.length === 0) {\n    return (\n      <View style={[styles.recipientContainer, { backgroundColor: theme.backgroundDefault }]}>\n        <ThemedText type=\"small\" style={{ color: theme.textSecondary }}>\n          No family members connected yet\n        </ThemedText>\n      </View>\n    );\n  }\n\n  return (\n    <>\n      <Pressable\n        onPress={() => setShowPicker(true)}\n        style={[styles.recipientContainer, { backgroundColor: theme.backgroundDefault }]}\n      >\n        <ThemedText type=\"small\" style={{ color: theme.textSecondary }}>\n          Sending to:\n        </ThemedText>\n        <View style={styles.recipientValue}>\n          <ThemedText type=\"h4\" style={{ color: theme.primary }}>\n            {selected?.name || \"Select recipient\"}\n          </ThemedText>\n          <Feather name=\"chevron-down\" size={18} color={theme.primary} />\n        </View>\n      </Pressable>\n\n      <Modal\n        visible={showPicker}\n        animationType=\"slide\"\n        transparent\n        onRequestClose={() => setShowPicker(false)}\n      >\n        <View style={styles.modalOverlay}>\n          <ThemedView style={styles.pickerModal}>\n            <View style={styles.pickerHeader}>\n              <ThemedText type=\"h3\">Select Recipient</ThemedText>\n              <Pressable onPress={() => setShowPicker(false)}>\n                <Feather name=\"x\" size={24} color={theme.text} />\n              </Pressable>\n            </View>\n            <FlatList\n              data={members}\n              keyExtractor={(item) => item.id}\n              renderItem={({ item }) => (\n                <Pressable\n                  onPress={() => {\n                    onSelect(item.id);\n                    setShowPicker(false);\n                  }}\n                  style={[\n                    styles.pickerItem,\n                    item.id === selectedId && { backgroundColor: theme.backgroundDefault },\n                  ]}\n                >\n                  <View style={[styles.pickerAvatar, { backgroundColor: theme.backgroundSecondary }]}>\n                    <Feather name=\"user\" size={20} color={theme.textSecondary} />\n                  </View>\n                  <ThemedText type=\"body\">{item.name}</ThemedText>\n                  {item.id === selectedId ? (\n                    <Feather name=\"check\" size={20} color={theme.primary} style={{ marginLeft: \"auto\" }} />\n                  ) : null}\n                </Pressable>\n              )}\n            />\n          </ThemedView>\n        </View>\n      </Modal>\n    </>\n  );\n}\n\nfunction OrderItemRow({ \n  item, \n  onUpdate, \n  onRemove \n}: { \n  item: OrderItemDraft;\n  onUpdate: (id: string, updates: Partial<OrderItemDraft>) => void;\n  onRemove: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  return (\n    <Card style={styles.itemRow}>\n      <View style={styles.itemRowContent}>\n        <View style={[styles.itemImage, { backgroundColor: theme.backgroundSecondary }]}>\n          <Feather name=\"image\" size={24} color={theme.textTertiary} />\n        </View>\n        <View style={styles.itemDetails}>\n          <View style={styles.quantityRow}>\n            <Pressable\n              onPress={() => {\n                if (item.quantity > 1) {\n                  onUpdate(item.id, { quantity: item.quantity - 1 });\n                }\n              }}\n              style={[styles.quantityButton, { backgroundColor: theme.backgroundSecondary }]}\n            >\n              <Feather name=\"minus\" size={16} color={theme.text} />\n            </Pressable>\n            <ThemedText type=\"h4\" style={styles.quantityText}>\n              {item.quantity}\n            </ThemedText>\n            <Pressable\n              onPress={() => onUpdate(item.id, { quantity: item.quantity + 1 })}\n              style={[styles.quantityButton, { backgroundColor: theme.backgroundSecondary }]}\n            >\n              <Feather name=\"plus\" size={16} color={theme.text} />\n            </Pressable>\n          </View>\n          <TextInput\n            style={[styles.noteInput, { color: theme.text, borderColor: theme.border }]}\n            placeholder=\"Add note (e.g., 1kg, large)\"\n            placeholderTextColor={theme.textTertiary}\n            value={item.note}\n            onChangeText={(text) => onUpdate(item.id, { note: text })}\n          />\n        </View>\n        <Pressable\n          onPress={() => onRemove(item.id)}\n          style={styles.removeButton}\n        >\n          <Feather name=\"x\" size={20} color={Colors.light.statusError} />\n        </Pressable>\n      </View>\n    </Card>\n  );\n}\n\nfunction EmptyItems({ onAddPhoto, onAddFromSaved }: { onAddPhoto: () => void; onAddFromSaved: () => void }) {\n  const { theme } = useTheme();\n\n  return (\n    <View style={styles.emptyItems}>\n      <Pressable\n        onPress={onAddPhoto}\n        style={[styles.emptyButton, { backgroundColor: theme.backgroundDefault }]}\n      >\n        <Feather name=\"camera\" size={48} color={theme.textTertiary} />\n        <ThemedText type=\"body\" style={{ color: theme.textSecondary, marginTop: Spacing.md }}>\n          Take a photo to add item\n        </ThemedText>\n      </Pressable>\n    </View>\n  );\n}\n\nfunction SavedItemsPicker({\n  visible,\n  onClose,\n  onSelect,\n  savedItems,\n}: {\n  visible: boolean;\n  onClose: () => void;\n  onSelect: (item: SavedItem) => void;\n  savedItems: SavedItem[];\n}) {\n  const { theme } = useTheme();\n  const insets = useSafeAreaInsets();\n\n  return (\n    <Modal\n      visible={visible}\n      animationType=\"slide\"\n      transparent\n      onRequestClose={onClose}\n    >\n      <View style={styles.modalOverlay}>\n        <ThemedView style={[styles.savedItemsModal, { paddingBottom: insets.bottom }]}>\n          <View style={styles.pickerHeader}>\n            <ThemedText type=\"h3\">Add from Saved Items</ThemedText>\n            <Pressable onPress={onClose}>\n              <Feather name=\"x\" size={24} color={theme.text} />\n            </Pressable>\n          </View>\n          {savedItems.length === 0 ? (\n            <View style={styles.emptyPicker}>\n              <Feather name=\"inbox\" size={48} color={theme.textTertiary} />\n              <ThemedText type=\"body\" style={{ color: theme.textSecondary, marginTop: Spacing.md }}>\n                No saved items yet\n              </ThemedText>\n            </View>\n          ) : (\n            <FlatList\n              data={savedItems}\n              keyExtractor={(item) => item.id}\n              numColumns={3}\n              contentContainerStyle={styles.savedItemsGrid}\n              renderItem={({ item }) => (\n                <Pressable\n                  onPress={() => {\n                    onSelect(item);\n                    onClose();\n                  }}\n                  style={[styles.savedItemCell, { backgroundColor: theme.backgroundDefault }]}\n                >\n                  <View style={[styles.savedItemImage, { backgroundColor: theme.backgroundSecondary }]}>\n                    <Feather name=\"image\" size={24} color={theme.textTertiary} />\n                  </View>\n                  {item.name ? (\n                    <ThemedText type=\"caption\" numberOfLines={1}>\n                      {item.name}\n                    </ThemedText>\n                  ) : null}\n                </Pressable>\n              )}\n            />\n          )}\n        </ThemedView>\n      </View>\n    </Modal>\n  );\n}\n\nexport default function CreateOrderScreen() {\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  \n  const [items, setItems] = useState<OrderItemDraft[]>([]);\n  const [selectedRecipient, setSelectedRecipient] = useState<string | null>(null);\n  const [familyMembers, setFamilyMembers] = useState<FamilyMember[]>([]);\n  const [savedItems, setSavedItems] = useState<SavedItem[]>([]);\n  const [showSavedPicker, setShowSavedPicker] = useState(false);\n\n  const loadFamilyMembers = useCallback(async () => {\n    const currentUser = getState().currentUser;\n    if (currentUser) {\n      const serverMembers = await getFamilyMembers(currentUser.id);\n      const mappedMembers: FamilyMember[] = serverMembers.map(m => ({\n        id: m.id,\n        userId: m.userId,\n        name: m.name,\n        role: m.role as 'parent' | 'child',\n        avatarSvg: m.avatarSvg,\n        connectedAt: new Date(m.connectedAt).getTime(),\n        status: 'accepted' as const,\n      }));\n      setFamilyMembers(mappedMembers);\n      \n      if (mappedMembers.length === 1 && !selectedRecipient) {\n        setSelectedRecipient(mappedMembers[0].id);\n      }\n    }\n  }, [selectedRecipient]);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadFamilyMembers();\n    }, [loadFamilyMembers])\n  );\n\n  useEffect(() => {\n    const state = getState();\n    setSavedItems(state.savedItems);\n    \n    const unsubscribe = subscribe(() => {\n      const newState = getState();\n      setSavedItems([...newState.savedItems]);\n    });\n    return unsubscribe;\n  }, []);\n\n  const handleAddPhoto = async () => {\n    const { status } = await ImagePicker.requestCameraPermissionsAsync();\n    if (status !== \"granted\") {\n      Alert.alert(\"Permission needed\", \"Please grant camera permissions.\");\n      return;\n    }\n\n    const result = await ImagePicker.launchCameraAsync({\n      quality: 0.3,\n    });\n\n    if (!result.canceled && result.assets[0]) {\n      const saved = addSavedItem({\n        svgData: result.assets[0].uri,\n        name: null,\n        lastNote: null,\n      });\n\n      const newItem: OrderItemDraft = {\n        id: Math.random().toString(36).substr(2, 9),\n        savedItemId: saved.id,\n        svgData: result.assets[0].uri,\n        name: null,\n        quantity: 1,\n        note: \"\",\n      };\n      setItems([...items, newItem]);\n\n      if (Platform.OS !== \"web\") {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      }\n    }\n  };\n\n  const handleAddFromSaved = (savedItem: SavedItem) => {\n    const newItem: OrderItemDraft = {\n      id: Math.random().toString(36).substr(2, 9),\n      savedItemId: savedItem.id,\n      svgData: savedItem.svgData,\n      name: savedItem.name,\n      quantity: 1,\n      note: \"\",\n    };\n    setItems([...items, newItem]);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const handleUpdateItem = (id: string, updates: Partial<OrderItemDraft>) => {\n    setItems(items.map(item => item.id === id ? { ...item, ...updates } : item));\n  };\n\n  const handleRemoveItem = (id: string) => {\n    setItems(items.filter(item => item.id !== id));\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const handleSendOrder = async () => {\n    if (!selectedRecipient) {\n      Alert.alert(\"Select Recipient\", \"Please select who to send this order to.\");\n      return;\n    }\n\n    if (items.length === 0) {\n      Alert.alert(\"Add Items\", \"Please add at least one item to the order.\");\n      return;\n    }\n\n    const recipient = familyMembers.find(m => m.id === selectedRecipient);\n    if (!recipient) return;\n\n    const currentUser = getState().currentUser;\n    \n    createOrder(\n      recipient.userId,\n      recipient.name,\n      items.map(item => ({\n        savedItemId: item.savedItemId,\n        svgData: item.svgData,\n        name: item.name,\n        quantity: item.quantity,\n        note: item.note || null,\n      }))\n    );\n\n    if (currentUser) {\n      sendOrderNotification(currentUser.id, recipient.name, items.length);\n    }\n\n    if (Platform.OS !== \"web\") {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n\n    navigation.goBack();\n  };\n\n  const canSend = items.length > 0 && selectedRecipient !== null;\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={styles.scrollView}\n        contentContainerStyle={[\n          styles.content,\n          { paddingBottom: insets.bottom + Spacing.xl + 80 },\n        ]}\n        showsVerticalScrollIndicator={false}\n      >\n        <RecipientPicker\n          members={familyMembers}\n          selectedId={selectedRecipient}\n          onSelect={setSelectedRecipient}\n        />\n\n        {items.length === 0 ? (\n          <EmptyItems \n            onAddPhoto={handleAddPhoto} \n            onAddFromSaved={() => setShowSavedPicker(true)} \n          />\n        ) : (\n          <View style={styles.itemsList}>\n            {items.map((item) => (\n              <OrderItemRow\n                key={item.id}\n                item={item}\n                onUpdate={handleUpdateItem}\n                onRemove={handleRemoveItem}\n              />\n            ))}\n          </View>\n        )}\n      </KeyboardAwareScrollViewCompat>\n\n      <View style={[styles.footer, { paddingBottom: insets.bottom + Spacing.lg, backgroundColor: theme.backgroundRoot }]}>\n        {items.length > 0 ? (\n          <View style={styles.actionButtons}>\n            <Pressable\n              onPress={() => setShowSavedPicker(true)}\n              style={[styles.secondaryButton, { borderColor: theme.border }]}\n            >\n              <Feather name=\"grid\" size={18} color={theme.text} />\n              <ThemedText type=\"small\">From Saved</ThemedText>\n            </Pressable>\n            <Pressable\n              onPress={handleAddPhoto}\n              style={[styles.secondaryButton, { borderColor: theme.border }]}\n            >\n              <Feather name=\"camera\" size={18} color={theme.text} />\n              <ThemedText type=\"small\">Take Photo</ThemedText>\n            </Pressable>\n          </View>\n        ) : null}\n        <Button onPress={handleSendOrder} disabled={!canSend}>\n          Send Order ({items.length} {items.length === 1 ? \"item\" : \"items\"})\n        </Button>\n      </View>\n\n      <SavedItemsPicker\n        visible={showSavedPicker}\n        onClose={() => setShowSavedPicker(false)}\n        onSelect={handleAddFromSaved}\n        savedItems={savedItems}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  scrollView: {\n    flex: 1,\n  },\n  content: {\n    padding: Spacing.lg,\n    flexGrow: 1,\n  },\n  recipientContainer: {\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.sm,\n    marginBottom: Spacing.lg,\n  },\n  recipientValue: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    marginTop: Spacing.xs,\n  },\n  itemsList: {\n    gap: Spacing.md,\n  },\n  itemRow: {\n    padding: Spacing.md,\n  },\n  itemRowContent: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n  },\n  itemImage: {\n    width: 64,\n    height: 64,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  itemDetails: {\n    flex: 1,\n    gap: Spacing.sm,\n  },\n  quantityRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.md,\n  },\n  quantityButton: {\n    width: 32,\n    height: 32,\n    borderRadius: 16,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  quantityText: {\n    minWidth: 24,\n    textAlign: \"center\",\n  },\n  noteInput: {\n    height: 40,\n    borderWidth: 1,\n    borderRadius: BorderRadius.xs,\n    paddingHorizontal: Spacing.md,\n    fontSize: 14,\n  },\n  removeButton: {\n    padding: Spacing.xs,\n  },\n  emptyItems: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingTop: Spacing[\"4xl\"],\n  },\n  emptyButton: {\n    width: \"100%\",\n    aspectRatio: 1.5,\n    borderRadius: BorderRadius.md,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  footer: {\n    position: \"absolute\",\n    bottom: 0,\n    left: 0,\n    right: 0,\n    padding: Spacing.lg,\n    borderTopWidth: 1,\n    borderTopColor: \"rgba(0,0,0,0.05)\",\n  },\n  actionButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n    marginBottom: Spacing.md,\n  },\n  secondaryButton: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 44,\n    borderWidth: 1,\n    borderRadius: BorderRadius.sm,\n    gap: Spacing.sm,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  pickerModal: {\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n    maxHeight: \"50%\",\n  },\n  savedItemsModal: {\n    borderTopLeftRadius: BorderRadius.lg,\n    borderTopRightRadius: BorderRadius.lg,\n    maxHeight: \"70%\",\n  },\n  pickerHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    padding: Spacing.lg,\n    borderBottomWidth: 1,\n    borderBottomColor: \"rgba(0,0,0,0.05)\",\n  },\n  pickerItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n    gap: Spacing.md,\n  },\n  pickerAvatar: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  savedItemsGrid: {\n    padding: Spacing.md,\n    gap: Spacing.sm,\n  },\n  savedItemCell: {\n    flex: 1,\n    margin: Spacing.xs,\n    padding: Spacing.sm,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n  },\n  savedItemImage: {\n    width: 60,\n    height: 60,\n    borderRadius: BorderRadius.xs,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xs,\n  },\n  emptyPicker: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: Spacing[\"2xl\"],\n  },\n});\n","path":null,"size_bytes":19037,"size_tokens":null},"client/navigation/MainTabNavigator.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { View, StyleSheet, Platform } from \"react-native\";\nimport { createBottomTabNavigator } from \"@react-navigation/bottom-tabs\";\nimport { Feather } from \"@expo/vector-icons\";\nimport { BlurView } from \"expo-blur\";\n\nimport SavedItemsScreen from \"@/screens/SavedItemsScreen\";\nimport TasksScreen from \"@/screens/TasksScreen\";\nimport NotificationsScreen from \"@/screens/NotificationsScreen\";\nimport HistoryScreen from \"@/screens/HistoryScreen\";\nimport FamilyScreen from \"@/screens/FamilyScreen\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { HeaderTitle } from \"@/components/HeaderTitle\";\nimport { Colors } from \"@/constants/theme\";\nimport { getState, subscribe, getUnreadNotificationCount, getUnseenPendingTaskCount, markTasksAsSeen, markAllNotificationsRead } from \"@/lib/store\";\n\nexport type MainTabParamList = {\n  SavedItemsTab: undefined;\n  TasksTab: undefined;\n  NotificationsTab: undefined;\n  HistoryTab: undefined;\n  FamilyTab: undefined;\n};\n\nconst Tab = createBottomTabNavigator<MainTabParamList>();\n\n\nfunction NotificationBadge({ visible }: { visible: boolean }) {\n  if (!visible) return null;\n  \n  return (\n    <View style={styles.badge}>\n      <View style={styles.badgeDot} />\n    </View>\n  );\n}\n\nexport default function MainTabNavigator() {\n  const { theme, isDark } = useTheme();\n  const [userRole, setUserRole] = useState(getState().currentUser?.role || 'parent');\n  const [unreadCount, setUnreadCount] = useState(getUnreadNotificationCount());\n  const [unseenTaskCount, setUnseenTaskCount] = useState(getUnseenPendingTaskCount());\n\n  useEffect(() => {\n    const unsubscribe = subscribe(() => {\n      setUserRole(getState().currentUser?.role || 'parent');\n      setUnreadCount(getUnreadNotificationCount());\n      setUnseenTaskCount(getUnseenPendingTaskCount());\n    });\n    return unsubscribe;\n  }, []);\n\n  const isParent = userRole === 'parent';\n\n  return (\n    <View style={styles.container}>\n      <Tab.Navigator\n        initialRouteName={isParent ? \"SavedItemsTab\" : \"TasksTab\"}\n        screenOptions={{\n          tabBarActiveTintColor: theme.tabIconSelected,\n          tabBarInactiveTintColor: theme.tabIconDefault,\n          tabBarStyle: {\n            position: \"absolute\",\n            backgroundColor: Platform.select({\n              ios: \"transparent\",\n              android: theme.backgroundRoot,\n            }),\n            borderTopWidth: 0,\n            elevation: 0,\n            height: Platform.OS === \"ios\" ? 88 : 64,\n          },\n          tabBarBackground: () =>\n            Platform.OS === \"ios\" ? (\n              <BlurView\n                intensity={100}\n                tint={isDark ? \"dark\" : \"light\"}\n                style={StyleSheet.absoluteFill}\n              />\n            ) : null,\n          headerTintColor: theme.text,\n          headerStyle: {\n            backgroundColor: theme.backgroundRoot,\n          },\n          sceneStyle: {\n            backgroundColor: theme.backgroundRoot,\n          },\n        }}\n      >\n        {isParent ? (\n          <>\n            <Tab.Screen\n              name=\"SavedItemsTab\"\n              component={SavedItemsScreen}\n              options={{\n                title: \"Items\",\n                headerTitle: () => <HeaderTitle title=\"BringIt\" />,\n                tabBarIcon: ({ color, size }) => (\n                  <Feather name=\"grid\" size={size} color={color} />\n                ),\n              }}\n            />\n            <Tab.Screen\n              name=\"NotificationsTab\"\n              component={NotificationsScreen}\n              options={{\n                title: \"Updates\",\n                headerTitle: \"Notifications\",\n                tabBarIcon: ({ color, size }) => (\n                  <View>\n                    <Feather name=\"bell\" size={size} color={color} />\n                    <NotificationBadge visible={unreadCount > 0} />\n                  </View>\n                ),\n              }}\n              listeners={{\n                focus: () => {\n                  markAllNotificationsRead();\n                },\n              }}\n            />\n            <Tab.Screen\n              name=\"HistoryTab\"\n              component={HistoryScreen}\n              options={{\n                title: \"History\",\n                headerTitle: \"History\",\n                tabBarIcon: ({ color, size }) => (\n                  <Feather name=\"clock\" size={size} color={color} />\n                ),\n              }}\n            />\n          </>\n        ) : (\n          <>\n            <Tab.Screen\n              name=\"TasksTab\"\n              component={TasksScreen}\n              options={{\n                title: \"Tasks\",\n                headerTitle: () => <HeaderTitle title=\"BringIt\" />,\n                tabBarIcon: ({ color, size }) => (\n                  <View>\n                    <Feather name=\"check-square\" size={size} color={color} />\n                    <NotificationBadge visible={unseenTaskCount > 0} />\n                  </View>\n                ),\n              }}\n              listeners={{\n                focus: () => {\n                  markTasksAsSeen();\n                },\n              }}\n            />\n            <Tab.Screen\n              name=\"HistoryTab\"\n              component={HistoryScreen}\n              options={{\n                title: \"Completed\",\n                headerTitle: \"Completed Tasks\",\n                tabBarIcon: ({ color, size }) => (\n                  <Feather name=\"check-circle\" size={size} color={color} />\n                ),\n              }}\n            />\n          </>\n        )}\n        <Tab.Screen\n          name=\"FamilyTab\"\n          component={FamilyScreen}\n          options={{\n            title: \"Family\",\n            headerTitle: \"Family Network\",\n            tabBarIcon: ({ color, size }) => (\n              <Feather name=\"users\" size={size} color={color} />\n            ),\n          }}\n        />\n      </Tab.Navigator>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  badge: {\n    position: \"absolute\",\n    top: -2,\n    right: -4,\n  },\n  badgeDot: {\n    width: 10,\n    height: 10,\n    borderRadius: 5,\n    backgroundColor: Colors.light.statusError,\n  },\n});\n","path":null,"size_bytes":6190,"size_tokens":null},"client/components/ThemedText.tsx":{"content":"import { Text, type TextProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { Typography } from \"@/constants/theme\";\n\nexport type ThemedTextProps = TextProps & {\n  lightColor?: string;\n  darkColor?: string;\n  type?: \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"body\" | \"small\" | \"caption\" | \"link\";\n};\n\nexport function ThemedText({\n  style,\n  lightColor,\n  darkColor,\n  type = \"body\",\n  ...rest\n}: ThemedTextProps) {\n  const { theme, isDark } = useTheme();\n\n  const getColor = () => {\n    if (isDark && darkColor) {\n      return darkColor;\n    }\n\n    if (!isDark && lightColor) {\n      return lightColor;\n    }\n\n    if (type === \"link\") {\n      return theme.link;\n    }\n\n    return theme.text;\n  };\n\n  const getTypeStyle = () => {\n    switch (type) {\n      case \"h1\":\n        return Typography.h1;\n      case \"h2\":\n        return Typography.h2;\n      case \"h3\":\n        return Typography.h3;\n      case \"h4\":\n        return Typography.h4;\n      case \"body\":\n        return Typography.body;\n      case \"small\":\n        return Typography.small;\n      case \"caption\":\n        return Typography.caption;\n      case \"link\":\n        return Typography.link;\n      default:\n        return Typography.body;\n    }\n  };\n\n  return (\n    <Text style={[{ color: getColor() }, getTypeStyle(), style]} {...rest} />\n  );\n}\n","path":null,"size_bytes":1320,"size_tokens":null},"client/screens/OrderDetailScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { \n  View, \n  StyleSheet, \n  ScrollView, \n  Pressable, \n  TextInput,\n  Alert,\n  Platform,\n} from \"react-native\";\nimport { useRoute, RouteProp, useNavigation } from \"@react-navigation/native\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Button } from \"@/components/Button\";\nimport { Card } from \"@/components/Card\";\nimport { KeyboardAwareScrollViewCompat } from \"@/components/KeyboardAwareScrollViewCompat\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { \n  getState, \n  subscribe, \n  markItemCompleted,\n  completeOrder,\n  Order,\n  OrderItem,\n} from \"@/lib/store\";\nimport { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\ntype RouteParams = RouteProp<RootStackParamList, \"OrderDetail\">;\n\nfunction OrderItemCard({\n  item,\n  orderId,\n  isReceiver,\n  onMarkCompleted,\n}: {\n  item: OrderItem;\n  orderId: string;\n  isReceiver: boolean;\n  onMarkCompleted: (itemId: string, note?: string) => void;\n}) {\n  const { theme } = useTheme();\n  const [expanded, setExpanded] = useState(false);\n  const [clarificationNote, setClarificationNote] = useState(\"\");\n\n  const handleToggle = () => {\n    if (!isReceiver) return;\n    \n    if (item.completed) {\n      return;\n    }\n\n    if (expanded) {\n      onMarkCompleted(item.id, clarificationNote || undefined);\n      setExpanded(false);\n    } else {\n      setExpanded(true);\n    }\n  };\n\n  return (\n    <Card style={styles.itemCard}>\n      <View style={styles.itemContent}>\n        <View style={[styles.itemImage, { backgroundColor: theme.backgroundSecondary }]}>\n          <Feather name=\"image\" size={32} color={theme.textTertiary} />\n        </View>\n        <View style={styles.itemDetails}>\n          <View style={styles.itemHeader}>\n            <View style={styles.itemInfo}>\n              {item.name ? (\n                <ThemedText type=\"h4\">{item.name}</ThemedText>\n              ) : null}\n              <ThemedText type=\"body\">\n                Qty: {item.quantity}\n              </ThemedText>\n              {item.note ? (\n                <ThemedText type=\"small\" style={{ color: theme.textSecondary }}>\n                  {item.note}\n                </ThemedText>\n              ) : null}\n            </View>\n            {isReceiver ? (\n              <Pressable\n                onPress={handleToggle}\n                style={[\n                  styles.checkbox,\n                  {\n                    backgroundColor: item.completed ? Colors.light.statusCompleted : \"transparent\",\n                    borderColor: item.completed ? Colors.light.statusCompleted : theme.border,\n                  },\n                ]}\n              >\n                {item.completed ? (\n                  <Feather name=\"check\" size={18} color={Colors.light.buttonText} />\n                ) : null}\n              </Pressable>\n            ) : (\n              <View style={[\n                styles.statusIndicator,\n                { backgroundColor: item.completed ? Colors.light.statusCompleted : theme.backgroundSecondary },\n              ]}>\n                {item.completed ? (\n                  <Feather name=\"check\" size={16} color={Colors.light.buttonText} />\n                ) : (\n                  <Feather name=\"clock\" size={16} color={theme.textTertiary} />\n                )}\n              </View>\n            )}\n          </View>\n\n          {expanded && isReceiver && !item.completed ? (\n            <View style={styles.expandedContent}>\n              <TextInput\n                style={[styles.clarificationInput, { color: theme.text, borderColor: theme.border }]}\n                placeholder=\"Add clarification (optional)\"\n                placeholderTextColor={theme.textTertiary}\n                value={clarificationNote}\n                onChangeText={setClarificationNote}\n              />\n              <Pressable\n                onPress={() => {\n                  onMarkCompleted(item.id, clarificationNote || undefined);\n                  setExpanded(false);\n                }}\n                style={[styles.markDoneButton, { backgroundColor: Colors.light.statusCompleted }]}\n              >\n                <Feather name=\"check\" size={16} color={Colors.light.buttonText} />\n                <ThemedText type=\"small\" style={{ color: Colors.light.buttonText, fontWeight: \"600\" }}>\n                  Mark as Found\n                </ThemedText>\n              </Pressable>\n            </View>\n          ) : null}\n\n          {item.clarificationNote ? (\n            <View style={[styles.clarificationBadge, { backgroundColor: theme.backgroundDefault }]}>\n              <Feather name=\"message-circle\" size={14} color={theme.textSecondary} />\n              <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                {item.clarificationNote}\n              </ThemedText>\n            </View>\n          ) : null}\n        </View>\n      </View>\n    </Card>\n  );\n}\n\nexport default function OrderDetailScreen() {\n  const route = useRoute<RouteParams>();\n  const navigation = useNavigation();\n  const headerHeight = useHeaderHeight();\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n\n  const { orderId, mode } = route.params;\n  const isReceiver = mode === \"received\";\n\n  const [order, setOrder] = useState<Order | null>(null);\n\n  useEffect(() => {\n    const foundOrder = getState().orders.find(o => o.id === orderId);\n    setOrder(foundOrder || null);\n\n    const unsubscribe = subscribe(() => {\n      const updated = getState().orders.find(o => o.id === orderId);\n      setOrder(updated || null);\n    });\n    return unsubscribe;\n  }, [orderId]);\n\n  useEffect(() => {\n    if (order) {\n      navigation.setOptions({\n        headerTitle: isReceiver \n          ? `${order.senderName}'s Order`\n          : `Order for ${order.receiverName}`,\n      });\n    }\n  }, [order, isReceiver, navigation]);\n\n  const handleMarkItemCompleted = (itemId: string, note?: string) => {\n    markItemCompleted(orderId, itemId, note);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    }\n  };\n\n  const handleCompleteOrder = () => {\n    Alert.alert(\n      \"Complete Order\",\n      \"Are you sure you want to mark this order as complete?\",\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Complete\",\n          onPress: () => {\n            completeOrder(orderId);\n            if (Platform.OS !== \"web\") {\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n            }\n            navigation.goBack();\n          },\n        },\n      ]\n    );\n  };\n\n  if (!order) {\n    return (\n      <ThemedView style={styles.container}>\n        <View style={[styles.centered, { paddingTop: headerHeight }]}>\n          <ThemedText type=\"body\">Order not found</ThemedText>\n        </View>\n      </ThemedView>\n    );\n  }\n\n  const completedCount = order.items.filter(i => i.completed).length;\n  const totalCount = order.items.length;\n  const allCompleted = completedCount === totalCount;\n\n  return (\n    <ThemedView style={styles.container}>\n      <KeyboardAwareScrollViewCompat\n        style={styles.scrollView}\n        contentContainerStyle={[\n          styles.content,\n          {\n            paddingTop: headerHeight + Spacing.lg,\n            paddingBottom: insets.bottom + Spacing.xl + (isReceiver ? 80 : 0),\n          },\n        ]}\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={[styles.progressCard, { backgroundColor: theme.backgroundDefault }]}>\n          <View style={styles.progressInfo}>\n            <ThemedText type=\"h4\">\n              {completedCount} of {totalCount} items found\n            </ThemedText>\n            <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n              {order.status === \"completed\" \n                ? \"Order completed\"\n                : order.status === \"in_progress\"\n                  ? \"In progress\"\n                  : \"Pending\"}\n            </ThemedText>\n          </View>\n          <View style={[styles.progressBar, { backgroundColor: theme.backgroundSecondary }]}>\n            <View\n              style={[\n                styles.progressFill,\n                {\n                  backgroundColor: allCompleted \n                    ? Colors.light.statusCompleted \n                    : Colors.light.statusInProgress,\n                  width: `${(completedCount / totalCount) * 100}%`,\n                },\n              ]}\n            />\n          </View>\n        </View>\n\n        <View style={styles.itemsList}>\n          {order.items.map((item) => (\n            <OrderItemCard\n              key={item.id}\n              item={item}\n              orderId={orderId}\n              isReceiver={isReceiver}\n              onMarkCompleted={handleMarkItemCompleted}\n            />\n          ))}\n        </View>\n      </KeyboardAwareScrollViewCompat>\n\n      {isReceiver && order.status !== \"completed\" ? (\n        <View style={[styles.footer, { paddingBottom: insets.bottom + Spacing.lg, backgroundColor: theme.backgroundRoot }]}>\n          <Button onPress={handleCompleteOrder} disabled={!allCompleted}>\n            Mark Order Complete\n          </Button>\n        </View>\n      ) : null}\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  centered: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  scrollView: {\n    flex: 1,\n  },\n  content: {\n    padding: Spacing.lg,\n  },\n  progressCard: {\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.xl,\n  },\n  progressInfo: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    marginBottom: Spacing.md,\n  },\n  progressBar: {\n    height: 8,\n    borderRadius: 4,\n    overflow: \"hidden\",\n  },\n  progressFill: {\n    height: \"100%\",\n    borderRadius: 4,\n  },\n  itemsList: {\n    gap: Spacing.md,\n  },\n  itemCard: {\n    padding: Spacing.lg,\n  },\n  itemContent: {\n    flexDirection: \"row\",\n  },\n  itemImage: {\n    width: 80,\n    height: 80,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.lg,\n  },\n  itemDetails: {\n    flex: 1,\n    gap: Spacing.sm,\n  },\n  itemHeader: {\n    flexDirection: \"row\",\n    alignItems: \"flex-start\",\n  },\n  itemInfo: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  checkbox: {\n    width: 28,\n    height: 28,\n    borderRadius: 8,\n    borderWidth: 2,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  statusIndicator: {\n    width: 28,\n    height: 28,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  expandedContent: {\n    marginTop: Spacing.sm,\n    gap: Spacing.sm,\n  },\n  clarificationInput: {\n    height: 40,\n    borderWidth: 1,\n    borderRadius: BorderRadius.xs,\n    paddingHorizontal: Spacing.md,\n    fontSize: 14,\n  },\n  markDoneButton: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: 40,\n    borderRadius: BorderRadius.xs,\n    gap: Spacing.sm,\n  },\n  clarificationBadge: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.sm,\n    borderRadius: BorderRadius.xs,\n    gap: Spacing.xs,\n    marginTop: Spacing.xs,\n  },\n  footer: {\n    position: \"absolute\",\n    bottom: 0,\n    left: 0,\n    right: 0,\n    padding: Spacing.lg,\n    borderTopWidth: 1,\n    borderTopColor: \"rgba(0,0,0,0.05)\",\n  },\n});\n","path":null,"size_bytes":11733,"size_tokens":null},"client/screens/FamilyScreen.tsx":{"content":"import React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport { View, StyleSheet, FlatList, Pressable, Alert, Platform, Image, Modal, TextInput, KeyboardAvoidingView, ActivityIndicator } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Button } from \"@/components/Button\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { \n  getState, \n  subscribe, \n  FamilyMember,\n  ConnectionRequest,\n} from \"@/lib/store\";\nimport {\n  sendConnectionRequest as sendConnectionRequestApi,\n  getIncomingRequests,\n  getOutgoingRequests,\n  acceptConnectionRequest as acceptConnectionRequestApi,\n  rejectConnectionRequest as rejectConnectionRequestApi,\n  getFamilyMembers,\n  deleteFamilyConnection,\n  ServerConnectionRequest,\n} from \"@/lib/api\";\nimport { RootStackParamList } from \"@/navigation/RootStackNavigator\";\n\nfunction ProfileCard() {\n  const { theme } = useTheme();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const currentUser = getState().currentUser;\n\n  const handleShowQR = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    navigation.navigate(\"QRCode\");\n  };\n\n  return (\n    <Card style={styles.profileCard}>\n      <View style={styles.profileHeader}>\n        <View style={[styles.profileAvatar, { backgroundColor: theme.backgroundSecondary }]}>\n          {currentUser?.avatarSvg ? (\n            <Image \n              source={{ uri: currentUser.avatarSvg }} \n              style={styles.avatarImage}\n            />\n          ) : (\n            <Feather name=\"user\" size={32} color={theme.textSecondary} />\n          )}\n        </View>\n        <View style={styles.profileInfo}>\n          <ThemedText type=\"h3\">{currentUser?.name || \"Your Profile\"}</ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            ID: {currentUser?.id?.slice(0, 8) || \"---\"}\n          </ThemedText>\n        </View>\n      </View>\n      <View style={styles.profileActions}>\n        <Pressable\n          onPress={handleShowQR}\n          style={({ pressed }) => [\n            styles.profileButton,\n            { \n              backgroundColor: theme.primary,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <Feather name=\"maximize\" size={18} color={Colors.light.buttonText} />\n          <ThemedText type=\"small\" style={{ color: Colors.light.buttonText, fontWeight: \"600\" }}>\n            Show QR Code\n          </ThemedText>\n        </Pressable>\n      </View>\n    </Card>\n  );\n}\n\nfunction FamilyMemberCard({ \n  member, \n  onDelete \n}: { \n  member: FamilyMember; \n  onDelete: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  const handleLongPress = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    }\n    Alert.alert(\n      \"Remove Connection\",\n      `Are you sure you want to disconnect from ${member.name}?`,\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Remove\",\n          style: \"destructive\",\n          onPress: () => onDelete(member.id),\n        },\n      ]\n    );\n  };\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleDateString([], {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  };\n\n  return (\n    <Card style={styles.memberCard} onPress={() => {}}>\n      <Pressable onLongPress={handleLongPress} style={styles.memberContent}>\n        <View style={[styles.memberAvatar, { backgroundColor: theme.backgroundSecondary }]}>\n          {member.avatarSvg ? (\n            <Image source={{ uri: member.avatarSvg }} style={styles.avatarImage} />\n          ) : (\n            <Feather name=\"user\" size={24} color={theme.textSecondary} />\n          )}\n        </View>\n        <View style={styles.memberInfo}>\n          <ThemedText type=\"h4\">{member.name}</ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            Connected {formatDate(member.connectedAt)}\n          </ThemedText>\n        </View>\n        <Feather name=\"chevron-right\" size={20} color={theme.textTertiary} />\n      </Pressable>\n    </Card>\n  );\n}\n\nfunction IncomingRequestCard({ \n  request, \n  onAccept,\n  onReject,\n}: { \n  request: ServerConnectionRequest;\n  onAccept: (id: string) => void;\n  onReject: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  return (\n    <Card style={styles.pendingCard}>\n      <View style={styles.memberContent}>\n        <View style={[styles.memberAvatar, { backgroundColor: theme.backgroundSecondary }]}>\n          {request.fromUserAvatar ? (\n            <Image source={{ uri: request.fromUserAvatar }} style={styles.avatarImage} />\n          ) : (\n            <Feather name=\"user\" size={24} color={theme.textSecondary} />\n          )}\n        </View>\n        <View style={styles.memberInfo}>\n          <ThemedText type=\"h4\">{request.fromUserName}</ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.primary }}>\n            {request.fromUserRole === 'parent' ? 'Parent' : 'Child'} wants to connect\n          </ThemedText>\n        </View>\n      </View>\n      <View style={styles.pendingActions}>\n        <Pressable\n          onPress={() => onReject(request.id.toString())}\n          style={[styles.actionButton, { backgroundColor: theme.backgroundSecondary }]}\n        >\n          <Feather name=\"x\" size={18} color={theme.text} />\n        </Pressable>\n        <Pressable\n          onPress={() => onAccept(request.id.toString())}\n          style={[styles.actionButton, { backgroundColor: Colors.light.statusCompleted }]}\n        >\n          <Feather name=\"check\" size={18} color={Colors.light.buttonText} />\n        </Pressable>\n      </View>\n    </Card>\n  );\n}\n\nfunction OutgoingRequestCard({ \n  request, \n  onCancel,\n}: { \n  request: ServerConnectionRequest;\n  onCancel: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  return (\n    <Card style={[styles.pendingCard, { borderColor: theme.textTertiary }]}>\n      <View style={styles.memberContent}>\n        <View style={[styles.memberAvatar, { backgroundColor: theme.backgroundSecondary }]}>\n          <Feather name=\"user\" size={24} color={theme.textSecondary} />\n        </View>\n        <View style={styles.memberInfo}>\n          <ThemedText type=\"h4\">{request.toUserName || 'Unknown User'}</ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            Waiting for response...\n          </ThemedText>\n        </View>\n      </View>\n      <View style={styles.pendingActions}>\n        <Pressable\n          onPress={() => onCancel(request.id.toString())}\n          style={[styles.actionButton, { backgroundColor: theme.backgroundSecondary }]}\n        >\n          <Feather name=\"x\" size={18} color={theme.text} />\n        </Pressable>\n      </View>\n    </Card>\n  );\n}\n\nfunction EmptyState({ onAddMember, isParent }: { onAddMember: () => void; isParent: boolean }) {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"users\" size={64} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No Family Members Yet\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        {isParent \n          ? \"Add family members to start sharing orders\"\n          : \"Ask a parent to add you to their family\"}\n      </ThemedText>\n      {isParent ? (\n        <Button onPress={onAddMember} style={styles.addButton}>\n          Add Family Member\n        </Button>\n      ) : null}\n    </View>\n  );\n}\n\nfunction ConnectMemberModal({\n  visible,\n  onClose,\n  onScanQR,\n  onEnterCode,\n}: {\n  visible: boolean;\n  onClose: () => void;\n  onScanQR: () => void;\n  onEnterCode: () => void;\n}) {\n  const { theme } = useTheme();\n\n  return (\n    <Modal\n      visible={visible}\n      transparent\n      animationType=\"fade\"\n      onRequestClose={onClose}\n    >\n      <Pressable style={styles.modalOverlay} onPress={onClose}>\n        <Pressable style={[styles.modalContent, { backgroundColor: theme.backgroundDefault }]} onPress={() => {}}>\n          <ThemedText type=\"h3\" style={styles.modalTitle}>Connect Family Member</ThemedText>\n          <ThemedText type=\"body\" style={[styles.modalSubtitle, { color: theme.textSecondary }]}>\n            Family members must create their own profile first, then connect via QR code or user code\n          </ThemedText>\n          <View style={styles.connectOptions}>\n            <Pressable\n              onPress={onScanQR}\n              style={({ pressed }) => [\n                styles.connectOption,\n                { \n                  backgroundColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <View style={[styles.connectIconWrap, { backgroundColor: theme.primary }]}>\n                <Feather name=\"camera\" size={24} color={Colors.light.buttonText} />\n              </View>\n              <View style={styles.connectOptionText}>\n                <ThemedText type=\"h4\">Scan QR Code</ThemedText>\n                <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                  Scan their QR code from Family tab\n                </ThemedText>\n              </View>\n              <Feather name=\"chevron-right\" size={20} color={theme.textTertiary} />\n            </Pressable>\n            <Pressable\n              onPress={onEnterCode}\n              style={({ pressed }) => [\n                styles.connectOption,\n                { \n                  backgroundColor: theme.backgroundSecondary,\n                  opacity: pressed ? 0.8 : 1,\n                },\n              ]}\n            >\n              <View style={[styles.connectIconWrap, { backgroundColor: theme.primary }]}>\n                <Feather name=\"hash\" size={24} color={Colors.light.buttonText} />\n              </View>\n              <View style={styles.connectOptionText}>\n                <ThemedText type=\"h4\">Enter User Code</ThemedText>\n                <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n                  Type their 8-character code\n                </ThemedText>\n              </View>\n              <Feather name=\"chevron-right\" size={20} color={theme.textTertiary} />\n            </Pressable>\n          </View>\n          <Pressable\n            onPress={onClose}\n            style={[styles.cancelButton, { backgroundColor: theme.backgroundSecondary }]}\n          >\n            <ThemedText type=\"body\" style={{ fontWeight: \"600\" }}>Cancel</ThemedText>\n          </Pressable>\n        </Pressable>\n      </Pressable>\n    </Modal>\n  );\n}\n\nfunction EnterCodeModal({\n  visible,\n  onClose,\n  onSubmit,\n  isLoading,\n  error,\n}: {\n  visible: boolean;\n  onClose: () => void;\n  onSubmit: (code: string) => void;\n  isLoading?: boolean;\n  error?: string | null;\n}) {\n  const { theme } = useTheme();\n  const [code, setCode] = useState(\"\");\n\n  const handleSubmit = () => {\n    if (code.trim().length >= 8 && !isLoading) {\n      onSubmit(code.trim());\n    }\n  };\n\n  const handleCancel = () => {\n    setCode(\"\");\n    onClose();\n  };\n\n  return (\n    <Modal\n      visible={visible}\n      transparent\n      animationType=\"fade\"\n      onRequestClose={handleCancel}\n    >\n      <KeyboardAvoidingView\n        behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n        style={styles.modalKeyboardAvoid}\n      >\n        <Pressable style={styles.modalOverlay} onPress={handleCancel}>\n          <Pressable style={[styles.modalContent, { backgroundColor: theme.backgroundDefault }]} onPress={() => {}}>\n            <ThemedText type=\"h3\" style={styles.modalTitle}>Enter User Code</ThemedText>\n            <ThemedText type=\"body\" style={[styles.modalSubtitle, { color: theme.textSecondary }]}>\n              Ask them for their 8-character code from their Family tab\n            </ThemedText>\n            <TextInput\n              style={[\n                styles.modalInput,\n                {\n                  backgroundColor: theme.backgroundSecondary,\n                  color: theme.text,\n                  borderColor: error ? Colors.light.statusError : theme.backgroundTertiary,\n                  textAlign: \"center\",\n                  fontSize: 20,\n                  letterSpacing: 2,\n                  textTransform: \"uppercase\",\n                },\n              ]}\n              placeholder=\"XXXXXXXX\"\n              placeholderTextColor={theme.textTertiary}\n              value={code}\n              onChangeText={(text) => setCode(text.slice(0, 12))}\n              autoFocus\n              autoCapitalize=\"characters\"\n              editable={!isLoading}\n            />\n            {error ? (\n              <ThemedText type=\"small\" style={{ color: Colors.light.statusError, marginTop: Spacing.xs, textAlign: 'center' }}>\n                {error}\n              </ThemedText>\n            ) : null}\n            <View style={styles.modalButtons}>\n              <Pressable\n                onPress={handleCancel}\n                style={[styles.modalButton, { backgroundColor: theme.backgroundSecondary }]}\n              >\n                <ThemedText type=\"body\" style={{ fontWeight: \"600\" }}>Cancel</ThemedText>\n              </Pressable>\n              <Pressable\n                onPress={handleSubmit}\n                style={[styles.modalButton, { backgroundColor: theme.primary, opacity: code.length >= 8 && !isLoading ? 1 : 0.5 }]}\n                disabled={code.length < 8 || isLoading}\n              >\n                {isLoading ? (\n                  <ActivityIndicator size=\"small\" color={Colors.light.buttonText} />\n                ) : (\n                  <ThemedText type=\"body\" style={{ color: Colors.light.buttonText, fontWeight: \"600\" }}>Connect</ThemedText>\n                )}\n              </Pressable>\n            </View>\n          </Pressable>\n        </Pressable>\n      </KeyboardAvoidingView>\n    </Modal>\n  );\n}\n\nexport default function FamilyScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const navigation = useNavigation<NativeStackNavigationProp<RootStackParamList>>();\n  const [familyMembers, setFamilyMembers] = useState<FamilyMember[]>([]);\n  const [incomingRequests, setIncomingRequests] = useState<ServerConnectionRequest[]>([]);\n  const [outgoingRequests, setOutgoingRequests] = useState<ServerConnectionRequest[]>([]);\n  const [showConnectModal, setShowConnectModal] = useState(false);\n  const [showEnterCodeModal, setShowEnterCodeModal] = useState(false);\n  const [isParent, setIsParent] = useState(getState().currentUser?.role === 'parent');\n  const [isLoading, setIsLoading] = useState(false);\n  const [codeError, setCodeError] = useState<string | null>(null);\n  const pollingRef = useRef<NodeJS.Timeout | null>(null);\n\n  const fetchData = useCallback(async () => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    try {\n      const [incoming, outgoing, members] = await Promise.all([\n        getIncomingRequests(currentUser.id),\n        getOutgoingRequests(currentUser.id),\n        getFamilyMembers(currentUser.id),\n      ]);\n      \n      setIncomingRequests(incoming);\n      setOutgoingRequests(outgoing);\n      setFamilyMembers(members.map(m => ({\n        id: m.id,\n        userId: m.userId,\n        name: m.name,\n        role: m.role as 'parent' | 'child',\n        avatarSvg: m.avatarSvg,\n        connectedAt: new Date(m.connectedAt).getTime(),\n        status: 'accepted' as const,\n      })));\n    } catch (error) {\n      console.error(\"Error fetching family data:\", error);\n    }\n  }, []);\n\n  useFocusEffect(\n    useCallback(() => {\n      fetchData();\n      pollingRef.current = setInterval(fetchData, 5000);\n      \n      return () => {\n        if (pollingRef.current) {\n          clearInterval(pollingRef.current);\n          pollingRef.current = null;\n        }\n      };\n    }, [fetchData])\n  );\n\n  useEffect(() => {\n    const newState = getState();\n    setIsParent(newState.currentUser?.role === 'parent');\n  }, []);\n\n  const handleDelete = async (id: string) => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    const success = await deleteFamilyConnection(id, currentUser.id);\n    if (success) {\n      if (Platform.OS !== \"web\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      }\n      fetchData();\n    } else {\n      Alert.alert(\"Error\", \"Failed to remove connection. Please try again.\");\n    }\n  };\n\n  const handleAcceptRequest = async (requestId: string) => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    const result = await acceptConnectionRequestApi(parseInt(requestId), currentUser.id);\n    if (result.success) {\n      if (Platform.OS !== \"web\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      }\n      fetchData();\n    }\n  };\n\n  const handleRejectRequest = async (requestId: string) => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    await rejectConnectionRequestApi(parseInt(requestId), currentUser.id);\n    if (Platform.OS !== \"web\") {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n    fetchData();\n  };\n\n  const handleCancelRequest = async (requestId: string) => {\n    const currentUser = getState().currentUser;\n    if (!currentUser) return;\n    \n    await rejectConnectionRequestApi(parseInt(requestId), currentUser.id);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    fetchData();\n  };\n\n  const handleAddMember = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    setShowConnectModal(true);\n  };\n\n  const handleScanQR = () => {\n    setShowConnectModal(false);\n    navigation.navigate(\"QRScanner\");\n  };\n\n  const handleEnterCode = () => {\n    setShowConnectModal(false);\n    setCodeError(null);\n    setShowEnterCodeModal(true);\n  };\n\n  const handleCodeSubmit = async (code: string) => {\n    const trimmedCode = code.trim();\n    setCodeError(null);\n    \n    if (!trimmedCode) {\n      setCodeError(\"Please enter a valid code.\");\n      return;\n    }\n    \n    const currentUser = getState().currentUser;\n    if (!currentUser) {\n      setCodeError(\"Please set up your profile first.\");\n      return;\n    }\n    \n    if (trimmedCode === currentUser.id) {\n      setCodeError(\"You cannot connect with yourself.\");\n      return;\n    }\n    \n    setIsLoading(true);\n    \n    const result = await sendConnectionRequestApi({\n      fromUserId: currentUser.id,\n      fromUserName: currentUser.name,\n      fromUserRole: currentUser.role,\n      fromUserAvatar: currentUser.avatarSvg,\n      toUserId: trimmedCode.toLowerCase(),\n    });\n    \n    setIsLoading(false);\n    \n    if (result.success) {\n      setShowEnterCodeModal(false);\n      Alert.alert(\n        \"Request Sent\",\n        `A connection request has been sent to ${result.targetUser?.name || 'this user'}. They will need to accept it on their device.`,\n        [{ text: \"OK\" }]\n      );\n      if (Platform.OS !== \"web\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      }\n      fetchData();\n    } else {\n      setCodeError(result.error || \"Could not send connection request. Please try again.\");\n    }\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={familyMembers}\n        keyExtractor={(item) => item.id}\n        contentContainerStyle={[\n          styles.listContent,\n          {\n            paddingTop: headerHeight + Spacing.lg,\n            paddingBottom: tabBarHeight + Spacing[\"3xl\"],\n          },\n        ]}\n        ListHeaderComponent={\n          <>\n            <ProfileCard />\n            {incomingRequests.length > 0 ? (\n              <View style={styles.section}>\n                <ThemedText type=\"caption\" style={[styles.sectionTitle, { color: theme.textSecondary }]}>\n                  Connection Requests\n                </ThemedText>\n                {incomingRequests.map((request) => (\n                  <IncomingRequestCard\n                    key={request.id}\n                    request={request}\n                    onAccept={handleAcceptRequest}\n                    onReject={handleRejectRequest}\n                  />\n                ))}\n              </View>\n            ) : null}\n            {isParent && outgoingRequests.length > 0 ? (\n              <View style={styles.section}>\n                <ThemedText type=\"caption\" style={[styles.sectionTitle, { color: theme.textSecondary }]}>\n                  Pending Invites\n                </ThemedText>\n                {outgoingRequests.map((request) => (\n                  <OutgoingRequestCard\n                    key={request.id}\n                    request={request}\n                    onCancel={handleCancelRequest}\n                  />\n                ))}\n              </View>\n            ) : null}\n            {familyMembers.length > 0 ? (\n              <View style={styles.sectionHeader}>\n                <ThemedText type=\"caption\" style={[styles.sectionTitle, { color: theme.textSecondary }]}>\n                  Connected Family\n                </ThemedText>\n                {isParent ? (\n                  <Pressable\n                    onPress={handleAddMember}\n                    style={({ pressed }) => [\n                      styles.addIconButton,\n                      { opacity: pressed ? 0.7 : 1 },\n                    ]}\n                  >\n                    <Feather name=\"user-plus\" size={20} color={theme.primary} />\n                  </Pressable>\n                ) : null}\n              </View>\n            ) : null}\n          </>\n        }\n        ListEmptyComponent={<EmptyState onAddMember={handleAddMember} isParent={isParent} />}\n        renderItem={({ item }) => (\n          <FamilyMemberCard member={item} onDelete={handleDelete} />\n        )}\n        showsVerticalScrollIndicator={false}\n      />\n      <ConnectMemberModal\n        visible={showConnectModal}\n        onClose={() => setShowConnectModal(false)}\n        onScanQR={handleScanQR}\n        onEnterCode={handleEnterCode}\n      />\n      <EnterCodeModal\n        visible={showEnterCodeModal}\n        onClose={() => {\n          setShowEnterCodeModal(false);\n          setCodeError(null);\n        }}\n        onSubmit={handleCodeSubmit}\n        isLoading={isLoading}\n        error={codeError}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  profileCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing.xl,\n  },\n  profileHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  profileAvatar: {\n    width: 64,\n    height: 64,\n    borderRadius: 32,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.lg,\n  },\n  avatarImage: {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: 32,\n  },\n  profileInfo: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  profileActions: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  profileButton: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingVertical: Spacing.md,\n    borderRadius: BorderRadius.sm,\n    gap: Spacing.sm,\n  },\n  section: {\n    marginBottom: Spacing.xl,\n  },\n  sectionHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    marginBottom: Spacing.sm,\n  },\n  sectionTitle: {\n    marginLeft: Spacing.xs,\n    textTransform: \"uppercase\",\n    letterSpacing: 0.5,\n  },\n  addIconButton: {\n    padding: Spacing.xs,\n  },\n  memberCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing.sm,\n  },\n  pendingCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing.sm,\n    borderWidth: 2,\n    borderColor: Colors.light.primary,\n  },\n  memberContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  memberAvatar: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  memberInfo: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  pendingActions: {\n    flexDirection: \"row\",\n    gap: Spacing.sm,\n    marginTop: Spacing.md,\n    justifyContent: \"flex-end\",\n  },\n  actionButton: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"2xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n    marginBottom: Spacing.xl,\n  },\n  addButton: {\n    width: 200,\n  },\n  modalKeyboardAvoid: {\n    flex: 1,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: Spacing.xl,\n  },\n  modalContent: {\n    width: \"100%\",\n    maxWidth: 320,\n    borderRadius: BorderRadius.lg,\n    padding: Spacing.xl,\n  },\n  modalTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.xs,\n  },\n  modalSubtitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.lg,\n  },\n  modalInput: {\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    paddingHorizontal: Spacing.md,\n    fontSize: 16,\n    marginBottom: Spacing.lg,\n    borderWidth: 1,\n  },\n  modalButtons: {\n    flexDirection: \"row\",\n    gap: Spacing.md,\n  },\n  modalButton: {\n    flex: 1,\n    height: 44,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  connectOptions: {\n    gap: Spacing.md,\n    marginBottom: Spacing.lg,\n  },\n  connectOption: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    gap: Spacing.md,\n  },\n  connectIconWrap: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  connectOptionText: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  cancelButton: {\n    height: 44,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n","path":null,"size_bytes":27287,"size_tokens":null},"client/components/ThemedView.tsx":{"content":"import { View, type ViewProps } from \"react-native\";\n\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type ThemedViewProps = ViewProps & {\n  lightColor?: string;\n  darkColor?: string;\n};\n\nexport function ThemedView({\n  style,\n  lightColor,\n  darkColor,\n  ...otherProps\n}: ThemedViewProps) {\n  const { theme, isDark } = useTheme();\n\n  const backgroundColor =\n    isDark && darkColor\n      ? darkColor\n      : !isDark && lightColor\n        ? lightColor\n        : theme.backgroundRoot;\n\n  return <View style={[{ backgroundColor }, style]} {...otherProps} />;\n}\n","path":null,"size_bytes":563,"size_tokens":null},"client/screens/QRCodeScreen.tsx":{"content":"import React from \"react\";\nimport { View, StyleSheet, Pressable, Platform, Share } from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\nimport QRCode from \"react-native-qrcode-svg\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Button } from \"@/components/Button\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getState } from \"@/lib/store\";\n\nexport default function QRCodeScreen() {\n  const insets = useSafeAreaInsets();\n  const { theme } = useTheme();\n  const currentUser = getState().currentUser;\n\n  const handleShare = async () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n    \n    try {\n      await Share.share({\n        message: `Connect with me on BringIt! My code is: ${currentUser?.id || \"---\"}`,\n      });\n    } catch (error) {\n      console.log(\"Share error:\", error);\n    }\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <View style={[styles.content, { paddingBottom: insets.bottom + Spacing.xl }]}>\n        <View style={styles.qrContainer}>\n          <View style={[styles.qrCode, { backgroundColor: \"#FFFFFF\" }]}>\n            {currentUser?.id ? (\n              <QRCode\n                value={currentUser.id}\n                size={240}\n                color=\"#000000\"\n                backgroundColor=\"#FFFFFF\"\n                ecl=\"H\"\n              />\n            ) : (\n              <View style={styles.qrPlaceholder}>\n                <Feather name=\"loader\" size={40} color={theme.textTertiary} />\n              </View>\n            )}\n          </View>\n          \n          <ThemedText type=\"h3\" style={styles.name}>\n            {currentUser?.name || \"Your Name\"}\n          </ThemedText>\n          \n          <View style={[styles.codeContainer, { backgroundColor: theme.backgroundDefault }]}>\n            <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n              Your Code\n            </ThemedText>\n            <ThemedText type=\"h4\" style={{ fontFamily: \"monospace\" }}>\n              {currentUser?.id?.slice(0, 8) || \"--------\"}\n            </ThemedText>\n          </View>\n        </View>\n\n        <View style={styles.instructions}>\n          <View style={styles.instructionRow}>\n            <View style={[styles.stepNumber, { backgroundColor: theme.primary }]}>\n              <ThemedText type=\"caption\" style={{ color: Colors.light.buttonText, fontWeight: \"600\" }}>\n                1\n              </ThemedText>\n            </View>\n            <ThemedText type=\"body\" style={{ flex: 1 }}>\n              Ask your family member to open BringIt\n            </ThemedText>\n          </View>\n          <View style={styles.instructionRow}>\n            <View style={[styles.stepNumber, { backgroundColor: theme.primary }]}>\n              <ThemedText type=\"caption\" style={{ color: Colors.light.buttonText, fontWeight: \"600\" }}>\n                2\n              </ThemedText>\n            </View>\n            <ThemedText type=\"body\" style={{ flex: 1 }}>\n              They tap \"Add Family Member\" and scan this code\n            </ThemedText>\n          </View>\n        </View>\n\n        <Button onPress={handleShare} style={styles.shareButton}>\n          Share Code\n        </Button>\n      </View>\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  content: {\n    flex: 1,\n    padding: Spacing.xl,\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  qrContainer: {\n    alignItems: \"center\",\n    marginTop: Spacing.xl,\n  },\n  qrCode: {\n    padding: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.xl,\n  },\n  qrPlaceholder: {\n    width: 240,\n    height: 240,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  name: {\n    marginBottom: Spacing.md,\n    textAlign: \"center\",\n  },\n  codeContainer: {\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.xl,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    gap: Spacing.xs,\n  },\n  instructions: {\n    width: \"100%\",\n    gap: Spacing.lg,\n  },\n  instructionRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: Spacing.md,\n  },\n  stepNumber: {\n    width: 24,\n    height: 24,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  shareButton: {\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":4558,"size_tokens":null},"client/components/Button.tsx":{"content":"import React, { ReactNode } from \"react\";\nimport { StyleSheet, Pressable, ViewStyle, StyleProp } from \"react-native\";\nimport Animated, {\n  useAnimatedStyle,\n  useSharedValue,\n  withSpring,\n  WithSpringConfig,\n} from \"react-native-reanimated\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { BorderRadius, Spacing } from \"@/constants/theme\";\n\ninterface ButtonProps {\n  onPress?: () => void;\n  children: ReactNode;\n  style?: StyleProp<ViewStyle>;\n  disabled?: boolean;\n}\n\nconst springConfig: WithSpringConfig = {\n  damping: 15,\n  mass: 0.3,\n  stiffness: 150,\n  overshootClamping: true,\n  energyThreshold: 0.001,\n};\n\nconst AnimatedPressable = Animated.createAnimatedComponent(Pressable);\n\nexport function Button({\n  onPress,\n  children,\n  style,\n  disabled = false,\n}: ButtonProps) {\n  const { theme } = useTheme();\n  const scale = useSharedValue(1);\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  const handlePressIn = () => {\n    if (!disabled) {\n      scale.value = withSpring(0.98, springConfig);\n    }\n  };\n\n  const handlePressOut = () => {\n    if (!disabled) {\n      scale.value = withSpring(1, springConfig);\n    }\n  };\n\n  return (\n    <AnimatedPressable\n      onPress={disabled ? undefined : onPress}\n      onPressIn={handlePressIn}\n      onPressOut={handlePressOut}\n      disabled={disabled}\n      style={[\n        styles.button,\n        {\n          backgroundColor: theme.link,\n          opacity: disabled ? 0.5 : 1,\n        },\n        style,\n        animatedStyle,\n      ]}\n    >\n      <ThemedText\n        type=\"body\"\n        style={[styles.buttonText, { color: theme.buttonText }]}\n      >\n        {children}\n      </ThemedText>\n    </AnimatedPressable>\n  );\n}\n\nconst styles = StyleSheet.create({\n  button: {\n    height: Spacing.buttonHeight,\n    borderRadius: BorderRadius.full,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  buttonText: {\n    fontWeight: \"600\",\n  },\n});\n","path":null,"size_bytes":2014,"size_tokens":null},"client/hooks/useTheme.ts":{"content":"import { Colors } from \"@/constants/theme\";\nimport { useColorScheme } from \"@/hooks/useColorScheme\";\n\nexport function useTheme() {\n  const colorScheme = useColorScheme();\n  const isDark = colorScheme === \"dark\";\n  const theme = Colors[colorScheme ?? \"light\"];\n\n  return {\n    theme,\n    isDark,\n  };\n}\n","path":null,"size_bytes":302,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/index.js":{"content":"import { registerRootComponent } from \"expo\";\n\nimport App from \"@/App\";\n\nregisterRootComponent(App);\n","path":null,"size_bytes":101,"size_tokens":null},"client/navigation/RootStackNavigator.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { createNativeStackNavigator } from \"@react-navigation/native-stack\";\n\nimport MainTabNavigator from \"@/navigation/MainTabNavigator\";\nimport ProfileSetupScreen from \"@/screens/ProfileSetupScreen\";\nimport CreateOrderScreen from \"@/screens/CreateOrderScreen\";\nimport OrderDetailScreen from \"@/screens/OrderDetailScreen\";\nimport QRScannerScreen from \"@/screens/QRScannerScreen\";\nimport QRCodeScreen from \"@/screens/QRCodeScreen\";\nimport { useScreenOptions } from \"@/hooks/useScreenOptions\";\nimport { getState, subscribe } from \"@/lib/store\";\n\nexport type RootStackParamList = {\n  Main: undefined;\n  ProfileSetup: undefined;\n  CreateOrder: undefined;\n  OrderDetail: { orderId: string; mode: \"received\" | \"sent\" };\n  QRScanner: undefined;\n  QRCode: undefined;\n};\n\nconst Stack = createNativeStackNavigator<RootStackParamList>();\n\nexport default function RootStackNavigator() {\n  const screenOptions = useScreenOptions();\n  const [hasProfile, setHasProfile] = useState(!!getState().currentUser);\n\n  useEffect(() => {\n    const unsubscribe = subscribe(() => {\n      setHasProfile(!!getState().currentUser);\n    });\n    return unsubscribe;\n  }, []);\n\n  return (\n    <Stack.Navigator screenOptions={screenOptions}>\n      {!hasProfile ? (\n        <Stack.Screen\n          name=\"ProfileSetup\"\n          component={ProfileSetupScreen}\n          options={{ headerShown: false }}\n        />\n      ) : (\n        <>\n          <Stack.Screen\n            name=\"Main\"\n            component={MainTabNavigator}\n            options={{ headerShown: false }}\n          />\n          <Stack.Screen\n            name=\"CreateOrder\"\n            component={CreateOrderScreen}\n            options={{\n              presentation: \"modal\",\n              headerTitle: \"New Order\",\n            }}\n          />\n          <Stack.Screen\n            name=\"OrderDetail\"\n            component={OrderDetailScreen}\n            options={{\n              headerTitle: \"Order\",\n            }}\n          />\n          <Stack.Screen\n            name=\"QRScanner\"\n            component={QRScannerScreen}\n            options={{\n              presentation: \"fullScreenModal\",\n              headerShown: false,\n            }}\n          />\n          <Stack.Screen\n            name=\"QRCode\"\n            component={QRCodeScreen}\n            options={{\n              presentation: \"modal\",\n              headerTitle: \"Your QR Code\",\n            }}\n          />\n        </>\n      )}\n    </Stack.Navigator>\n  );\n}\n","path":null,"size_bytes":2506,"size_tokens":null},"client/lib/notifications.ts":{"content":"import * as Notifications from 'expo-notifications';\nimport Constants from 'expo-constants';\nimport { Platform } from 'react-native';\nimport { apiRequest, getApiUrl } from './query-client';\nimport { getState } from './store';\n\nfunction isExpoGo(): boolean {\n  return Constants.appOwnership === 'expo';\n}\n\n// Only set up notification handler if not in Expo Go on Android (not supported since SDK 53)\nif (!(isExpoGo() && Platform.OS === 'android')) {\n  try {\n    Notifications.setNotificationHandler({\n      handleNotification: async () => ({\n        shouldShowAlert: true,\n        shouldPlaySound: true,\n        shouldSetBadge: true,\n        shouldShowBanner: true,\n        shouldShowList: true,\n      }),\n    });\n  } catch (error) {\n    // Notifications not supported in this environment\n    console.log('Notification handler setup skipped');\n  }\n}\n\nexport async function registerForPushNotifications(): Promise<string | null> {\n  if (Platform.OS === 'web') {\n    console.log('Push notifications not supported on web');\n    return null;\n  }\n\n  // Push notifications not supported in Expo Go on Android since SDK 53\n  if (isExpoGo() && Platform.OS === 'android') {\n    return null;\n  }\n\n  if (isExpoGo()) {\n    console.log('Push notifications are limited in Expo Go. For full functionality, use a development build.');\n    return null;\n  }\n\n  try {\n    const { status: existingStatus } = await Notifications.getPermissionsAsync();\n    let finalStatus = existingStatus;\n\n    if (existingStatus !== 'granted') {\n      const { status } = await Notifications.requestPermissionsAsync();\n      finalStatus = status;\n    }\n\n    if (finalStatus !== 'granted') {\n      console.log('Push notification permission not granted');\n      return null;\n    }\n\n    const projectId = Constants.expoConfig?.extra?.eas?.projectId;\n    if (!projectId) {\n      console.log('No projectId found - push notifications require a development build');\n      return null;\n    }\n\n    const tokenData = await Notifications.getExpoPushTokenAsync({\n      projectId,\n    });\n    const token = tokenData.data;\n    console.log('Expo push token:', token);\n    return token;\n  } catch (error: any) {\n    if (error?.message?.includes('projectId') || error?.message?.includes('Expo Go')) {\n      console.log('Push notifications require a development build');\n    } else {\n      console.log('Push notification setup skipped:', error?.message || 'Unknown error');\n    }\n    return null;\n  }\n}\n\nexport async function registerDeviceToken(token: string): Promise<boolean> {\n  const currentUser = getState().currentUser;\n  if (!currentUser) {\n    console.log('No user to register token for');\n    return false;\n  }\n\n  try {\n    await apiRequest('POST', '/api/device-tokens', {\n      userId: currentUser.id,\n      token,\n      platform: Platform.OS,\n    });\n    console.log('Device token registered successfully');\n    return true;\n  } catch (error) {\n    console.error('Failed to register device token:', error);\n    return false;\n  }\n}\n\nexport async function unregisterDeviceToken(token: string): Promise<boolean> {\n  try {\n    await apiRequest('DELETE', '/api/device-tokens', { token });\n    console.log('Device token unregistered');\n    return true;\n  } catch (error) {\n    console.error('Failed to unregister device token:', error);\n    return false;\n  }\n}\n\nexport async function syncFamilyConnection(\n  parentId: string,\n  childId: string,\n  childName: string\n): Promise<boolean> {\n  try {\n    await apiRequest('POST', '/api/family-connections', {\n      parentId,\n      childId,\n      childName,\n    });\n    console.log('Family connection synced');\n    return true;\n  } catch (error) {\n    console.error('Failed to sync family connection:', error);\n    return false;\n  }\n}\n\nexport async function sendOrderNotification(\n  parentId: string,\n  receiverName: string,\n  itemCount: number\n): Promise<boolean> {\n  try {\n    await apiRequest('POST', '/api/notifications/send', {\n      parentId,\n      title: 'New Shopping Order',\n      body: `You have a new order with ${itemCount} ${itemCount === 1 ? 'item' : 'items'} to pick up!`,\n      data: {\n        type: 'new_order',\n        itemCount: String(itemCount),\n      },\n    });\n    console.log('Order notification sent');\n    return true;\n  } catch (error) {\n    console.error('Failed to send order notification:', error);\n    return false;\n  }\n}\n\nexport function setupNotificationListeners(\n  onNotificationReceived?: (notification: Notifications.Notification) => void,\n  onNotificationResponse?: (response: Notifications.NotificationResponse) => void\n) {\n  // Skip notification listeners on web and in Expo Go on Android (not supported)\n  if (Platform.OS === 'web' || (isExpoGo() && Platform.OS === 'android')) {\n    return () => {};\n  }\n\n  try {\n    const receivedSubscription = Notifications.addNotificationReceivedListener(\n      (notification: Notifications.Notification) => {\n        console.log('Notification received:', notification);\n        onNotificationReceived?.(notification);\n      }\n    );\n\n    const responseSubscription = Notifications.addNotificationResponseReceivedListener(\n      (response: Notifications.NotificationResponse) => {\n        console.log('Notification response:', response);\n        onNotificationResponse?.(response);\n      }\n    );\n\n    return () => {\n      receivedSubscription.remove();\n      responseSubscription.remove();\n    };\n  } catch (error) {\n    console.log('Notification listeners not available in this environment');\n    return () => {};\n  }\n}\n","path":null,"size_bytes":5495,"size_tokens":null},"client/screens/TasksScreen.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport { View, StyleSheet, FlatList, Pressable, Alert, Platform, Image } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { getState, subscribe, markTaskDone, loadTasksFromServer, Task } from \"@/lib/store\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useToast } from \"@/lib/toast\";\n\nfunction TaskCard({ \n  task, \n  onMarkDone \n}: { \n  task: Task; \n  onMarkDone: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  const handleMarkDone = () => {\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n    }\n    Alert.alert(\n      \"Mark as Done\",\n      `Did you complete \"${task.itemName || \"this item\"}\"?`,\n      [\n        { text: \"Cancel\", style: \"cancel\" },\n        {\n          text: \"Yes, Done\",\n          style: \"default\",\n          onPress: () => {\n            onMarkDone(task.id);\n            if (Platform.OS !== \"web\") {\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const formatTime = (timestamp: number) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    \n    if (diff < 60000) return \"Just now\";\n    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <Card style={styles.taskCard}>\n      <View style={[styles.taskImageLarge, { backgroundColor: theme.backgroundSecondary }]}>\n        {task.itemSvgData ? (\n          <Image source={{ uri: task.itemSvgData }} style={styles.itemImageLarge} resizeMode=\"cover\" />\n        ) : (\n          <Feather name=\"image\" size={64} color={theme.textTertiary} />\n        )}\n      </View>\n      <View style={styles.taskDetails}>\n        <View style={styles.taskInfo}>\n          <ThemedText type=\"h3\" numberOfLines={2}>\n            {task.itemName || \"Item\"}\n          </ThemedText>\n          <ThemedText type=\"body\" style={{ color: theme.textSecondary }}>\n            From {task.assignedByName} • {formatTime(task.createdAt)}\n          </ThemedText>\n          {task.quantity > 1 ? (\n            <ThemedText type=\"body\" style={{ color: theme.primary, fontWeight: \"600\" }}>\n              Quantity: {task.quantity}\n            </ThemedText>\n          ) : null}\n          {task.note ? (\n            <ThemedText type=\"body\" style={{ color: theme.textSecondary, marginTop: Spacing.xs }}>\n              Note: {task.note}\n            </ThemedText>\n          ) : null}\n        </View>\n        <Pressable\n          onPress={handleMarkDone}\n          style={({ pressed }) => [\n            styles.doneButtonLarge,\n            {\n              backgroundColor: Colors.light.statusCompleted,\n              opacity: pressed ? 0.8 : 1,\n              transform: [{ scale: pressed ? 0.95 : 1 }],\n            },\n          ]}\n        >\n          <Feather name=\"check\" size={28} color={Colors.light.buttonText} />\n          <ThemedText type=\"body\" style={{ color: Colors.light.buttonText, fontWeight: \"600\", marginLeft: Spacing.sm }}>\n            Done\n          </ThemedText>\n        </Pressable>\n      </View>\n    </Card>\n  );\n}\n\nfunction EmptyState() {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"check-circle\" size={64} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No Tasks Yet\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        When a parent assigns items to you, they will appear here\n      </ThemedText>\n    </View>\n  );\n}\n\nexport default function TasksScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const navigation = useNavigation();\n  const { showToast } = useToast();\n  const [tasks, setTasks] = useState<Task[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const updateTasksFromState = () => {\n    const state = getState();\n    const currentUserId = state.currentUser?.id;\n    if (currentUserId) {\n      setTasks([...state.tasks.filter(t => t.assignedToId === currentUserId && t.status === 'pending')]);\n    }\n  };\n\n  const loadTasks = async () => {\n    const currentState = getState();\n    const userId = currentState.currentUser?.id;\n    if (userId) {\n      setIsLoading(true);\n      await loadTasksFromServer(userId);\n      updateTasksFromState();\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const unsubscribe = subscribe(() => {\n      updateTasksFromState();\n    });\n    \n    updateTasksFromState();\n    loadTasks();\n    \n    const unsubscribeFocus = navigation.addListener('focus', () => {\n      loadTasks();\n    });\n    \n    return () => {\n      unsubscribe();\n      unsubscribeFocus();\n    };\n  }, [navigation]);\n\n  const handleMarkDone = async (taskId: string) => {\n    const task = tasks.find(t => t.id === taskId);\n    await markTaskDone(taskId);\n    showToast(`\"${task?.itemName || \"Task\"}\" marked as done`, \"success\");\n  };\n\n  return (\n    <ThemedView style={styles.container}>\n      <FlatList\n        data={tasks}\n        keyExtractor={(item) => item.id}\n        contentContainerStyle={[\n          styles.listContent,\n          {\n            paddingTop: headerHeight + Spacing.lg,\n            paddingBottom: tabBarHeight + Spacing[\"3xl\"],\n          },\n        ]}\n        ListEmptyComponent={<EmptyState />}\n        renderItem={({ item }) => (\n          <TaskCard task={item} onMarkDone={handleMarkDone} />\n        )}\n        showsVerticalScrollIndicator={false}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  taskCard: {\n    padding: 0,\n    marginBottom: Spacing.lg,\n    overflow: \"hidden\",\n  },\n  taskImageLarge: {\n    width: \"100%\",\n    height: 200,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  itemImageLarge: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  taskDetails: {\n    padding: Spacing.lg,\n    gap: Spacing.md,\n  },\n  taskInfo: {\n    gap: Spacing.xs,\n  },\n  doneButtonLarge: {\n    flexDirection: \"row\",\n    height: 56,\n    borderRadius: BorderRadius.lg,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"3xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n  },\n});\n","path":null,"size_bytes":7493,"size_tokens":null},"server/firebase.ts":{"content":"import * as admin from 'firebase-admin';\n\nlet firebaseApp: admin.app.App | null = null;\n\nexport function initializeFirebase(): admin.app.App | null {\n  if (firebaseApp) {\n    return firebaseApp;\n  }\n\n  const serviceAccountJson = process.env.FIREBASE_SERVICE_ACCOUNT;\n  \n  if (!serviceAccountJson) {\n    console.warn('FIREBASE_SERVICE_ACCOUNT not set, push notifications disabled');\n    return null;\n  }\n\n  try {\n    const serviceAccount = JSON.parse(serviceAccountJson);\n    firebaseApp = admin.initializeApp({\n      credential: admin.credential.cert(serviceAccount),\n    });\n    console.log('Firebase initialized successfully');\n    return firebaseApp;\n  } catch (error) {\n    console.error('Failed to initialize Firebase:', error);\n    return null;\n  }\n}\n\nexport function getFirebaseApp(): admin.app.App | null {\n  return firebaseApp;\n}\n\nexport async function sendPushNotification(\n  tokens: string[],\n  title: string,\n  body: string,\n  data?: Record<string, string>\n): Promise<{ successCount: number; failureCount: number; failedTokens: string[] }> {\n  if (!firebaseApp || tokens.length === 0) {\n    return { successCount: 0, failureCount: 0, failedTokens: [] };\n  }\n\n  const message: admin.messaging.MulticastMessage = {\n    tokens,\n    notification: {\n      title,\n      body,\n    },\n    data: data || {},\n    android: {\n      priority: 'high',\n    },\n    apns: {\n      payload: {\n        aps: {\n          sound: 'default',\n          badge: 1,\n        },\n      },\n    },\n  };\n\n  try {\n    const response = await admin.messaging().sendEachForMulticast(message);\n    \n    const failedTokens: string[] = [];\n    response.responses.forEach((resp, idx) => {\n      if (!resp.success) {\n        failedTokens.push(tokens[idx]);\n      }\n    });\n\n    return {\n      successCount: response.successCount,\n      failureCount: response.failureCount,\n      failedTokens,\n    };\n  } catch (error) {\n    console.error('Failed to send push notification:', error);\n    return { successCount: 0, failureCount: tokens.length, failedTokens: tokens };\n  }\n}\n","path":null,"size_bytes":2040,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from 'drizzle-orm/node-postgres';\nimport pg from 'pg';\nimport * as schema from '@shared/schema';\n\nconst pool = new pg.Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":240,"size_tokens":null},"client/screens/NotificationsScreen.tsx":{"content":"import React, { useState, useEffect, useCallback } from \"react\";\nimport { View, StyleSheet, FlatList, Pressable, Platform, Image, RefreshControl } from \"react-native\";\nimport { useBottomTabBarHeight } from \"@react-navigation/bottom-tabs\";\nimport { useHeaderHeight } from \"@react-navigation/elements\";\nimport { useFocusEffect } from \"@react-navigation/native\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedView } from \"@/components/ThemedView\";\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Card } from \"@/components/Card\";\nimport { Spacing, BorderRadius, Colors } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\nimport { useToast } from \"@/lib/toast\";\nimport { \n  getState, \n  subscribe, \n  markNotificationRead, \n  markAllNotificationsRead,\n  loadTasksFromServer,\n  getParentAssignedTasks,\n  getChildTasks,\n  Task,\n  Notification \n} from \"@/lib/store\";\n\ntype UpdateItem = \n  | { type: 'task'; data: Task }\n  | { type: 'notification'; data: Notification };\n\nfunction TaskCard({ task }: { task: Task }) {\n  const { theme } = useTheme();\n  const isPending = task.status === 'pending';\n\n  const formatTime = (timestamp: number) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    \n    if (diff < 60000) return \"Just now\";\n    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <Card style={styles.taskCard}>\n      <View style={styles.taskContent}>\n        <View style={[styles.taskImage, { backgroundColor: theme.backgroundSecondary }]}>\n          {task.itemSvgData ? (\n            <Image source={{ uri: task.itemSvgData }} style={styles.itemImage} />\n          ) : (\n            <Feather name=\"image\" size={24} color={theme.textTertiary} />\n          )}\n        </View>\n        <View style={styles.taskInfo}>\n          <ThemedText type=\"body\" style={{ fontWeight: \"600\" }} numberOfLines={1}>\n            {task.itemName || \"Item\"}\n          </ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            Assigned to {task.assignedToName}\n          </ThemedText>\n          <ThemedText type=\"small\" style={{ color: theme.textTertiary }}>\n            {formatTime(task.createdAt)}\n            {task.quantity > 1 ? ` • Qty: ${task.quantity}` : \"\"}\n          </ThemedText>\n        </View>\n        <View style={[\n          styles.statusBadge, \n          { \n            backgroundColor: isPending \n              ? Colors.light.statusPending + \"20\" \n              : Colors.light.statusCompleted + \"20\" \n          }\n        ]}>\n          <Feather \n            name={isPending ? \"clock\" : \"check\"} \n            size={16} \n            color={isPending ? Colors.light.statusPending : Colors.light.statusCompleted} \n          />\n        </View>\n      </View>\n    </Card>\n  );\n}\n\nfunction NotificationCard({ \n  notification, \n  onMarkRead \n}: { \n  notification: Notification; \n  onMarkRead: (id: string) => void;\n}) {\n  const { theme } = useTheme();\n\n  const handlePress = () => {\n    if (!notification.read) {\n      onMarkRead(notification.id);\n      if (Platform.OS !== \"web\") {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      }\n    }\n  };\n\n  const formatTime = (timestamp: number) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    \n    if (diff < 60000) return \"Just now\";\n    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  const getMessage = () => {\n    if (notification.type === 'task_completed') {\n      const itemText = notification.itemName || \"an item\";\n      return `${notification.completedByName} completed \"${itemText}\"`;\n    }\n    return \"New notification\";\n  };\n\n  return (\n    <Card \n      style={StyleSheet.flatten([\n        styles.notificationCard,\n        !notification.read && { borderLeftWidth: 3, borderLeftColor: Colors.light.primary },\n      ])}\n      onPress={handlePress}\n    >\n      <View style={styles.notificationContent}>\n        <View style={[\n          styles.iconContainer, \n          { \n            backgroundColor: notification.read \n              ? theme.backgroundSecondary \n              : Colors.light.statusCompleted + \"20\" \n          }\n        ]}>\n          <Feather \n            name=\"check-circle\" \n            size={24} \n            color={notification.read ? theme.textTertiary : Colors.light.statusCompleted} \n          />\n        </View>\n        <View style={styles.notificationInfo}>\n          <ThemedText \n            type=\"body\" \n            style={{ fontWeight: notification.read ? \"400\" : \"600\" }}\n          >\n            {getMessage()}\n          </ThemedText>\n          <ThemedText type=\"caption\" style={{ color: theme.textSecondary }}>\n            {formatTime(notification.createdAt)}\n          </ThemedText>\n        </View>\n        {!notification.read ? (\n          <View style={[styles.unreadDot, { backgroundColor: Colors.light.primary }]} />\n        ) : null}\n      </View>\n    </Card>\n  );\n}\n\nfunction EmptyState() {\n  const { theme } = useTheme();\n  \n  return (\n    <View style={styles.emptyContainer}>\n      <View style={[styles.emptyIcon, { backgroundColor: theme.backgroundDefault }]}>\n        <Feather name=\"bell\" size={64} color={theme.textTertiary} />\n      </View>\n      <ThemedText type=\"h3\" style={styles.emptyTitle}>\n        No Updates\n      </ThemedText>\n      <ThemedText type=\"body\" style={[styles.emptyText, { color: theme.textSecondary }]}>\n        Assign tasks from the Items tab and track their progress here\n      </ThemedText>\n    </View>\n  );\n}\n\nexport default function NotificationsScreen() {\n  const headerHeight = useHeaderHeight();\n  const tabBarHeight = useBottomTabBarHeight();\n  const { theme } = useTheme();\n  const { showToast } = useToast();\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [tasks, setTasks] = useState<Task[]>([]);\n  const [refreshing, setRefreshing] = useState(false);\n\n  const loadData = useCallback(async () => {\n    const state = getState();\n    const currentUser = state.currentUser;\n    \n    if (currentUser) {\n      const result = await loadTasksFromServer(currentUser.id);\n      \n      if (currentUser.role === 'parent' && result.newlyCompleted.length > 0) {\n        for (const task of result.newlyCompleted) {\n          showToast(`\"${task.itemName}\" was completed by ${task.assignedToName}`, \"success\");\n        }\n      }\n    }\n    \n    const newState = getState();\n    const user = newState.currentUser;\n    setNotifications([...newState.notifications].reverse());\n    \n    if (user?.role === 'parent') {\n      setTasks(getParentAssignedTasks(user.id));\n    } else if (user?.role === 'child') {\n      setTasks(getChildTasks(user.id));\n    } else {\n      setTasks([]);\n    }\n  }, [showToast]);\n\n  useFocusEffect(\n    useCallback(() => {\n      loadData();\n    }, [loadData])\n  );\n\n  useEffect(() => {\n    const state = getState();\n    const user = state.currentUser;\n    setNotifications([...state.notifications].reverse());\n    \n    if (user?.role === 'parent') {\n      setTasks(getParentAssignedTasks(user.id));\n    } else if (user?.role === 'child') {\n      setTasks(getChildTasks(user.id));\n    } else {\n      setTasks([]);\n    }\n    \n    const unsubscribe = subscribe(() => {\n      const newState = getState();\n      const currentUser = newState.currentUser;\n      setNotifications([...newState.notifications].reverse());\n      \n      if (currentUser?.role === 'parent') {\n        setTasks(getParentAssignedTasks(currentUser.id));\n      } else if (currentUser?.role === 'child') {\n        setTasks(getChildTasks(currentUser.id));\n      } else {\n        setTasks([]);\n      }\n    });\n    return unsubscribe;\n  }, []);\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    await loadData();\n    setRefreshing(false);\n    if (Platform.OS !== \"web\") {\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    }\n  };\n\n  const handleMarkRead = (notificationId: string) => {\n    markNotificationRead(notificationId);\n  };\n\n  const handleMarkAllRead = () => {\n    markAllNotificationsRead();\n    if (Platform.OS !== \"web\") {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    }\n  };\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n  const pendingTasks = tasks.filter(t => t.status === 'pending');\n\n  const updateItems: UpdateItem[] = [\n    ...pendingTasks.map(t => ({ type: 'task' as const, data: t })),\n    ...notifications.map(n => ({ type: 'notification' as const, data: n })),\n  ].sort((a, b) => {\n    const timeA = a.type === 'task' ? a.data.createdAt : a.data.createdAt;\n    const timeB = b.type === 'task' ? b.data.createdAt : b.data.createdAt;\n    return timeB - timeA;\n  });\n\n  return (\n    <ThemedView style={styles.container}>\n      {unreadCount > 0 ? (\n        <View style={[styles.header, { paddingTop: headerHeight + Spacing.md }]}>\n          <Pressable\n            onPress={handleMarkAllRead}\n            style={({ pressed }) => [\n              styles.markAllButton,\n              { opacity: pressed ? 0.7 : 1 },\n            ]}\n          >\n            <ThemedText type=\"small\" style={{ color: theme.primary }}>\n              Mark all as read\n            </ThemedText>\n          </Pressable>\n        </View>\n      ) : null}\n      \n      {pendingTasks.length > 0 ? (\n        <View style={[\n          styles.summaryBar, \n          { \n            marginTop: unreadCount > 0 ? 0 : headerHeight + Spacing.md,\n            backgroundColor: Colors.light.statusPending + \"15\" \n          }\n        ]}>\n          <Feather name=\"clock\" size={16} color={Colors.light.statusPending} />\n          <ThemedText type=\"small\" style={{ color: Colors.light.statusPending, marginLeft: Spacing.sm }}>\n            {pendingTasks.length} pending task{pendingTasks.length !== 1 ? \"s\" : \"\"}\n          </ThemedText>\n        </View>\n      ) : null}\n      \n      <FlatList\n        data={updateItems}\n        keyExtractor={(item) => item.type === 'task' ? `task-${item.data.id}` : `notif-${item.data.id}`}\n        contentContainerStyle={[\n          styles.listContent,\n          {\n            paddingTop: (unreadCount > 0 || pendingTasks.length > 0) ? Spacing.md : headerHeight + Spacing.lg,\n            paddingBottom: tabBarHeight + Spacing[\"3xl\"],\n          },\n        ]}\n        ListEmptyComponent={<EmptyState />}\n        refreshControl={\n          <RefreshControl\n            refreshing={refreshing}\n            onRefresh={handleRefresh}\n            tintColor={theme.primary}\n          />\n        }\n        renderItem={({ item }) => (\n          item.type === 'task' \n            ? <TaskCard task={item.data} />\n            : <NotificationCard notification={item.data} onMarkRead={handleMarkRead} />\n        )}\n        showsVerticalScrollIndicator={false}\n      />\n    </ThemedView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    flexDirection: \"row\",\n    justifyContent: \"flex-end\",\n    paddingHorizontal: Spacing.lg,\n    paddingBottom: Spacing.sm,\n  },\n  summaryBar: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingVertical: Spacing.sm,\n    paddingHorizontal: Spacing.lg,\n    marginHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.md,\n    marginBottom: Spacing.sm,\n  },\n  markAllButton: {\n    padding: Spacing.sm,\n  },\n  listContent: {\n    flexGrow: 1,\n    paddingHorizontal: Spacing.lg,\n  },\n  taskCard: {\n    padding: Spacing.md,\n    marginBottom: Spacing.sm,\n  },\n  taskContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  taskImage: {\n    width: 48,\n    height: 48,\n    borderRadius: BorderRadius.sm,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n    overflow: \"hidden\",\n  },\n  itemImage: {\n    width: \"100%\",\n    height: \"100%\",\n  },\n  taskInfo: {\n    flex: 1,\n    gap: 2,\n  },\n  statusBadge: {\n    width: 32,\n    height: 32,\n    borderRadius: 16,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginLeft: Spacing.sm,\n  },\n  notificationCard: {\n    padding: Spacing.lg,\n    marginBottom: Spacing.sm,\n  },\n  notificationContent: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n  },\n  iconContainer: {\n    width: 48,\n    height: 48,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginRight: Spacing.md,\n  },\n  notificationInfo: {\n    flex: 1,\n    gap: Spacing.xs,\n  },\n  unreadDot: {\n    width: 10,\n    height: 10,\n    borderRadius: 5,\n    marginLeft: Spacing.sm,\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: Spacing[\"2xl\"],\n    paddingTop: Spacing[\"3xl\"],\n  },\n  emptyIcon: {\n    width: 100,\n    height: 100,\n    borderRadius: 50,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: Spacing.xl,\n  },\n  emptyTitle: {\n    textAlign: \"center\",\n    marginBottom: Spacing.md,\n  },\n  emptyText: {\n    textAlign: \"center\",\n    maxWidth: 260,\n  },\n});\n","path":null,"size_bytes":13289,"size_tokens":null},"client/lib/api.ts":{"content":"import { getApiUrl, apiRequest } from \"@/lib/query-client\";\n\nexport interface ServerUser {\n  id: string;\n  name: string;\n  role: string;\n  avatarSvg: string | null;\n  createdAt: string;\n}\n\nexport interface ServerConnectionRequest {\n  id: number;\n  fromUserId: string;\n  fromUserName: string;\n  fromUserRole: string;\n  fromUserAvatar: string | null;\n  toUserId: string;\n  toUserName?: string;\n  toUserRole?: string;\n  toUserAvatar?: string | null;\n  status: string;\n  createdAt: string;\n}\n\nexport interface ServerFamilyMember {\n  id: string;\n  userId: string;\n  name: string;\n  role: string;\n  avatarSvg: string | null;\n  connectedAt: string;\n}\n\nexport async function registerAppUser(user: {\n  id: string;\n  name: string;\n  role: string;\n  avatarSvg: string | null;\n}): Promise<void> {\n  const url = new URL(\"/api/app-users\", getApiUrl());\n  await apiRequest(\"POST\", url.toString(), user);\n}\n\nexport async function getUserById(id: string): Promise<ServerUser | null> {\n  try {\n    const url = new URL(`/api/app-users/${id}`, getApiUrl());\n    const response = await fetch(url.toString());\n    if (response.status === 404) {\n      return null;\n    }\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch user\");\n    }\n    return await response.json();\n  } catch {\n    return null;\n  }\n}\n\nexport async function sendConnectionRequest(params: {\n  fromUserId: string;\n  fromUserName: string;\n  fromUserRole: string;\n  fromUserAvatar: string | null;\n  toUserId: string;\n}): Promise<{ success: boolean; error?: string; targetUser?: ServerUser }> {\n  try {\n    const url = new URL(\"/api/connection-requests\", getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(params),\n    });\n    \n    const data = await response.json();\n    \n    if (!response.ok) {\n      return { success: false, error: data.error };\n    }\n    \n    return { success: true, targetUser: data.targetUser };\n  } catch (error) {\n    return { success: false, error: \"Network error. Please try again.\" };\n  }\n}\n\nexport async function getIncomingRequests(userId: string): Promise<ServerConnectionRequest[]> {\n  try {\n    const url = new URL(`/api/connection-requests/incoming/${userId}`, getApiUrl());\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      return [];\n    }\n    return await response.json();\n  } catch {\n    return [];\n  }\n}\n\nexport async function getOutgoingRequests(userId: string): Promise<ServerConnectionRequest[]> {\n  try {\n    const url = new URL(`/api/connection-requests/outgoing/${userId}`, getApiUrl());\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      return [];\n    }\n    return await response.json();\n  } catch {\n    return [];\n  }\n}\n\nexport async function acceptConnectionRequest(requestId: number, userId: string): Promise<{ success: boolean; fromUser?: ServerUser; toUser?: ServerUser }> {\n  try {\n    const url = new URL(`/api/connection-requests/${requestId}/accept`, getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ userId }),\n    });\n    \n    if (!response.ok) {\n      return { success: false };\n    }\n    \n    const data = await response.json();\n    return { success: true, fromUser: data.fromUser, toUser: data.toUser };\n  } catch {\n    return { success: false };\n  }\n}\n\nexport async function rejectConnectionRequest(requestId: number, userId: string): Promise<boolean> {\n  try {\n    const url = new URL(`/api/connection-requests/${requestId}/reject`, getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ userId }),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nexport async function getFamilyMembers(userId: string): Promise<ServerFamilyMember[]> {\n  try {\n    const url = new URL(`/api/connections/${userId}`, getApiUrl());\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      return [];\n    }\n    return await response.json();\n  } catch {\n    return [];\n  }\n}\n\nexport async function deleteFamilyConnection(connectionId: string, userId: string): Promise<boolean> {\n  try {\n    const url = new URL(`/api/connections/${connectionId}`, getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"DELETE\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ userId }),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nexport interface ServerTask {\n  id: number;\n  itemId: string;\n  itemSvgData: string;\n  itemName: string | null;\n  quantity: number;\n  note: string | null;\n  assignedToId: string;\n  assignedToName: string;\n  assignedById: string;\n  assignedByName: string;\n  status: string;\n  createdAt: string;\n  completedAt: string | null;\n}\n\nexport async function createTask(task: {\n  itemId: string;\n  itemSvgData: string;\n  itemName: string | null;\n  quantity: number;\n  note: string | null;\n  assignedToId: string;\n  assignedToName: string;\n  assignedById: string;\n  assignedByName: string;\n}): Promise<ServerTask | null> {\n  try {\n    const url = new URL(\"/api/tasks\", getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(task),\n    });\n    if (!response.ok) {\n      return null;\n    }\n    return await response.json();\n  } catch {\n    return null;\n  }\n}\n\nexport async function getTasksForUser(userId: string): Promise<ServerTask[]> {\n  try {\n    const url = new URL(`/api/tasks/${userId}`, getApiUrl());\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      return [];\n    }\n    return await response.json();\n  } catch {\n    return [];\n  }\n}\n\nexport async function completeTask(taskId: number): Promise<ServerTask | null> {\n  try {\n    const url = new URL(`/api/tasks/${taskId}/complete`, getApiUrl());\n    const response = await fetch(url.toString(), {\n      method: \"PATCH\",\n      headers: { \"Content-Type\": \"application/json\" },\n    });\n    if (!response.ok) {\n      return null;\n    }\n    return await response.json();\n  } catch {\n    return null;\n  }\n}\n","path":null,"size_bytes":6342,"size_tokens":null},"client/lib/toast.tsx":{"content":"import React, { createContext, useContext, useState, useCallback, useRef, useEffect } from \"react\";\nimport { View, StyleSheet, Platform, Pressable } from \"react-native\";\nimport Animated, {\n  useSharedValue,\n  useAnimatedStyle,\n  withSpring,\n  withTiming,\n  runOnJS,\n} from \"react-native-reanimated\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\n\nimport { ThemedText } from \"@/components/ThemedText\";\nimport { Colors, Spacing, BorderRadius } from \"@/constants/theme\";\nimport { useTheme } from \"@/hooks/useTheme\";\n\nexport type ToastType = \"success\" | \"error\" | \"info\";\n\ntype ToastListener = (message: string, type: ToastType, duration?: number) => void;\n\nlet globalToastListener: ToastListener | null = null;\n\nexport function showGlobalToast(message: string, type: ToastType = \"info\", duration?: number) {\n  if (globalToastListener) {\n    globalToastListener(message, type, duration);\n  }\n}\n\nexport function setGlobalToastListener(listener: ToastListener | null) {\n  globalToastListener = listener;\n}\n\ninterface Toast {\n  id: string;\n  message: string;\n  type: ToastType;\n  duration?: number;\n}\n\ninterface ToastContextValue {\n  showToast: (message: string, type?: ToastType, duration?: number) => void;\n}\n\nconst ToastContext = createContext<ToastContextValue | null>(null);\n\nexport function useToast() {\n  const context = useContext(ToastContext);\n  if (!context) {\n    throw new Error(\"useToast must be used within a ToastProvider\");\n  }\n  return context;\n}\n\nfunction ToastItem({ toast, onDismiss }: { toast: Toast; onDismiss: (id: string) => void }) {\n  const { theme } = useTheme();\n  const translateY = useSharedValue(-100);\n  const opacity = useSharedValue(0);\n\n  useEffect(() => {\n    translateY.value = withSpring(0, { damping: 15, stiffness: 150 });\n    opacity.value = withTiming(1, { duration: 200 });\n\n    const timeout = setTimeout(() => {\n      dismiss();\n    }, toast.duration || 3000);\n\n    return () => clearTimeout(timeout);\n  }, []);\n\n  const dismiss = () => {\n    opacity.value = withTiming(0, { duration: 200 });\n    translateY.value = withTiming(-100, { duration: 300 }, (finished) => {\n      if (finished) {\n        runOnJS(onDismiss)(toast.id);\n      }\n    });\n  };\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ translateY: translateY.value }],\n    opacity: opacity.value,\n  }));\n\n  const getIconName = (): keyof typeof Feather.glyphMap => {\n    switch (toast.type) {\n      case \"success\":\n        return \"check-circle\";\n      case \"error\":\n        return \"alert-circle\";\n      default:\n        return \"info\";\n    }\n  };\n\n  const getBackgroundColor = () => {\n    switch (toast.type) {\n      case \"success\":\n        return Colors.light.statusCompleted;\n      case \"error\":\n        return Colors.light.statusError;\n      default:\n        return theme.primary;\n    }\n  };\n\n  return (\n    <Animated.View style={[styles.toastContainer, animatedStyle]}>\n      <Pressable\n        onPress={dismiss}\n        style={[styles.toast, { backgroundColor: getBackgroundColor() }]}\n      >\n        <Feather name={getIconName()} size={20} color=\"#FFFFFF\" />\n        <ThemedText type=\"body\" style={styles.toastText} numberOfLines={2}>\n          {toast.message}\n        </ThemedText>\n      </Pressable>\n    </Animated.View>\n  );\n}\n\nexport function ToastProvider({ children }: { children: React.ReactNode }) {\n  const [toasts, setToasts] = useState<Toast[]>([]);\n  const insets = useSafeAreaInsets();\n  const idCounter = useRef(0);\n\n  const showToast = useCallback((message: string, type: ToastType = \"info\", duration?: number) => {\n    const id = `toast-${++idCounter.current}`;\n    \n    setToasts((prev) => [...prev, { id, message, type, duration }]);\n    \n    if (Platform.OS !== \"web\") {\n      if (type === \"success\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      } else if (type === \"error\") {\n        Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);\n      } else {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    setGlobalToastListener(showToast);\n    return () => setGlobalToastListener(null);\n  }, [showToast]);\n\n  const dismissToast = useCallback((id: string) => {\n    setToasts((prev) => prev.filter((t) => t.id !== id));\n  }, []);\n\n  return (\n    <ToastContext.Provider value={{ showToast }}>\n      {children}\n      <View style={[styles.toastWrapper, { top: insets.top + Spacing.md }]} pointerEvents=\"box-none\">\n        {toasts.map((toast) => (\n          <ToastItem key={toast.id} toast={toast} onDismiss={dismissToast} />\n        ))}\n      </View>\n    </ToastContext.Provider>\n  );\n}\n\nconst styles = StyleSheet.create({\n  toastWrapper: {\n    position: \"absolute\",\n    left: Spacing.lg,\n    right: Spacing.lg,\n    zIndex: 9999,\n    alignItems: \"center\",\n  },\n  toastContainer: {\n    marginBottom: Spacing.sm,\n    width: \"100%\",\n    maxWidth: 400,\n  },\n  toast: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    paddingVertical: Spacing.md,\n    paddingHorizontal: Spacing.lg,\n    borderRadius: BorderRadius.lg,\n    gap: Spacing.sm,\n    shadowColor: \"#000\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.15,\n    shadowRadius: 8,\n    elevation: 5,\n  },\n  toastText: {\n    color: \"#FFFFFF\",\n    flex: 1,\n    fontWeight: \"500\",\n  },\n});\n","path":null,"size_bytes":5424,"size_tokens":null}},"version":2}